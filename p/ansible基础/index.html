<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="å‰è¨€ å­¦ansibleï¼ŒåŸºç¡€ç¯‡å°±æ˜¯ä¸€ä»¶äº‹ å­¦å„ç§æ¨¡å—çš„è¯­æ³•ï¼Œå‚æ•° ç”±äºæ¨¡å—è¾ƒå¤šï¼Œå‚æ•°è¾ƒå¤šï¼Œéœ€è¦åšå¥½ç¬”è®°ï¼Œä»¥åŠä¸€å®šçš„èƒŒè¯µï¼Œæ•²æ‰“å»ºè®®è®°å¿† åŸºç¡€ç¯‡å­¦ä¹ è·¯çº¿">
<title>AnsibleåŸºç¡€</title>

<link rel='canonical' href='https://ZackMoel.github.io/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/'>

<link rel="stylesheet" href="/xiaoshi/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css"><meta property='og:title' content="AnsibleåŸºç¡€">
<meta property='og:description' content="å‰è¨€ å­¦ansibleï¼ŒåŸºç¡€ç¯‡å°±æ˜¯ä¸€ä»¶äº‹ å­¦å„ç§æ¨¡å—çš„è¯­æ³•ï¼Œå‚æ•° ç”±äºæ¨¡å—è¾ƒå¤šï¼Œå‚æ•°è¾ƒå¤šï¼Œéœ€è¦åšå¥½ç¬”è®°ï¼Œä»¥åŠä¸€å®šçš„èƒŒè¯µï¼Œæ•²æ‰“å»ºè®®è®°å¿† åŸºç¡€ç¯‡å­¦ä¹ è·¯çº¿">
<meta property='og:url' content='https://ZackMoel.github.io/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/'>
<meta property='og:site_name' content='å°è¯—'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-04-14T16:38:41&#43;08:00'/><meta property='article:modified_time' content='2025-04-14T16:38:41&#43;08:00'/>
<meta name="twitter:title" content="AnsibleåŸºç¡€">
<meta name="twitter:description" content="å‰è¨€ å­¦ansibleï¼ŒåŸºç¡€ç¯‡å°±æ˜¯ä¸€ä»¶äº‹ å­¦å„ç§æ¨¡å—çš„è¯­æ³•ï¼Œå‚æ•° ç”±äºæ¨¡å—è¾ƒå¤šï¼Œå‚æ•°è¾ƒå¤šï¼Œéœ€è¦åšå¥½ç¬”è®°ï¼Œä»¥åŠä¸€å®šçš„èƒŒè¯µï¼Œæ•²æ‰“å»ºè®®è®°å¿† åŸºç¡€ç¯‡å­¦ä¹ è·¯çº¿">
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/xiaoshi/">
                
                    
                    
                    
                        
                        <img src="/xiaoshi/img/avatar_hu8920112365793990935.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/xiaoshi">å°è¯—</a></h1>
            <h2 class="site-description">ä¸–ç•Œå’Œå¹³</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/1055981889?spm_id_from=333.1007.0.0'
                        target="_blank"
                        title="bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/ZackMoel/xiaoshi.github.io'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/xiaoshi/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/xiaoshi/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/xiaoshi/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/xiaoshi/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/xiaoshi/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>å‹æƒ…é“¾æ¥</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#åœ¨master-61ç®¡ç†æœºå®‰è£…">åœ¨master-61ç®¡ç†æœºå®‰è£…</a></li>
    <li><a href="#å…¶ä»–è¢«ç®¡ç†çš„æœºå™¨">å…¶ä»–è¢«ç®¡ç†çš„æœºå™¨</a></li>
    <li><a href="#ä¸»æœºæ¸…å•æ–‡ä»¶ä¸»æœºåˆ†ç»„">ä¸»æœºæ¸…å•æ–‡ä»¶ï¼ˆä¸»æœºåˆ†ç»„ï¼‰</a></li>
  </ol>

  <ol>
    <li><a href="#ansibleåŸºäºå…¬ç§é’¥è®¤è¯">ansibleåŸºäºå…¬ç§é’¥è®¤è¯</a></li>
    <li><a href="#åŸºäºå¯†ç è®¤è¯">åŸºäºå¯†ç è®¤è¯</a></li>
    <li><a href="#ansibleä¸»æœºæ¸…å•é…ç½®æ–‡ä»¶è¯­æ³•é‡è¦">ansibleä¸»æœºæ¸…å•é…ç½®æ–‡ä»¶è¯­æ³•ï¼ˆé‡è¦ï¼‰</a></li>
    <li><a href="#ç»™rsyncæœºå™¨è¿›è¡Œå¯†ç è®¤è¯">ç»™rsyncæœºå™¨ï¼Œè¿›è¡Œå¯†ç è®¤è¯</a></li>
    <li><a href="#æ·»åŠ webæœºå™¨ç»„çš„ä¿¡æ¯">æ·»åŠ webæœºå™¨ç»„çš„ä¿¡æ¯</a>
      <ol>
        <li>
          <ol>
            <li><a href="#æ‹¿webæœºå™¨æµ‹è¯•å•ç‹¬æ“ä½œæŸä¸»æœº">æ‹¿webæœºå™¨æµ‹è¯•ï¼ˆå•ç‹¬æ“ä½œæŸä¸»æœºï¼‰</a></li>
            <li><a href="#æŒ‡çº¹æ•…éšœè§£å†³">æŒ‡çº¹æ•…éšœè§£å†³</a></li>
            <li><a href="#è¸©å‘è®°å½•ansibleç¼“å­˜">è¸©å‘è®°å½•(ansibleç¼“å­˜)</a></li>
            <li><a href="#åŒä¸€ç»„è¿ç»­çš„ip">åŒä¸€ç»„è¿ç»­çš„ip</a></li>
            <li><a href="#å…¬å…±å˜é‡">å…¬å…±å˜é‡</a></li>
            <li><a href="#æµ‹è¯•webç»„å’Œbackupç»„æ˜¯å¦å¯ç”¨">æµ‹è¯•webç»„å’Œbackupç»„æ˜¯å¦å¯ç”¨</a></li>
            <li><a href="#æ‰€æœ‰ä¸»æœºéƒ½ç”Ÿæ•ˆçš„å˜é‡äº†è§£">æ‰€æœ‰ä¸»æœºéƒ½ç”Ÿæ•ˆçš„å˜é‡ã€äº†è§£ã€‘</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#ad-hocæ¨¡å¼">ad-hocæ¨¡å¼</a></li>
    <li><a href="#playbookæ¨¡å¼">Playbookæ¨¡å¼</a></li>
    <li><a href="#ansible-docå‘½ä»¤">ansible-docå‘½ä»¤</a></li>
  </ol>

  <ol>
    <li><a href="#ansibleæ‰§è¡Œå‘½ä»¤ç»“æœçŠ¶æ€é¢œè‰²">ansibleæ‰§è¡Œå‘½ä»¤ç»“æœï¼ˆçŠ¶æ€é¢œè‰²ï¼‰</a></li>
    <li><a href="#å®˜ç½‘æ–‡æ¡£">å®˜ç½‘æ–‡æ¡£</a></li>
    <li><a href="#41-pingæµ‹è¯•è¿é€šæ€§">4.1 pingæµ‹è¯•è¿é€šæ€§</a></li>
    <li><a href="#42-command-ç®€å•å‘½ä»¤æ¨¡å—">4.2 command ç®€å•å‘½ä»¤æ¨¡å—</a>
      <ol>
        <li><a href="#è¿œç¨‹æŸ¥çœ‹ä¸»æœºå">è¿œç¨‹æŸ¥çœ‹ä¸»æœºå</a></li>
        <li><a href="#æŸ¥çœ‹è¿œç¨‹ä¸»æœºå†…å­˜">æŸ¥çœ‹è¿œç¨‹ä¸»æœºå†…å­˜</a></li>
        <li><a href="#è¿œç¨‹åˆ›å»ºæ–‡ä»¶æŸ¥çœ‹æ–‡ä»¶">è¿œç¨‹åˆ›å»ºæ–‡ä»¶ã€æŸ¥çœ‹æ–‡ä»¶</a></li>
        <li><a href="#è¿œç¨‹è·å–æœºå™¨è´Ÿè½½">è¿œç¨‹è·å–æœºå™¨è´Ÿè½½</a></li>
        <li><a href="#å…³é—­å‘Šè­¦ä¿¡æ¯">å…³é—­å‘Šè­¦ä¿¡æ¯</a></li>
        <li><a href="#åœ¨æ‰€æœ‰æœºå™¨ä¸Šåˆ›å»ºbaizhi01ç”¨æˆ·">åœ¨æ‰€æœ‰æœºå™¨ä¸Šï¼Œåˆ›å»ºbaizhi01ç”¨æˆ·</a></li>
        <li><a href="#ä½¿ç”¨commandæä¾›çš„ä¸“æœ‰å‘½ä»¤">ä½¿ç”¨commandæä¾›çš„ä¸“æœ‰å‘½ä»¤</a></li>
      </ol>
    </li>
    <li><a href="#43-shellæ¨¡å—ä¸‡èƒ½æ¨¡å—">4.3 shellæ¨¡å—ï¼ˆä¸‡èƒ½æ¨¡å—ï¼‰</a></li>
    <li><a href="#44-copyæ‹·è´æ–‡ä»¶">4.4 copyæ‹·è´æ–‡ä»¶</a>
      <ol>
        <li><a href="#copyè¯­æ³•">copyè¯­æ³•</a></li>
        <li><a href="#ç®€å•å‘é€æ–‡ä»¶">ç®€å•å‘é€æ–‡ä»¶</a></li>
        <li><a href="#å‘é€æ–‡ä»¶ä¸”æŒ‡å®šæ–‡ä»¶å±æ€§">å‘é€æ–‡ä»¶ä¸”æŒ‡å®šæ–‡ä»¶å±æ€§</a></li>
        <li><a href="#å‘é€æ–‡ä»¶ä¸”å…ˆåšå¥½å¤‡ä»½">å‘é€æ–‡ä»¶ä¸”å…ˆåšå¥½å¤‡ä»½</a></li>
        <li><a href="#æŒ‡å®šæ•°æ®å†™å…¥åˆ°è¿œç¨‹æ–‡ä»¶ä¸­">æŒ‡å®šæ•°æ®å†™å…¥åˆ°è¿œç¨‹æ–‡ä»¶ä¸­</a></li>
        <li><a href="#å¤åˆ¶æ–‡ä»¶å¤¹">å¤åˆ¶æ–‡ä»¶å¤¹</a></li>
      </ol>
    </li>
    <li><a href="#45-fileæ–‡ä»¶æ“ä½œæ¨¡å—">4.5 fileæ–‡ä»¶æ“ä½œæ¨¡å—</a>
      <ol>
        <li><a href="#è¿œç¨‹åˆ›å»ºæ–‡ä»¶">è¿œç¨‹åˆ›å»ºæ–‡ä»¶</a></li>
        <li><a href="#åˆ›å»ºæ–‡ä»¶å¤¹">åˆ›å»ºæ–‡ä»¶å¤¹</a></li>
        <li><a href="#åˆ›å»ºæ–‡ä»¶ä¸”è®¾å®šæƒé™">åˆ›å»ºæ–‡ä»¶ä¸”è®¾å®šæƒé™</a></li>
        <li><a href="#è¿œç¨‹ä¿®æ”¹æ–‡ä»¶å±æ€§">è¿œç¨‹ä¿®æ”¹æ–‡ä»¶å±æ€§</a></li>
        <li><a href="#åˆ›å»ºè½¯è¿æ¥æ–‡ä»¶">åˆ›å»ºè½¯è¿æ¥æ–‡ä»¶</a></li>
        <li><a href="#å¼ºåˆ¶æ€§åˆ›å»ºæ–‡ä»¶è½¯è¿æ¥">å¼ºåˆ¶æ€§åˆ›å»ºæ–‡ä»¶ï¼ˆè½¯è¿æ¥ï¼‰</a></li>
        <li><a href="#ä¿®æ”¹å·²å­˜åœ¨æ–‡ä»¶æ–‡ä»¶å¤¹çš„å±æ€§">ä¿®æ”¹å·²å­˜åœ¨æ–‡ä»¶/æ–‡ä»¶å¤¹çš„å±æ€§</a></li>
        <li><a href="#å…³äºfileæ¨¡å—çš„æ‰€æœ‰å‚æ•°ä½œç”¨">å…³äºfileæ¨¡å—çš„æ‰€æœ‰å‚æ•°ä½œç”¨</a></li>
        <li><a href="#å…³äºfileæ¨¡å—çš„å®ä¾‹ç”¨æ³•">å…³äºfileæ¨¡å—çš„å®ä¾‹ç”¨æ³•</a></li>
      </ol>
    </li>
    <li><a href="#46-scriptè„šæœ¬æ¨¡å—">4.6 scriptè„šæœ¬æ¨¡å—</a>
      <ol>
        <li><a href="#scriptsæ¨¡å—çš„åŠŸèƒ½å‚æ•°">scriptsæ¨¡å—çš„åŠŸèƒ½å‚æ•°</a></li>
        <li><a href="#è¿œç¨‹åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œè„šæœ¬">è¿œç¨‹åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œè„šæœ¬</a></li>
        <li><a href="#æŸ¥çœ‹å‘½ä»¤æ‰§è¡Œè¯¦ç»†è¿‡ç¨‹">æŸ¥çœ‹å‘½ä»¤æ‰§è¡Œè¯¦ç»†è¿‡ç¨‹</a></li>
      </ol>
    </li>
    <li><a href="#47-cronå®šæ—¶ä»»åŠ¡æ¨¡å—">4.7 cronå®šæ—¶ä»»åŠ¡æ¨¡å—</a>
      <ol>
        <li><a href="#å¯¹æ¯”ansibleçš„cronæ¨¡å—ä»¥åŠcrontab">å¯¹æ¯”ansibleçš„cronæ¨¡å—ä»¥åŠcrontab</a></li>
        <li><a href="#æ·»åŠ ntpdateå®šæ—¶ä»»åŠ¡">æ·»åŠ ntpdateå®šæ—¶ä»»åŠ¡</a></li>
        <li><a href="#åˆ é™¤å®šæ—¶ä»»åŠ¡">åˆ é™¤å®šæ—¶ä»»åŠ¡</a></li>
        <li><a href="#åˆ›å»ºæ¯åˆ†é’Ÿæ‰§è¡Œçš„ä»»åŠ¡">åˆ›å»ºæ¯åˆ†é’Ÿæ‰§è¡Œçš„ä»»åŠ¡</a></li>
        <li><a href="#ä¿®æ”¹æŒ‡å®šåç§°çš„å®šæ—¶ä»»åŠ¡">ä¿®æ”¹æŒ‡å®šåç§°çš„å®šæ—¶ä»»åŠ¡</a></li>
      </ol>
    </li>
    <li><a href="#48-groupæ¨¡å—">4.8 groupæ¨¡å—</a>
      <ol>
        <li><a href="#åˆ›å»ºbaizhi_opsç»„gid1234">åˆ›å»ºbaizhi_opsç»„ï¼Œgid=1234</a></li>
        <li><a href="#åˆ é™¤ç»„">åˆ é™¤ç»„</a></li>
      </ol>
    </li>
    <li><a href="#49-userç”¨æˆ·æ¨¡å—">4.9 userç”¨æˆ·æ¨¡å—</a>
      <ol>
        <li><a href="#è¯­æ³•å‚æ•°">è¯­æ³•å‚æ•°</a></li>
        <li><a href="#åˆ›å»ºbaizhi001ç”¨æˆ·uidä¸º8888">åˆ›å»ºbaizhi001ç”¨æˆ·ï¼Œuidä¸º8888</a></li>
        <li><a href="#åˆ›å»ºç”¨æˆ·cc01">åˆ›å»ºç”¨æˆ·cc01</a></li>
      </ol>
    </li>
    <li><a href="#410-yumå®‰è£…è½¯ä»¶">4.10 yumå®‰è£…è½¯ä»¶</a>
      <ol>
        <li><a href="#å®˜ç½‘æ–‡æ¡£ç¤ºä¾‹ç”¨æ³•">å®˜ç½‘æ–‡æ¡£ç¤ºä¾‹ç”¨æ³•</a></li>
        <li><a href="#å®‰è£…net-toolsæœ€æ–°ç‰ˆæœ¬">å®‰è£…net-toolsæœ€æ–°ç‰ˆæœ¬</a></li>
        <li><a href="#å¸è½½net-toolsè½¯ä»¶">å¸è½½net-toolsè½¯ä»¶</a></li>
        <li><a href="#å®‰è£…rsyncæœåŠ¡">å®‰è£…rsyncæœåŠ¡</a></li>
        <li><a href="#å¸è½½rsyncæœåŠ¡">å¸è½½rsyncæœåŠ¡</a></li>
      </ol>
    </li>
    <li><a href="#411-servicesystemdæ¨¡å—">4.11 service/systemdæ¨¡å—</a>
      <ol>
        <li><a href="#systemdæ¨¡å—å‚æ•°">systemdæ¨¡å—å‚æ•°</a></li>
        <li><a href="#å®‰è£…å¯åŠ¨nginxæœåŠ¡">å®‰è£…ã€å¯åŠ¨nginxæœåŠ¡</a></li>
      </ol>
    </li>
    <li><a href="#412-mountæŒ‚è½½æ¨¡å—">4.12 mountæŒ‚è½½æ¨¡å—</a>
      <ol>
        <li><a href="#åœ¨nfs-31æœºå™¨å‡†å¤‡nfs">åœ¨nfs-31æœºå™¨å‡†å¤‡nfs</a></li>
        <li><a href="#ç»™web-7æœºå™¨æŒ‚è½½nfsç›®å½•åªå†™å…¥etcfstabè€Œä¸ç«‹å³æŒ‚è½½">ç»™web-7æœºå™¨æŒ‚è½½nfsç›®å½•ï¼ˆåªå†™å…¥/etc/fstabè€Œä¸ç«‹å³æŒ‚è½½ï¼‰</a></li>
        <li><a href="#ç»™web-7æœºå™¨æŒ‚è½½nfsç›®å½•ç«‹å³æŒ‚è½½ä¸”å†™å…¥etcfstab">ç»™web-7æœºå™¨æŒ‚è½½nfsç›®å½•ï¼ˆç«‹å³æŒ‚è½½ä¸”å†™å…¥/etc/fstabï¼‰</a></li>
        <li><a href="#å–æ¶ˆæŒ‚è½½ä»¥åŠåˆ é™¤fstabè®°å½•">å–æ¶ˆæŒ‚è½½ï¼Œä»¥åŠåˆ é™¤fstabè®°å½•</a></li>
        <li><a href="#å–æ¶ˆæŒ‚è½½ä¸åˆ é™¤fstabè®°å½•">å–æ¶ˆæŒ‚è½½ï¼Œä¸åˆ é™¤fstabè®°å½•</a></li>
        <li><a href="#stateæ€»ç»“å‚æ•°">stateæ€»ç»“å‚æ•°</a></li>
      </ol>
    </li>
    <li><a href="#413-archiveå‹ç¼©æ¨¡å—">4.13 archiveå‹ç¼©æ¨¡å—</a>
      <ol>
        <li><a href="#æ”¯æŒå‹ç¼©ç±»å‹">æ”¯æŒå‹ç¼©ç±»å‹</a></li>
        <li><a href="#å‹ç¼©etcé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„">å‹ç¼©/etcé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„</a></li>
        <li><a href="#å‹ç¼©varlogä¸ºzipç±»å‹åˆ°æŒ‡å®šè·¯å¾„">å‹ç¼©/var/logä¸ºzipç±»å‹åˆ°æŒ‡å®šè·¯å¾„</a></li>
      </ol>
    </li>
    <li><a href="#414-unarchiveè§£å‹ç¼©æ¨¡å—">4.14 unarchiveè§£å‹ç¼©æ¨¡å—</a>
      <ol>
        <li><a href="#è§£å‹ç¼©etctgzåˆ°æŒ‡å®šç›®å½•è¿œç¨‹è§£å‹">è§£å‹ç¼©etc.tgzåˆ°æŒ‡å®šç›®å½•ï¼ˆè¿œç¨‹è§£å‹ï¼‰</a></li>
        <li><a href="#å°†ç®¡ç†æœºçš„å‹ç¼©åŒ…è§£å‹åˆ°è¿œç¨‹æœºå™¨ä¸Š">å°†ç®¡ç†æœºçš„å‹ç¼©åŒ…ï¼Œè§£å‹åˆ°è¿œç¨‹æœºå™¨ä¸Š</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/">AnsibleåŸºç¡€</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-04-14</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="å‰è¨€">å‰è¨€
</h1><p>å­¦ansibleï¼ŒåŸºç¡€ç¯‡å°±æ˜¯ä¸€ä»¶äº‹</p>
<ul>
<li>å­¦å„ç§æ¨¡å—çš„è¯­æ³•ï¼Œå‚æ•°</li>
<li>ç”±äºæ¨¡å—è¾ƒå¤šï¼Œå‚æ•°è¾ƒå¤šï¼Œéœ€è¦åšå¥½ç¬”è®°ï¼Œä»¥åŠä¸€å®šçš„èƒŒè¯µï¼Œæ•²æ‰“å»ºè®®è®°å¿†</li>
</ul>
<p>åŸºç¡€ç¯‡å­¦ä¹ è·¯çº¿</p>
<ul>
<li>1.ä¸»æœºæ¸…å•è¯­æ³•ï¼Œå­¦ä¼šå¦‚ä½•æ‰¹é‡ç®¡ç†æœåŠ¡å™¨ç»„ï¼Œé…ç½®æœåŠ¡å™¨è®¤è¯ï¼ŒæœåŠ¡å™¨å˜é‡</li>
<li>2.å­¦ä¹ å¸¸è§çš„æ¨¡å—ï¼Œè¯­æ³•ï¼Œå‚æ•°ï¼Œç”¨æ³•</li>
<li>3.æ”¹é€ shellè„šæœ¬ä¸ºansibleæ¨¡å—</li>
</ul>
<h1 id="è‡ªåŠ¨åŒ–è¿ç»´å¥½å¤„">è‡ªåŠ¨åŒ–è¿ç»´å¥½å¤„
</h1><ul>
<li>æé«˜å·¥ä½œæ•ˆç‡ï¼Œå‡å°‘é‡å¤æ€§å·¥ä½œ</li>
<li>å¤§å¤§å‡å°‘äººä¸ºå‡ºé”™çš„å¯èƒ½æ€§</li>
<li>æ•°æ®åŒ–ç®¡ç†ã€æ•°æ®åŒ–æ±‡æŠ¥ã€é—®é¢˜å¯è¿½æº¯</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ansible
</span></span><span class="line"><span class="cl">saltstack
</span></span><span class="line"><span class="cl">è¿™ä¿©è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·å‡ä¸ºpythonç¼–å†™
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¾‹å¦‚ï¼š
</span></span><span class="line"><span class="cl">master-61æœºå™¨ï¼Œç®¡ç†äº†100å°ç›®æ ‡æœºå™¨
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å¦‚æœä½¿ç”¨shellè„šæœ¬ï¼Œå°±éœ€è¦ç»“åˆforå¾ªç¯å¤„ç†è¿™100ä¸ªæœºå™¨ï¼Œå­˜åœ¨çš„é—®é¢˜å¦‚ä¸‹ï¼š
</span></span><span class="line"><span class="cl">free -m &gt; xxx.file
</span></span><span class="line"><span class="cl">cpuinfo
</span></span><span class="line"><span class="cl">shellï¼Œå‘½ä»¤å¯¼å‡ºçš„æ•°æ®å°±æ˜¯ä¸€å †æ™®é€šçš„æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œéš¾ä»¥åŠ å·¥å¤„ç†ï¼›ä½†æœ‰æ—¶å¸Œæœ›èƒ½å¯¼å‡ºä¸ºæ•°æ®äº¤æ¢æ ¼å¼ï¼Œå¦‚jsonã€å¦‚yamlã€å¦‚xmlç­‰ï¼Œå°±å¯ä»¥å¾ˆè½»æ¾çš„å‘ç»™å„ç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ç°æ•°æ®åŠ å·¥ï¼Œæ ¼å¼åŒ–å¤„ç†ï¼Œå‘ç»™å‰ç«¯å»åšç½‘é¡µå±•ç¤º
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä½¿ç”¨ansibleå‡ æ¡å‘½ä»¤å°±å¯ä»¥å®ç°äº†
</span></span><span class="line"><span class="cl">å¹¶ä¸”ansibleå¯¼å‡ºçš„æœåŠ¡å™¨ä¿¡æ¯ï¼Œå¦‚å†…å­˜ï¼Œç£ç›˜ï¼Œç½‘å¡ï¼Œç­‰ç­‰ä¸€å †ä¿¡æ¯ï¼Œå¯ä»¥ç›´æ¥å¯¼å‡ºä¸ºjsonæ•°æ®ï¼Œè€Œjsonæ•°æ®å°±å¯ä»¥ç›´æ¥å‘ç»™å‰ç«¯ï¼Œå‰ç«¯å°±å¯ä»¥å±•ç¤ºå‡ºæœåŠ¡å™¨çš„ä¿¡æ¯
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ç»¼ä¸Šï¼Œè¿™å°±æ˜¯è¿ç»´å¼€å‘åšçš„äº‹
</span></span><span class="line"><span class="cl">åç«¯python+ansibleè·å–æ•°æ®ï¼Œå¯¼å‡ºjsonï¼Œå‘ç»™å‰ç«¯
</span></span><span class="line"><span class="cl">å‰ç«¯å†™htmlï¼Œjsï¼Œå¯¹jsonæ•°æ®å±•ç¤º
</span></span><span class="line"><span class="cl">ä¸€ä¸ªè¿ç»´å¹³å°å°±æ­å»ºå‡ºæ¥äº†
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="å¦‚ä½•å­¦ä¹ ansible">å¦‚ä½•å­¦ä¹ ansible
</h1><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1.æ‰“å¼€ansibleå®˜ç½‘ï¼ŒæŸ¥çœ‹æ‰€æœ‰æœ€æ–°çš„åŠŸèƒ½ï¼Œä¸è¦çœ‹å…¶ä»–çš„æ–‡æ¡£ï¼Œå¯èƒ½å·²ç»å¾ˆé™ˆæ—§äº†ï¼Œpython3ä¹Ÿå·²ç»æ›´æ–°äº†å¾ˆå¤šï¼Œå¯¼è‡´ç”¨æ³•å˜åŒ–ç­‰ã€‚
</span></span><span class="line"><span class="cl">æœ€æ–°å®˜ç½‘æ–‡æ¡£ï¼š     https://zackmoel.github.io/hugo-dev/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">shellè„šæœ¬ï¼ˆnfsæœåŠ¡ã€rsyncæœåŠ¡ï¼‰ï¼Œå †ç Œäº†å„ç§éƒ¨ç½²çš„å‘½ä»¤
</span></span><span class="line"><span class="cl">â†“
</span></span><span class="line"><span class="cl">æŠŠè¿™ä¸ªè„šæœ¬ï¼Œæ‰€æœ‰çš„æ“ä½œï¼Œå…¨éƒ¨æ›¿æ¢ä¸ºansibleçš„æ¨¡å—
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.ä½ å¯èƒ½è¦æ‰§è¡Œçš„å„ç§å‘½ä»¤ï¼Œansibleéƒ½æä¾›äº†æ¨¡å—ï¼Œå¦‚æ–‡ä»¶æ‹·è´ï¼Œå¦‚è½¯ä»¶å®‰è£…ï¼ŒæœåŠ¡é‡å¯ç­‰ï¼›
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.ä½ ä½¿ç”¨ansibleï¼Œå¿…é¡»ä¸¥æ ¼æŒ‰ç…§ansibleæä¾›çš„è¯­æ³•æ¥ï¼Œå¦åˆ™åªæœ‰æŠ¥é”™
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.å…ˆå­¦è¯­æ³•ï¼Œè¯­æ³•åŸºæœ¬åŠŸæ‰å®åï¼Œé¢å¯¹åƒå˜ä¸‡åŒ–çš„éœ€æ±‚ï¼Œæ‰èƒ½æ¸¸åˆƒæœ‰ä½™
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5.å¤šåŠ¨æ‰‹ï¼Œansibleéœ€è¦è®°å¿†çš„æ“ä½œæ¯”è¾ƒå¤š
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="åˆè¯†ansibleå‘½ä»¤">åˆè¯†ansibleå‘½ä»¤ï¼š
</h1><p>å‘½ä»¤è¯­æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ansible ä¸»æœºç»„ -m æ¨¡å—å  [æ¨¡å—å‚æ•°]
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/pic/image-20220506094153857.png"
	width="3839"
	height="1336"
	srcset="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/pic/image-20220506094153857_hu2456948428469298153.png 480w, /xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/pic/image-20220506094153857_hu5902346363159738942.png 1024w"
	loading="lazy"
	
		alt="image-20220506094153857"
	
	
		class="gallery-image" 
		data-flex-grow="287"
		data-flex-basis="689px"
	
></p>
<h1 id="1ansibleå®‰è£…éƒ¨ç½²">1ã€ansibleå®‰è£…éƒ¨ç½²
</h1><h2 id="åœ¨master-61ç®¡ç†æœºå®‰è£…">åœ¨master-61ç®¡ç†æœºå®‰è£…
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#yum install epel-release ansible libselinux-python -y</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å‰æä½ é…ç½®å¥½äº†é˜¿é‡Œäº‘çš„epelæºå¯ä»¥ç›´æ¥å®‰è£…
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#yum install ansible -y </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible --version</span>
</span></span><span class="line"><span class="cl">ansible 2.9.27
</span></span><span class="line"><span class="cl">  config <span class="nv">file</span> <span class="o">=</span> /etc/ansible/ansible.cfg
</span></span><span class="line"><span class="cl">  configured module search <span class="nv">path</span> <span class="o">=</span> <span class="o">[</span>u<span class="s1">&#39;/root/.ansible/plugins/modules&#39;</span>, u<span class="s1">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  ansible python module <span class="nv">location</span> <span class="o">=</span> /usr/lib/python2.7/site-packages/ansible
</span></span><span class="line"><span class="cl">  executable <span class="nv">location</span> <span class="o">=</span> /usr/bin/ansible
</span></span><span class="line"><span class="cl">  python <span class="nv">version</span> <span class="o">=</span> 2.7.5 <span class="o">(</span>default, Apr <span class="m">11</span> 2018, 07:36:10<span class="o">)</span> <span class="o">[</span>GCC 4.8.5 <span class="m">20150623</span> <span class="o">(</span>Red Hat 4.8.5-28<span class="o">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…¶ä»–è¢«ç®¡ç†çš„æœºå™¨">å…¶ä»–è¢«ç®¡ç†çš„æœºå™¨
</h2><p>å‡†å¤‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">web-7
</span></span><span class="line"><span class="cl">web-8
</span></span><span class="line"><span class="cl">web-9
</span></span><span class="line"><span class="cl">nfs-31
</span></span><span class="line"><span class="cl">rsync-41
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¨éƒ¨åˆå§‹åŒ–ï¼Œè¿˜åŸsshdåŸæœ¬çš„é…ç½®å³å¯</p>
<p>å®‰è£…ansible</p>
<p>ç”¨äºå­¦ä¹ ansibleçš„ä¸»æœºè¿æ¥é…ç½®å‚æ•°</p>
<h2 id="ä¸»æœºæ¸…å•æ–‡ä»¶ä¸»æœºåˆ†ç»„">ä¸»æœºæ¸…å•æ–‡ä»¶ï¼ˆä¸»æœºåˆ†ç»„ï¼‰
</h2><p><a class="link" href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#inventory-basics-formats-hosts-and-groups"  target="_blank" rel="noopener"
    >https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#inventory-basics-formats-hosts-and-groups</a></p>
<p>æŠŠç»¼åˆæ¶æ„éœ€è¦ç”¨åˆ°çš„æœºå™¨ï¼Œè¿›è¡Œåˆ†ç»„</p>
<p>ä¸»æœºæ¸…å•é…ç½®æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#vim /etc/ansible/hosts </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>web<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.7
</span></span><span class="line"><span class="cl">172.16.1.8
</span></span><span class="line"><span class="cl">172.16.1.9
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>nfs<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.31
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>backup<span class="o">]</span>	
</span></span><span class="line"><span class="cl">172.16.1.41
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸»æœºåˆ†ç»„åï¼Œæ‰§è¡Œå‘½ä»¤æµ‹è¯•ï¼Œæ‰¹é‡ç®¡ç†ä¸€ç»„æœºå™¨ã€</p>
<p>ç®¡ç†æ‰€æœ‰çš„æœºå™¨ï¼Œä½¿ç”¨ç‰¹æ®Šä¸»æœºç»„ï¼Œall</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">è®©æ‰€æœ‰çš„ä¸»æœºï¼Œè¿œç¨‹æ‰§è¡Œhostnameï¼Œè¿”å›ä¸»æœºåä¿¡æ¯
</span></span><span class="line"><span class="cl">[root@master-61 ~]#ansible all -m shell -a &#34;hostname&#34;
</span></span><span class="line"><span class="cl">ä½†æ˜¯é»˜è®¤æ²¡é…ç½®è®¤è¯æ–¹å¼ï¼Œæƒé™è¢«æ‹’ç»ï¼š
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/image-20240510094514125.png"
	width="1135"
	height="607"
	srcset="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/image-20240510094514125_hu12994008662289641402.png 480w, /xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/image-20240510094514125_hu10901028134512292044.png 1024w"
	loading="lazy"
	
		alt="image-20240510094514125"
	
	
		class="gallery-image" 
		data-flex-grow="186"
		data-flex-basis="448px"
	
></p>
<h1 id="2ansibleä¸»æœºç™»å½•è®¤è¯">2ã€ansibleä¸»æœºç™»å½•è®¤è¯
</h1><p>Ansibleæ‰¹é‡ç®¡ç†ä¸»æœºæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>ä¼ ç»Ÿçš„å¯†ç è®¤è¯</li>
<li>å…¬é’¥è®¤è¯</li>
</ul>
<h2 id="ansibleåŸºäºå…¬ç§é’¥è®¤è¯">ansibleåŸºäºå…¬ç§é’¥è®¤è¯
</h2><p>1.å°†master61æœºå™¨çš„å…¬é’¥ï¼Œåˆ†å‘ç»™æƒ³å…å¯†ç™»å½•çš„æœºå™¨</p>
<p>2.åç»­åœ¨å¯¹è¯¥æœºå™¨æ“ä½œï¼Œå°±ç›´æ¥è¿›è¡Œsshçš„å…¬é’¥è®¤è¯äº†ï¼Œå¯ä»¥å…å¯†ç ï¼Œç›´æ¥è¿œç¨‹æ‰§è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.é…ç½®å¥½master-61å…å¯†ç™»å½•31æœºå™¨
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ssh-keygen</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ssh-copy-id root@172.16.1.31</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.åç»­å¯ä»¥å…å¯†æ‰§è¡Œansibleçš„å„ç§æ¨¡å—äº†
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs -m command -a &#34;hostname&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä½ å¯ä»¥é…ç½®æ‰€æœ‰æœºå™¨çš„å…¬é’¥ä¸€é”®åˆ†å‘ï¼Œå°±å¯ä»¥å®ç°allæ‰€æœ‰ä¸»æœºçš„è¿œç¨‹å‘½ä»¤æ‰§è¡Œ
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible all -m shell &#34;hostname&#34; # è¿”å›ç»“æœç»™master-61æœºå™¨</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åŸºäºå¯†ç è®¤è¯">åŸºäºå¯†ç è®¤è¯
</h2><ul>
<li>åœ¨ä½ çš„å®¢æˆ·ç«¯æœºå™¨ã€ä¿®æ”¹äº†sshé»˜è®¤ç«¯å£ã€ä»¥åŠå¯†ç éœ€è¦ä¿®æ”¹ä¸»æœºæ¸…å•æ–‡ä»¶æ‰å¯ä»¥æ­£ç¡®è¿æ¥ã€‚</li>
<li>æ³¨æ„ä½ å¾—é…ç½®å…è®¸å¯†ç ç™»å½•æ‰èƒ½è¿›è¡Œå¦‚ä¸‹æµ‹è¯•ï¼Œå¯ä»¥å†å¼€ä¸€ä¸ªweb-9æœºå™¨ã€‚</li>
</ul>
<h2 id="ansibleä¸»æœºæ¸…å•é…ç½®æ–‡ä»¶è¯­æ³•é‡è¦">ansibleä¸»æœºæ¸…å•é…ç½®æ–‡ä»¶è¯­æ³•ï¼ˆé‡è¦ï¼‰
</h2><p>å®˜ç½‘åœ°å€ï¼š</p>
<p><a class="link" href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#connecting-to-hosts-behavioral-inventory-parameters"  target="_blank" rel="noopener"
    >https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#connecting-to-hosts-behavioral-inventory-parameters</a></p>
<p>å¯é€‰å‚æ•°ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å‚æ•°ç±»å‹</th>
<th>å‚æ•°è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>ansible_host</td>
<td>ä¸»æœºåœ°å€</td>
<td>è¿œç¨‹ä¸»æœºip</td>
</tr>
<tr>
<td>ansible_port</td>
<td>ä¸»æœºç«¯å£</td>
<td>è®¾ç½®SSHè¿æ¥ç«¯å£ï¼Œé»˜è®¤22</td>
</tr>
<tr>
<td>ansible_user</td>
<td>ä¸»æœºç”¨æˆ·</td>
<td>é»˜è®¤SSHè¿œç¨‹è¿æ¥çš„ç”¨æˆ·èº«ä»½ï¼Œé»˜è®¤root</td>
</tr>
<tr>
<td>ansible_password</td>
<td>ç”¨æˆ·å¯†ç </td>
<td>æŒ‡å®šSSHè¿œç¨‹ä¸»æœºå¯†ç </td>
</tr>
</tbody>
</table></div>
<h2 id="ç»™rsyncæœºå™¨è¿›è¡Œå¯†ç è®¤è¯">ç»™rsyncæœºå™¨ï¼Œè¿›è¡Œå¯†ç è®¤è¯
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ç¼–è¾‘ä¸»æœºæ¸…å•æ–‡ä»¶
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#vim /etc/ansible/hosts </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1.ç»™rsyncæœºå™¨ï¼Œæ·»åŠ å¯†ç ï¼Œç«¯å£ç­‰ä¿¡æ¯
</span></span><span class="line"><span class="cl"><span class="o">[</span>backup<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.41  <span class="nv">ansible_port</span><span class="o">=</span><span class="m">22</span>  <span class="nv">ansible_password</span><span class="o">=</span><span class="s1">&#39;123123&#39;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.å¦‚æœç›®æ ‡æœºå™¨çš„sshä¿¡æ¯éƒ½è¢«æ”¹äº†ï¼Œè¿™é‡Œä¹Ÿå¾—æ”¹
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@rsync-41 ~<span class="o">]</span><span class="c1">#vi /etc/ssh/sshd_config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>backup<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.41  <span class="nv">ansible_port</span><span class="o">=</span><span class="m">22999</span>  <span class="nv">ansible_password</span><span class="o">=</span><span class="s1">&#39;123123&#39;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•æ‰§è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible backup -m ping</span>
</span></span><span class="line"><span class="cl">172.16.1.41 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: false, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ·»åŠ webæœºå™¨ç»„çš„ä¿¡æ¯">æ·»åŠ webæœºå™¨ç»„çš„ä¿¡æ¯
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#vim /etc/ansible/hosts </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>web<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.7 <span class="nv">ansible_port</span><span class="o">=</span><span class="m">22999</span> <span class="nv">ansible_user</span><span class="o">=</span>root <span class="nv">ansible_password</span><span class="o">=</span><span class="m">123123</span>
</span></span><span class="line"><span class="cl">172.16.1.8 <span class="nv">ansible_port</span><span class="o">=</span><span class="m">22999</span> <span class="nv">ansible_user</span><span class="o">=</span>root <span class="nv">ansible_password</span><span class="o">=</span><span class="m">123123</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>nfs<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.31
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>backup<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.41 <span class="nv">ansible_ssh_port</span><span class="o">=</span><span class="m">22999</span> <span class="nv">ansible_ssh_user</span><span class="o">=</span>root <span class="nv">ansible_ssh_pass</span><span class="o">=</span><span class="m">123123</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æµ‹è¯•æ‰§è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m ping</span>
</span></span><span class="line"><span class="cl">172.16.1.8 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: false, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">172.16.1.7 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: false, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ‹¿webæœºå™¨æµ‹è¯•å•ç‹¬æ“ä½œæŸä¸»æœº">æ‹¿webæœºå™¨æµ‹è¯•ï¼ˆå•ç‹¬æ“ä½œæŸä¸»æœºï¼‰
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.å…ˆé…ç½®ä¸»æœºç»„çš„å‚æ•°
</span></span><span class="line"><span class="cl"><span class="o">[</span>web<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.7 <span class="nv">ansible_port</span><span class="o">=</span><span class="m">22999</span> <span class="nv">ansible_password</span><span class="o">=</span><span class="s1">&#39;123123&#39;</span>
</span></span><span class="line"><span class="cl">172.16.1.8 <span class="nv">ansible_port</span><span class="o">=</span><span class="m">22999</span> <span class="nv">ansible_password</span><span class="o">=</span><span class="s1">&#39;123123&#39;</span>
</span></span><span class="line"><span class="cl">172.16.1.9 <span class="nv">ansible_port</span><span class="o">=</span><span class="m">22999</span> <span class="nv">ansible_password</span><span class="o">=</span><span class="s1">&#39;123123&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.æ‰§è¡Œpingæ¨¡å—ï¼Œçœ‹ä¸‹æ˜¯å¦å’Œè¿œç¨‹ä¸»æœºé€šä¿¡
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible  web -m ping</span>
</span></span><span class="line"><span class="cl">172.16.1.7 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: false, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">172.16.1.9 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: false, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">172.16.1.8 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: false, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æŒ‡çº¹æ•…éšœè§£å†³">æŒ‡çº¹æ•…éšœè§£å†³
</h4><p>ä½ å¯èƒ½ä¼šé‡è§å¦‚ä¸‹é—®é¢˜ï¼Œå…³äºæ–°æœºå™¨çš„<strong>æŒ‡çº¹ç¡®è®¤</strong>é—®é¢˜ã€‚</p>
<p><img src="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/image-20240510155811488.png"
	width="1575"
	height="85"
	srcset="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/image-20240510155811488_hu13786837463817608804.png 480w, /xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/image-20240510155811488_hu8917252128851260123.png 1024w"
	loading="lazy"
	
		alt="image-20240510155811488"
	
	
		class="gallery-image" 
		data-flex-grow="1852"
		data-flex-basis="4447px"
	
></p>
<p>è§£å†³åŠæ³•1ï¼Œæ‰‹åŠ¨sshè¿æ¥ï¼Œè¿›è¡ŒæŒ‡çº¹ç¡®è®¤ï¼Œå†™å…¥åˆ°æœ¬æœºçš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#cat ~/.ssh/known_hosts</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§£å†³åŠæ³•2ï¼Œansibleé…ç½®æ–‡ä»¶ä¸­å¿½ç•¥æŒ‡çº¹ç¡®è®¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#grep &#39;host_key_checking&#39; /etc/ansible/ansible.cfg </span>
</span></span><span class="line"><span class="cl"><span class="nv">host_key_checking</span> <span class="o">=</span> False
</span></span></code></pre></td></tr></table>
</div>
</div><p>é—®é¢˜ä»¥åŠè§£å†³ï¼Œå¯ä»¥æ­£ç¡®æ“ä½œweb-9æœºå™¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible 172.16.1.9 -m ping</span>
</span></span><span class="line"><span class="cl">172.16.1.9 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: false, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è¸©å‘è®°å½•ansibleç¼“å­˜">è¸©å‘è®°å½•(ansibleç¼“å­˜)
</h4><p>ç”±äºansibleåœ¨å¯¹è¿œç¨‹ä¸»æœºæ“ä½œä¹‹å‰ï¼Œé»˜è®¤ä¼šå…ˆé€šè¿‡setupæ¨¡å—è·å–æœºå™¨çš„factsï¼ˆé™æ€å±æ€§ï¼‰ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆç¼“å­˜ï¼Œä¾¿äºåŠ é€Ÿè¿œç¨‹ä¸»æœºçš„æ“ä½œï¼›</p>
<p>ä½†ç¼“å­˜ä¹Ÿä¼šå¯¼è‡´ä¸€äº›å¥‡æ€ªçš„ç°è±¡ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯çš„æœºå™¨ä¿¡æ¯æ›´æ–°äº†ï¼ŒæœåŠ¡ç«¯ä¾æ—§ä½¿ç”¨çš„æ˜¯æ—§æ•°æ®ï¼Œé‚£å°±ä¸å‡†ç¡®äº†ï¼Œå› æ­¤å¯ä»¥åˆ é™¤ç¼“å­˜ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">å…³äºç¼“å­˜å¯¼è‡´bugçš„æ–‡ç« ï¼Œhttps://serverfault.com/questions/630253/ansible-stuck-on-gathering-facts
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ¸…ç†ansibleçš„ç¼“å­˜ç›®å½•å³å¯
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#rm -rf ~/.ansible/cp/*</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="åŒä¸€ç»„è¿ç»­çš„ip">åŒä¸€ç»„è¿ç»­çš„ip
</h4><p>å¯ä»¥ä¿®æ”¹ä¸»æœºæ¸…å•æ–‡ä»¶å¦‚ä¸‹ï¼Œå‰ææ˜¯è¯¥äº›ä¸»æœºçš„é…ç½®ä¸€è‡´</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>web<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.<span class="o">[</span>7:9<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å…¬å…±å˜é‡">å…¬å…±å˜é‡
</h4><p>å½“ä¸»æœºæ¸…å•é‡Œï¼Œå¾ˆå¤šä¸»æœºç»„ï¼Œæœ‰ç›¸åŒçš„å˜é‡å±æ€§ï¼Œå¯ä»¥å†™æˆå…¬å…±å˜é‡</p>
<p>è¿™éƒ¨åˆ†é…ç½®æ˜¯é’ˆå¯¹webä¸»æœºç»„ï¼ŒæŠ½è±¡çš„å˜é‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#grep -vE &#39;^#|^$&#39; /etc/ansible/hosts </span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>web:vars<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">ansible_ssh_port</span><span class="o">=</span><span class="m">22999</span>
</span></span><span class="line"><span class="cl"><span class="nv">ansible_ssh_user</span><span class="o">=</span>root
</span></span><span class="line"><span class="cl"><span class="nv">ansible_ssh_pass</span><span class="o">=</span><span class="m">123123</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>web<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.<span class="o">[</span>7:9<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>nfs<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.31 <span class="nv">ansible_ssh_port</span><span class="o">=</span><span class="m">22999</span> 
</span></span><span class="line"><span class="cl"><span class="o">[</span>backup<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.41 <span class="nv">ansible_ssh_port</span><span class="o">=</span><span class="m">22999</span> <span class="nv">ansible_ssh_user</span><span class="o">=</span>root <span class="nv">ansible_ssh_pass</span><span class="o">=</span><span class="m">123123</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æµ‹è¯•webç»„å’Œbackupç»„æ˜¯å¦å¯ç”¨">æµ‹è¯•webç»„å’Œbackupç»„æ˜¯å¦å¯ç”¨
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m ping</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible backup -m shell -a &#34;ls /opt/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m shell -a hostname</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ‰€æœ‰ä¸»æœºéƒ½ç”Ÿæ•ˆçš„å˜é‡äº†è§£">æ‰€æœ‰ä¸»æœºéƒ½ç”Ÿæ•ˆçš„å˜é‡ã€äº†è§£ã€‘
</h4><p>æŒ‡å®šä¸»æœºç»„åallï¼Œå³å¯é’ˆå¯¹æ‰€æœ‰ä¸»æœºç”Ÿæ•ˆï¼Œå‰ææ˜¯ï¼Œä½ è¦ç¡®ä¿è¿™ä¸ªä¿¡æ¯æ˜¯æ‰€æœ‰ä¸»æœºé€šç”¨çš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#grep -vE &#39;^#|^$&#39; /etc/ansible/hosts </span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>all:vars<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">ansible_port</span><span class="o">=</span><span class="m">22999</span>
</span></span><span class="line"><span class="cl"><span class="c1">#ansible_user=root</span>
</span></span><span class="line"><span class="cl"><span class="c1">#ansible_password=123456</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>web<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.7
</span></span><span class="line"><span class="cl">172.16.1.8
</span></span><span class="line"><span class="cl">172.16.1.9
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>nfs<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.31
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>backup<span class="o">]</span>
</span></span><span class="line"><span class="cl">172.16.1.41
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿œç¨‹æ‰§è¡Œå‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#rm -rf ~/.ansible/cp/*</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible all -m shell -a hostname</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible all -m shell -a hostname</span>
</span></span><span class="line"><span class="cl">172.16.1.31 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">nfs-31
</span></span><span class="line"><span class="cl">172.16.1.8 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">web-8
</span></span><span class="line"><span class="cl">172.16.1.41 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">rsync-41
</span></span><span class="line"><span class="cl">172.16.1.7 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">web-7
</span></span><span class="line"><span class="cl">172.16.1.9 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">web-9
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="3ansibleå‘½ä»¤æ‰§è¡Œæ–¹å¼">3ã€ansibleå‘½ä»¤æ‰§è¡Œæ–¹å¼
</h1><p>Ansibleå®ç°æ‰¹é‡ç®¡ç†ä¸»æœºçš„æ¨¡å¼ä¸»è¦æœ‰ä¿©ï¼š</p>
<ul>
<li>åˆ©ç”¨ansibleå‘½ä»¤å®ç°æ‰¹é‡ç®¡ç†ï¼ˆad-hocï¼‰æ¨¡å¼</li>
<li>åˆ©ç”¨ansibleå‰§æœ¬å®ç°æ‰¹é‡ç®¡ç†ï¼ˆplaybookï¼‰æ¨¡å¼</li>
</ul>
<p>Ad-hocå’Œplaybookçš„å…³ç³»å°±å¥½æ¯”shellå‘½ä»¤ä¸shell scriptsçš„å…³ç³»</p>
<h2 id="ad-hocæ¨¡å¼">ad-hocæ¨¡å¼
</h2><p>Ansibleçš„ad-hocæ¨¡å¼ä¹Ÿå°±æ˜¯ansibleçš„å‘½ä»¤è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼é€šå¸¸ç”¨æ¥ä¸´æ—¶å¤„ç†ä¸€äº›ä»»åŠ¡ã€‚ä¾‹å¦‚</p>
<ul>
<li>ä¸´æ—¶æ‰¹é‡æŸ¥çœ‹æ‰€æœ‰è¢«ç®¡æ§æœºå™¨çš„å†…å­˜ã€è´Ÿè½½ã€ç£ç›˜</li>
<li>ä¸´æ—¶æ‰¹é‡åˆ†å‘æŸä¸ªç‰¹å®šæ–‡ä»¶</li>
</ul>
<h2 id="playbookæ¨¡å¼">Playbookæ¨¡å¼
</h2><p>Ansibleçš„playbookæ¨¡å¼å°±æ˜¯é’ˆå¯¹ç‰¹å®šçš„å…·ä½“è¾ƒå¤§çš„ä»»åŠ¡ï¼Œäº‹å…ˆå†™å¥½æ‰§è¡Œå‰§æœ¬ï¼Œç„¶ååœ¨å…¶ä»–æœºå™¨ä¸Šæ‰¹é‡æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œå±äºå®šåˆ¶åŒ–çš„æ‰¹é‡æ‰§è¡Œä»»åŠ¡ï¼Œä¾‹å¦‚</p>
<ul>
<li>ä¸€é”®å®‰è£…Rsync</li>
<li>ä¸€é”®æ­å»ºLNMPé›†ç¾¤ç­‰</li>
</ul>
<h2 id="ansible-docå‘½ä»¤">ansible-docå‘½ä»¤
</h2><p>åˆ—å‡ºansibleæ‰€æœ‰æ”¯æŒçš„æ¨¡å—ï¼Œè¿™å°±æ˜¯ansibleè¿™ä¸ªä¸‡èƒ½å·¥å…·ç®±æ‰€æœ‰çš„é›¶ä»¶äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible-doc -l |grep ^ping</span>
</span></span><span class="line"><span class="cl">ping                                                          Try to connect to host, verify a usable python and re...
</span></span><span class="line"><span class="cl">pingdom                                                       Pause/unpause Pingdom alerts   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible-doc -l |grep ^shell</span>
</span></span><span class="line"><span class="cl">shell  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å½“å‰ansibleæ”¯æŒ3387ä¸ªæ¨¡å—
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible-doc -l |wc -l</span>
</span></span><span class="line"><span class="cl"><span class="m">3387</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“å‰ansibleæ”¯æŒçš„æ¨¡å—æ•°é‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible-doc -l |wc -l</span>
</span></span><span class="line"><span class="cl"><span class="m">3387</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹æŸä¸ªæ¨¡å—çš„å…·ä½“ç”¨æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible-doc -s shell</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible-doc -s ping</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="4ansibleæ ¸å¿ƒå†…å®¹æ¨¡å—å­¦ä¹ ">4ã€ansibleæ ¸å¿ƒå†…å®¹ï¼ˆæ¨¡å—å­¦ä¹ ï¼‰
</h1><h2 id="ansibleæ‰§è¡Œå‘½ä»¤ç»“æœçŠ¶æ€é¢œè‰²">ansibleæ‰§è¡Œå‘½ä»¤ç»“æœï¼ˆçŠ¶æ€é¢œè‰²ï¼‰
</h2><p>ä½ åç»­ä½¿ç”¨å„ç§æ¨¡å—æ“ä½œï¼Œä¼šæœ‰ä¸åŒçš„é¢œè‰²ç»“æœï¼Œéƒ½æ˜¯æœ‰æ„ä¹‰çš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">è¿ç»´è¿œç¨‹æ‰§è¡Œå‘½ä»¤ï¼Œæœ‰2ä¸ªæ–¹å¼
</span></span><span class="line"><span class="cl">shellè„šæœ¬ï¼Œè¿œç¨‹æ‰§è¡Œ
</span></span><span class="line"><span class="cl">ansibleæ¨¡å—ï¼Œè¿œç¨‹æ‰§è¡Œ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">shellè„šæœ¬ä¸å¤Ÿæ™ºèƒ½ï¼Œä¸ä¼šè®°å½•ä¸Šä¸€æ¬¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œä»¥åŠä¿®æ”¹çš„çŠ¶æ€ï¼Œå› æ­¤å¯¼è‡´ï¼Œå‚»ç“œå¼çš„ï¼Œé‡å¤æ€§æ‰§è¡Œã€‚æ•ˆç‡æ˜¯æå…¶ä½ä¸‹çš„ï¼Œä¸åšçŠ¶æ€è®°å½•
</span></span><span class="line"><span class="cl">ä¾‹å¦‚å®‰è£…è½¯ä»¶ï¼š
</span></span><span class="line"><span class="cl">shell   yum install  rsync<span class="p">;</span>  mkdir -p<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è€Œansibleçš„æ¨¡å—ï¼Œyumæ¨¡å—ä¼šè®°å½•æ‰§è¡Œçš„çŠ¶æ€
</span></span><span class="line"><span class="cl">ç¬¬ä¸€æ¬¡æ‰§è¡Œ,è£…å®Œä¹‹åï¼Œçš„ç¡®å¯¹ç›®æ ‡æœºå™¨äº§ç”Ÿäº†ä¿®æ”¹çš„çŠ¶æ€ï¼Œä¼šç»™master-61è¿”å›ä¸€ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œæ‰§è¡ŒçŠ¶æ€ï¼Œå­˜å‚¨ä¸‹æ¥
</span></span><span class="line"><span class="cl">ansible web -m yum -a <span class="s2">&#34;name=rsync  state=installed&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ansibleä¼šæ£€æµ‹ç›®æ ‡æœºå™¨ï¼Œå¯¹æ¯”è¿™ä¸ªçŠ¶æ€ï¼Œå¦‚æœçŠ¶æ€æ²¡å˜ï¼Œansibleå°±ä¸ä¼šå†æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå› æ­¤æ•ˆç‡å¾ˆé«˜
</span></span><span class="line"><span class="cl">ansible web -m yum -a <span class="s2">&#34;name=rsync  state=installed&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ansibleçš„çŠ¶æ€ï¼Œå°±æ˜¯å¦‚ä¸‹çš„é¢œè‰²åŒºåˆ†ï¼Œçœ‹åˆ°ä¸åŒçš„çŠ¶æ€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ç»¿è‰²ï¼šå‘½ä»¤ä»¥ç”¨æˆ·æœŸæœ›çš„æ‰§è¡Œäº†ï¼Œä½†æ˜¯çŠ¶æ€æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼›
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">é»„è‰²ï¼šå‘½ä»¤ä»¥ç”¨æˆ·æœŸæœ›çš„æ‰§è¡Œäº†ï¼Œå¹¶ä¸”çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ï¼›
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ç´«è‰²ï¼šè­¦å‘Šä¿¡æ¯ï¼Œè¯´æ˜ansibleæç¤ºä½ æœ‰æ›´åˆé€‚çš„ç”¨æ³•ï¼›å‡ºç°äº†warningè­¦å‘Š
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">çº¢è‰²ï¼šå‘½ä»¤é”™è¯¯ï¼Œæ‰§è¡Œå¤±è´¥ï¼›
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è“è‰²ï¼šè¯¦ç»†çš„æ‰§è¡Œè¿‡ç¨‹ï¼›
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å®˜ç½‘æ–‡æ¡£">å®˜ç½‘æ–‡æ¡£
</h2><p>ç½‘å€ï¼š<a class="link" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html#plugins-in-ansible-builtin"  target="_blank" rel="noopener"
    >Ansible.Builtin â€” Ansible Community Documentation</a></p>
<p>Ansibleè‡ªåŠ¨åŒ–è½¯ä»¶çš„æ ¸å¿ƒåŠŸèƒ½å°±åœ¨äºå…¶ä¼—å¤šçš„æ¨¡å—ï¼Œå¯ä»¥è¯´å­¦ä¹ Ansibleå°±æ˜¯å­¦ä¹ æ¨¡å—çš„ä½¿ç”¨ã€‚</p>
<p>å‰©ä½™çš„æ˜¯å¯¹Ansibleå‰§æœ¬ç¼–å†™çš„ç†Ÿç»ƒåº¦ã€‚</p>
<h2 id="41-pingæµ‹è¯•è¿é€šæ€§">4.1 pingæµ‹è¯•è¿é€šæ€§
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">é€šè¿‡master-61æŸ¥çœ‹ç›®æ ‡æœºå™¨æ˜¯å¦è¿è¡Œ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ansible all -m ping
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="link" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html#ansible-collections-ansible-builtin-ping-module"  target="_blank" rel="noopener"
    >https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html#ansible-collections-ansible-builtin-ping-module</a></p>
<p>æŸ¥çœ‹æ¨¡å—è§£é‡Š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible-doc -s ping</span>
</span></span><span class="line"><span class="cl">- name: Try to connect to host, verify a usable python and <span class="k">return</span> <span class="sb">`</span>pong<span class="s1">&#39; on success
</span></span></span><span class="line"><span class="cl"><span class="s1">  ping:
</span></span></span><span class="line"><span class="cl"><span class="s1">      data:                  # Data to return for the `ping&#39;</span> <span class="k">return</span> value. If this parameter is <span class="nb">set</span> to <span class="sb">`</span>crash<span class="err">&#39;</span>, the
</span></span><span class="line"><span class="cl">                               module will cause an exception.
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m ping</span>
</span></span><span class="line"><span class="cl">172.16.1.8 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: false, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">172.16.1.9 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: false, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">172.16.1.7 <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: false, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ping&#34;</span>: <span class="s2">&#34;pong&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="42-command-ç®€å•å‘½ä»¤æ¨¡å—">4.2 command ç®€å•å‘½ä»¤æ¨¡å—
</h2><p><a class="link" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html#ansible-collections-ansible-builtin-command-module"  target="_blank" rel="noopener"
    >https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html#ansible-collections-ansible-builtin-command-module</a></p>
<p>è¯­æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible-doc -s command</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ansible ä¸»æœºç»„ -m <span class="nb">command</span> -a <span class="s2">&#34;éœ€è¦æ‰¹é‡æ‰§è¡Œçš„å‘½ä»¤&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¥æ¨¡å—ä½œç”¨ï¼šåœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤</p>
<ul>
<li>commandæ¨¡å—æ˜¯ansibleé»˜è®¤çš„æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤å°±æŒ‡å®šäº† -m command</li>
<li>åªæ”¯æŒç®€å•å‘½ä»¤å‘½ä»¤æ‰§è¡Œï¼Œæ¯”å¦‚ä½ æƒ³è¿œç¨‹çœ‹ä¸‹æœåŠ¡å™¨çš„èµ„æºä¿¡æ¯ï¼Œæ™®é€šçš„linuxå‘½ä»¤</li>
</ul>
<p>commandæ¨¡å—æ˜¯ansibleå‘½ä»¤åŸºæœ¬æ¨¡å—ï¼Œæ— æ³•ä½¿ç”¨å¤æ‚çš„linuxå‘½ä»¤</p>
<ul>
<li>
<p>ä½¿ç”¨commandæ¨¡å—æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œå‘½ä»¤ä¸å¾—ç”¨å˜é‡ï¼ˆ$HOMEï¼‰</p>
</li>
<li>
<p>ä¸å¾—å‡ºç°ç‰¹æ®Šç¬¦å·</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt; ã€&gt;ã€|ã€ï¼›ã€&amp;
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="è¿œç¨‹æŸ¥çœ‹ä¸»æœºå">è¿œç¨‹æŸ¥çœ‹ä¸»æœºå
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m command -a &#34;hostname&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ç®€å†™ï¼š
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;hostname&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æŸ¥çœ‹è¿œç¨‹ä¸»æœºå†…å­˜">æŸ¥çœ‹è¿œç¨‹ä¸»æœºå†…å­˜
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;free -m&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¿œç¨‹åˆ›å»ºæ–‡ä»¶æŸ¥çœ‹æ–‡ä»¶">è¿œç¨‹åˆ›å»ºæ–‡ä»¶ã€æŸ¥çœ‹æ–‡ä»¶
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m command -a &#34;touch /opt/bbb.log&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m command -a &#34;cat /opt/bbb.log&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¿œç¨‹è·å–æœºå™¨è´Ÿè½½">è¿œç¨‹è·å–æœºå™¨è´Ÿè½½
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;uptime&#34;</span>
</span></span><span class="line"><span class="cl">172.16.1.9 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl"> 11:35:36 up <span class="m">3</span> days,  5:09,  <span class="m">2</span> users,  load average: 0.00, 0.01, 0.05
</span></span><span class="line"><span class="cl">172.16.1.7 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl"> 11:35:36 up  2:56,  <span class="m">2</span> users,  load average: 0.00, 0.01, 0.02
</span></span><span class="line"><span class="cl">172.16.1.8 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl"> 11:35:36 up  2:26,  <span class="m">2</span> users,  load average: 0.00, 0.01, 0.03
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å…³é—­å‘Šè­¦ä¿¡æ¯">å…³é—­å‘Šè­¦ä¿¡æ¯
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web  -m command -a &#34;touch /opt/ccc.log    warn=false&#34;</span>
</span></span><span class="line"><span class="cl">172.16.1.9 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">172.16.1.8 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">172.16.1.7 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åœ¨æ‰€æœ‰æœºå™¨ä¸Šåˆ›å»ºbaizhi01ç”¨æˆ·">åœ¨æ‰€æœ‰æœºå™¨ä¸Šï¼Œåˆ›å»ºbaizhi01ç”¨æˆ·
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m command -a &#34;useradd baizhi01&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä½¿ç”¨commandæä¾›çš„ä¸“æœ‰å‘½ä»¤">ä½¿ç”¨commandæä¾›çš„ä¸“æœ‰å‘½ä»¤
</h3><p>è¿™äº›å‘½ä»¤ç”¨äºç¼–å†™ansible-playbookï¼Œå®ŒæˆæœåŠ¡å™¨éƒ¨ç½²çš„å„ç§å¤æ‚æ¡ä»¶é™å®šã€‚</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>é€‰é¡¹å‚æ•°</th>
<th>é€‰é¡¹è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>chdir</td>
<td>åœ¨æ‰§è¡Œå‘½ä»¤æ‰§è¡Œï¼Œé€šè¿‡cdå‘½ä»¤è¿›å…¥æŒ‡å®šç›®å½•</td>
</tr>
<tr>
<td>creates</td>
<td>å®šä¹‰ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™è¿è¡Œç›¸åº”å‘½ä»¤ï¼›å­˜åœ¨åˆ™è·³è¿‡</td>
</tr>
<tr>
<td>free_formï¼ˆå¿…é¡»ï¼‰</td>
<td>å‚æ•°ä¿¡æ¯ä¸­å¯ä»¥è¾“å…¥ä»»ä½•ç³»ç»Ÿå‘½ä»¤ï¼Œå®ç°è¿œç¨‹ç®¡ç†</td>
</tr>
<tr>
<td>removes</td>
<td>å®šä¹‰ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿è¡Œç›¸åº”å‘½ä»¤ï¼›å¦‚æœä¸å­˜åœ¨åˆ™è·³è¿‡</td>
</tr>
</tbody>
</table></div>
<ul>
<li>å¤‡ä»½/var/logæ—¥å¿—ç›®å½•ï¼Œéœ€è¦å…ˆè¿›å…¥æ ¹ç›®å½•</li>
</ul>
<p><code>cd / &amp;&amp; tar -zcvf /opt/log.tgz   /var/log</code></p>
<p>æ³¨æ„ä½ å¤‡ä»½æ–‡ä»¶å­˜æ”¾çš„æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m command -a &#34;tar -zcf /opt/log.tgz   /var/log   chdir=/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;ls -l /opt&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>åœ¨/optä¸‹åˆ›å»ºbaizhi666.log</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">åŸå†™æ³•ï¼š
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible  web -a &#34;touch /opt/chaoge666.log&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;touch chaoge666.log  chdir=/opt&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å¤‡ä»½/etcæ‰€æœ‰é…ç½®æ–‡ä»¶åˆ° /backup_config/etc.tgz ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;tar -zcf /backup_config/etc.tgz etc chdir=/&#34;</span>
</span></span><span class="line"><span class="cl">ç›®æ ‡ç›®å½•ä¸å­˜åœ¨åˆ™ä¼šæŠ¥é”™
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>removeså‘½ä»¤</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.è¿™é‡Œå°±å¾—æå‰è€ƒè™‘ /backup_configæ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œå¿…é¡»å…ˆæœ‰æ–‡ä»¶å¤¹ï¼Œæ‰èƒ½æ‰§è¡Œè¯¥å¤‡ä»½å‘½ä»¤
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.åˆ¤æ–­å¦‚æœè¯¥æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œå¤‡ä»½
</span></span><span class="line"><span class="cl">ç›®æ ‡æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œè¿™ä¸ªå‘½ä»¤ä¸ä¼šå¯¹ç›®æ ‡æœºå™¨äº§ç”Ÿä»»ä½•ä¿®æ”¹ï¼Œå› æ­¤ç»¿è‰²ç»“æœ
</span></span><span class="line"><span class="cl">ansible web -a <span class="s2">&#34;tar -zcf /backup_config/etc.tgz   etc chdir=/  removes=/backup_config&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.ä½ å¿…é¡»å…ˆåˆ›å»ºè¯¥æ–‡ä»¶å¤¹
</span></span><span class="line"><span class="cl">ansible web -a <span class="s2">&#34;mkdir -p /backup_config&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.å†æ¬¡æ‰§è¡Œè¯¥å‘½ä»¤
</span></span><span class="line"><span class="cl">ansible web -a <span class="s2">&#34;tar -zcf /backup_config/etc.tgz   etc chdir=/  removes=/backup_config&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æµ‹è¯•createså‘½ä»¤ï¼Œå¦‚æœç›®æ ‡ç›®å½•å·²ç»å­˜åœ¨äº†ï¼Œå°±åˆ«åˆ›å»ºè¯¥ç›®å½•äº†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible backup -m command -a &#39;mkdir /opt creates=/opt&#39;</span>
</span></span><span class="line"><span class="cl">172.16.1.41 <span class="p">|</span> SUCCESS <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">skipped, since /opt exists
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="43-shellæ¨¡å—ä¸‡èƒ½æ¨¡å—">4.3 shellæ¨¡å—ï¼ˆä¸‡èƒ½æ¨¡å—ï¼‰
</h2><p>shellæ¨¡å—åŠŸèƒ½ï¼šåœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ï¼ˆå¤æ‚çš„å‘½ä»¤ï¼‰</p>
<p><a class="link" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html#ansible-collections-ansible-builtin-shell-module"  target="_blank" rel="noopener"
    >https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html#ansible-collections-ansible-builtin-shell-module</a></p>
<p>ä¹Ÿå°±æ˜¯ç­‰äºä½ åœ¨linuxä¸Šç›´æ¥æ‰§è¡Œä»»ä½•å¤æ‚çš„å‘½ä»¤éƒ½å¯ä»¥</p>
<p>ä½†æ˜¯ansibleçš„ä½¿ç”¨ç†å¿µæ˜¯ï¼Œäººå®¶æä¾›äº†å‡ åƒä¸ªæ¨¡å—ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤æ‚çš„åŠŸèƒ½ï¼Œä½ åœ¨ç”¨shellæ¨¡å—ä¹‹å‰ï¼Œå…ˆæŸ¥ä¸€æŸ¥æ˜¯å¦æœ‰å¯¹åº”çš„æ¨¡å—ã€‚</p>
<p>ä½ å¦‚æœæƒ³ä½¿ç”¨ansibleæä¾›çš„çŠ¶æ€åŠŸèƒ½ï¼Œè®°å½•ä½ æ¯æ¬¡æ‰§è¡Œå‘½ä»¤çš„ç»“æœï¼Œä½ å°±å¿…é¡»å¾—ä½¿ç”¨ä¸“æœ‰çš„æ¨¡å—ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨è¯¥åŠŸèƒ½</p>
<p>shellæ¨¡å—å¯ä»¥è¯†åˆ«ç‰¹æ®Šç¬¦å·ï¼Œå°±ç­‰äºè¿œç¨‹æ‰§è¡Œå‘½ä»¤äº†</p>
<ul>
<li>è¿œç¨‹è¿‡æ»¤sshè¿›ç¨‹ä¿¡æ¯</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible all -m shell -a &#34;ps -ef|grep ssh&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä½¿ç”¨é‡å®šå‘ç¬¦å·ï¼Œåˆ›å»ºæ–‡ä»¶</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># è¿œç¨‹è·å–æ—¶é—´ä¿¡æ¯ï¼Œä¸”å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œä½†commandä¸è®¤è¯†é‡å®šå‘</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m command -a &#34;date &gt; /tmp/date.log&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m shell -a &#34;date &#39;+%F %T&#39; &gt; /tmp/date.log&#34;  #ç­‰ä»·æ“ä½œdate â€œ+%Y-%m-%d %H:%M:%Sâ€</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m shell -a &#39;cat /tmp/date.log&#39;</span>
</span></span><span class="line"><span class="cl">172.16.1.8 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">2022-05-06 12:06:23
</span></span><span class="line"><span class="cl">172.16.1.9 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">2022-05-06 12:06:23
</span></span><span class="line"><span class="cl">172.16.1.7 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">2022-05-06 12:06:23
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>è¿œç¨‹æ‰§è¡Œå¤æ‚linuxå‘½ä»¤</p>
<ul>
<li>åˆ›å»ºæ–‡ä»¶å¤¹</li>
<li>ç”Ÿæˆshè„šæœ¬æ–‡ä»¶(æŸ¥çœ‹ä¸»æœºå)</li>
<li>èµ‹äºˆè„šæœ¬å¯æ‰§è¡Œæƒé™</li>
<li>æ‰§è¡Œè„šæœ¬</li>
<li>å¿½ç•¥warningä¿¡æ¯</li>
</ul>
</li>
</ul>
<p>è¿™ä¸ªå‘½ä»¤å°±æ— æ³•åœ¨commandä¸­æ‰§è¡Œ</p>
<p>é€šè¿‡ä¸€æ¡å‘½ä»¤ï¼Œåšå¦‚ä¸‹äº‹æƒ…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web  -m shell  -a &#34;mkdir /0224/;echo &#39;hostname&#39; &gt; /0224/hostname.sh;chmod +x /0224/hostname.sh;/0224/hostname.sh;  warn=false&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>shellå‘½ä»¤åˆ«è¿‡åº¦ä¾èµ–ï¼Œé‚£å°±ç­‰äºç”¨ansibleè¿œç¨‹å¸®ä½ æ‰§è¡Œäº†ä¸ªæ™®é€šçš„shellå‘½ä»¤ï¼›</p>
</blockquote>
<h2 id="44-copyæ‹·è´æ–‡ä»¶">4.4 copyæ‹·è´æ–‡ä»¶
</h2><p>copyæ¨¡å—æ˜¯è¿œç¨‹æ¨é€æ•°æ®æ¨¡å—ï¼Œåªèƒ½æŠŠæ•°æ®æ¨é€ç»™è¿œç¨‹ä¸»æœºèŠ‚ç‚¹ï¼Œæ— æ³•æ‹‰å–æ•°æ®åˆ°æœ¬åœ°ã€‚</p>
<p>æ—¢ç„¶æ˜¯æ–‡ä»¶æ‹·è´ï¼Œå¯ç”¨å‚æ•°ä¹Ÿå°±æ˜¯å›´ç»•æ–‡ä»¶å±æ€§ã€‚</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>æ˜¯å¦  å¿…é¡»</th>
<th>é»˜ è®¤ å€¼</th>
<th>é€‰é¡¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>src</td>
<td>no</td>
<td></td>
<td></td>
<td><strong>ç”¨äºå®šä½ansibleæ‰§è¡Œçš„æœºå™¨ä¸Šçš„æ–‡ä»¶</strong>ï¼Œéœ€è¦ç»å¯¹è·¯å¾„ã€‚å¦‚æœæ‹·è´çš„æ˜¯æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆæ–‡ä»¶å¤¹ä¼šæ•´ä½“æ‹·è´ï¼Œå¦‚æœç»“ å°¾æ˜¯&quot; / &ldquo;,é‚£ä¹ˆåªæœ‰æ–‡ä»¶å¤¹å†…çš„ä¸œè¥¿è¢«æ‹·è¿‡å»ã€‚(ç±»ä¼¼äºrsync)</td>
</tr>
<tr>
<td>content</td>
<td>no</td>
<td></td>
<td></td>
<td>ç”¨æ¥æ›¿ä»£src,ç”¨äºå°†æŒ‡å®šæ–‡ä»¶çš„å†…å®¹ï¼Œæ‹·è´åˆ°è¿œç¨‹æ–‡ä»¶å†…</td>
</tr>
<tr>
<td>dest</td>
<td>yes</td>
<td></td>
<td></td>
<td>ç”¨äºå®šä½è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶ï¼Œéœ€è¦ç»å¯¹è·¯å¾„ã€‚å¦‚æœsrcæŒ‡å‘çš„æ˜¯æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªå‚æ•°ä¹Ÿå¿…é¡»æ˜¯æŒ‡å‘æ–‡ä»¶å¤¹</td>
</tr>
<tr>
<td>backup</td>
<td>no</td>
<td>no</td>
<td>yes/no</td>
<td>å¤‡ä»½è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„åŸå§‹æ–‡ä»¶ï¼Œåœ¨æ‹·è´ä¹‹å‰ã€‚å¦‚æœå‘ç”Ÿä»€ä¹ˆæ„å¤–ï¼ŒåŸå§‹æ–‡ä»¶è¿˜èƒ½ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td>directory_mode</td>
<td>no</td>
<td></td>
<td></td>
<td>è¿™ä¸ªå‚æ•°åªèƒ½ç”¨äºæ‹·è´æ–‡ä»¶å¤¹æ—¶å€™ï¼Œè¿™ä¸ªè®¾å®šåï¼Œæ–‡ä»¶å¤¹å†…æ–°å»ºçš„æ–‡ä»¶ä¼šè¢«æ‹·è´ã€‚è€Œè€æ—§çš„ä¸ä¼šè¢«æ‹·è´</td>
</tr>
<tr>
<td>follow</td>
<td>no</td>
<td>no</td>
<td>yes/no</td>
<td>å½“æ‹·è´çš„æ–‡ä»¶å¤¹å†…æœ‰linkå­˜åœ¨çš„æ—¶å€™ï¼Œé‚£ä¹ˆæ‹·è´è¿‡å»çš„ä¹Ÿä¼šæœ‰link</td>
</tr>
<tr>
<td>force</td>
<td>no</td>
<td>yes</td>
<td>yes/no</td>
<td>é»˜è®¤ä¸ºyes,ä¼šè¦†ç›–è¿œç¨‹çš„å†…å®¹ä¸ä¸€æ ·çš„æ–‡ä»¶(å¯èƒ½æ–‡ä»¶åä¸€æ ·)ã€‚å¦‚æœæ˜¯no,å°±ä¸ä¼šæ‹·è´æ–‡ä»¶ï¼Œå¦‚æœè¿œç¨‹æœ‰è¿™ ä¸ªæ–‡ä»¶</td>
</tr>
<tr>
<td>group</td>
<td>no</td>
<td></td>
<td></td>
<td>è®¾å®šä¸€ä¸ªç¾¤ç»„æ‹¥æœ‰æ‹·è´åˆ°è¿œç¨‹èŠ‚ç‚¹çš„æ–‡ä»¶æƒé™</td>
</tr>
<tr>
<td>mode</td>
<td>no</td>
<td></td>
<td></td>
<td>ç­‰åŒäºchmod,å‚æ•°å¯ä»¥ä¸º&quot;u+rwx or u=rw,g=r,o=r&rdquo;</td>
</tr>
<tr>
<td>owner</td>
<td>no</td>
<td></td>
<td></td>
<td>è®¾å®šä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰æ‹·è´åˆ°è¿œç¨‹èŠ‚ç‚¹çš„æ–‡ä»¶æƒé™</td>
</tr>
</tbody>
</table></div>
<h3 id="copyè¯­æ³•">copyè¯­æ³•
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ansible ä¸»æœºç»„ -m copy -a <span class="s2">&#34;å‚æ•°&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç®€å•å‘é€æ–‡ä»¶">ç®€å•å‘é€æ–‡ä»¶
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m copy   -a &#34;src=/tmp/61-dnf.log   dest=/tmp/web-dnf.log&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å¹¶ä¸”ansibleçš„æ¨¡å—è®°å½•äº†æ–‡ä»¶å±æ€§ï¼Œæ–‡ä»¶çš„md5å€¼ï¼Œå¾—åˆ°äº†æ–‡ä»¶çš„å”¯ä¸€æ ¡éªŒå€¼ï¼Œåˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦å˜åŒ–ï¼Œå¦‚æœæœªå˜åŒ–ï¼Œä¸åšå¤„ç†ï¼Œæå‡æ‰¹é‡ç®¡ç†çš„æ•ˆç‡</p>
</blockquote>
<h3 id="å‘é€æ–‡ä»¶ä¸”æŒ‡å®šæ–‡ä»¶å±æ€§">å‘é€æ–‡ä»¶ä¸”æŒ‡å®šæ–‡ä»¶å±æ€§
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">61
</span></span><span class="line"><span class="cl">â†“
</span></span><span class="line"><span class="cl">webæœºå™¨ç»„(å±æ€§å˜åŒ–ï¼Œbaizhi001ï¼Œ600)
</span></span></code></pre></td></tr></table>
</div>
</div><p>æƒé™æ”¹ä¸º600ã€ä¿®æ”¹ä¸ºbaizhi001ç”¨æˆ·ï¼ˆè¦æ±‚ç›®æ ‡æœºå™¨å­˜åœ¨è¯¥ç”¨æˆ·ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">åˆ›å»ºbaizhi001ç”¨æˆ·
</span></span><span class="line"><span class="cl">ansible web -m shell -a <span class="s2">&#34;useradd baizhi001&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿œç¨‹æ‹·è´æ–‡ä»¶ï¼Œä¸”ä¿®æ”¹æƒé™ï¼Œä¸º600
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m copy -a &#34;src=/tmp/61-dnf.log   dest=/opt/web-dnf.log  group=baizhi001 owner=baizhi001   mode=600 &#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿œç¨‹æ£€æŸ¥æ–‡ä»¶ä¿¡æ¯
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m shell -a &#34;ls -l  /opt/web-dnf.log&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å‘é€æ–‡ä»¶ä¸”å…ˆåšå¥½å¤‡ä»½">å‘é€æ–‡ä»¶ä¸”å…ˆåšå¥½å¤‡ä»½
</h3><p>ä½¿ç”¨backupå‚æ•°ï¼Œé˜²æ­¢è¦†ç›–è¿œç¨‹æ–‡ä»¶ï¼Œä¸¢å¤±å¤‡ä»½ï¼Œæå‰å¤‡ä»½è¯¥ç›®æ ‡æœºå™¨çš„æ•°æ®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">1.æ£€æŸ¥ç›®æ ‡æœºå™¨çš„æ–‡ä»¶
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m shell -a &#34;ls -l  /opt/web-dnf.log&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.è¿œç¨‹æ‹·è´æ–‡ä»¶ï¼Œä¸”åšå¥½å¤‡ä»½
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m copy -a &#34;src=/tmp/61-dnf.log  dest=/opt/web-dnf.log   backup=yes&#34;  </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.å‘ç°ansibleå¸®ä½ åšå¥½äº†å¤‡ä»½
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m shell -a &#34;ls -l /opt/web*&#34;											Â·</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æŒ‡å®šæ•°æ®å†™å…¥åˆ°è¿œç¨‹æ–‡ä»¶ä¸­">æŒ‡å®šæ•°æ®å†™å…¥åˆ°è¿œç¨‹æ–‡ä»¶ä¸­
</h3><p>å‘rsyncd.confä¸­å¡«å…¥è´¦å·å¯†ç ï¼Œè¦†ç›–å…¶åŸæœ‰çš„æ–‡ä»¶å†…å®¹</p>
<p>contentå‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1"># </span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„åƒè¿™æ ·çš„è¦†ç›–æ“ä½œï¼Œè¿˜æ˜¯æ·»åŠ å¤‡ä»½å‚æ•°æ›´åˆé€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m copy -a &#34;content=&#39;byebye LINUX&#39;   dest=/opt/web-dnf.log   backup=yes  &#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¤åˆ¶æ–‡ä»¶å¤¹">å¤åˆ¶æ–‡ä»¶å¤¹
</h3><p>æ³¨æ„ç»“å°¾æ–œæ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">è¿œç¨‹æ‹·è´/opt/ ä¸‹çš„æ‰€æœ‰å†…å®¹åˆ°ç›®æ ‡æœºå™¨
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m copy -a &#34;src=/opt/  dest=/tmp/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿œç¨‹æ‹·è´/opt  æ•´ä¸ªç›®å½•åˆ°ç›®æ ‡æœºå™¨
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m copy -a &#34;src=/opt  dest=/tmp/&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="45-fileæ–‡ä»¶æ“ä½œæ¨¡å—">4.5 fileæ–‡ä»¶æ“ä½œæ¨¡å—
</h2><p>éœ€è¦å’ŒcopyåŒºåˆ«å¼€ï¼Œfileæ¨¡å—ä¸»è¦æ˜¯å¯¹æ–‡ä»¶å±æ€§å„ç§æ“ä½œçš„ï¼Œç”¨äºåˆ›å»ºæ–‡ä»¶ã€ç›®å½•æ•°æ®ï¼Œä»¥åŠå¯¹ç°æœ‰çš„æ–‡ä»¶ã€ç›®å½•æƒé™è¿›è¡Œä¿®æ”¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">copyæ¨¡å—ï¼Œsrc(ç®¡ç†æœºå™¨ä¸Š )  dest(ç›®æ ‡æœºå™¨ä¸Š)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fileä¸“é—¨ç”¨äºåœ¨è¿œç¨‹æœºå™¨ä¸Šï¼Œå…³äºæ–‡ä»¶çš„æ‰€æœ‰æ“ä½œ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">file  src(ç›®æ ‡æœºå™¨ä¸Šçš„æ–‡ä»¶)   dest(ç›®æ ‡æœºå™¨ä¸Šçš„æ–‡ä»¶)  
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®˜ç½‘ï¼šhttps://docs.ansible.com/ansible/latest/modules/file_module.html#file-module</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">æˆ–è€…çœ‹å‘½ä»¤å¸®åŠ©
</span></span><span class="line"><span class="cl">[root@master-61 ~]#ansible-doc -s file
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¿œç¨‹åˆ›å»ºæ–‡ä»¶">è¿œç¨‹åˆ›å»ºæ–‡ä»¶
</h3><p>ansibleæ¯æ¬¡å‘½ä»¤çš„æ‰§è¡Œï¼Œéƒ½ä¼šè®°å½•ä¸‹å½“å‰çš„çŠ¶æ€</p>
<p>stateå‚æ•°ã€pathå‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">è¿œç¨‹åœ¨webæœåŠ¡å™¨ç»„ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡æœ¬ï¼Œ  hello_ansible.log
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1"># ansible web -m file -a &#34;path=/opt/hello_ansible.log state=touch&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1"># ansible web -m shell -a &#34;ls -ld /opt/hello*&#34;</span>
</span></span><span class="line"><span class="cl">172.16.1.7 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">2</span> root root <span class="m">6</span> May  <span class="m">6</span> 14:56 /opt/hello_ansible
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root <span class="m">0</span> May  <span class="m">6</span> 14:54 /opt/hello_ansible.log
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ›å»ºæ–‡ä»¶å¤¹">åˆ›å»ºæ–‡ä»¶å¤¹
</h3><p>stateå‚æ•°ã€pathå‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m file -a &#34;path=/opt/hello_ansible  state=directory&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ›å»ºæ–‡ä»¶ä¸”è®¾å®šæƒé™">åˆ›å»ºæ–‡ä»¶ä¸”è®¾å®šæƒé™
</h3><p>stateå‚æ•°ã€pathå‚æ•°ã€ownerå‚æ•°ã€groupå‚æ•°</p>
<p>path=/opt/hello-linux.log</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m file -a &#34;path=/opt/hello-linux.log  state=touch owner=baizhi001 group=baizhi001&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¿œç¨‹ä¿®æ”¹æ–‡ä»¶å±æ€§">è¿œç¨‹ä¿®æ”¹æ–‡ä»¶å±æ€§
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m file -a &#34;path=/opt/hello-linux.log state=touch owner=baizhi001 group=baizhi001 mode=777&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ›å»ºè½¯è¿æ¥æ–‡ä»¶">åˆ›å»ºè½¯è¿æ¥æ–‡ä»¶
</h3><p>è½¯è¿æ¥ï¼Œä¹Ÿå°±æ˜¯åœ¨ç›®æ ‡æœºå™¨ä¸Šï¼ŒæŒ‡å®šæºæ–‡ä»¶ï¼Œåˆ›å»ºè½¯è¿æ¥</p>
<p>srcã€destã€state</p>
<p>ç»™webæœåŠ¡å™¨ç»„çš„ /etc/hostsæ–‡ä»¶ï¼Œæ·»åŠ è½¯è¿æ¥åˆ°/opt/hostsæ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1"># ansible web -m file -a &#34;src=/etc/hosts  dest=/opt/hosts state=link&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¼ºåˆ¶æ€§åˆ›å»ºæ–‡ä»¶è½¯è¿æ¥">å¼ºåˆ¶æ€§åˆ›å»ºæ–‡ä»¶ï¼ˆè½¯è¿æ¥ï¼‰
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">æ„ä¹‰ä¸å¤§ï¼ŒæŸ¥çœ‹forceå‚æ•°çš„ä½œç”¨
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m file -a &#34;src=/etc/hostsss dest=/opt/hosts state=link  force=yes &#34;	</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¿®æ”¹å·²å­˜åœ¨æ–‡ä»¶æ–‡ä»¶å¤¹çš„å±æ€§">ä¿®æ”¹å·²å­˜åœ¨æ–‡ä»¶/æ–‡ä»¶å¤¹çš„å±æ€§
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ä¿®æ”¹æ–‡ä»¶ Pathã€mode
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible 172.16.1.7 -m file -a &#34;path=/opt/chaoge666.log  owner=baizhi001 group=baizhi001  mode=666&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¿®æ”¹æ–‡ä»¶å¤¹ Pathã€mode owner,group
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible 172.16.1.7 -m file -a &#34;path=/opt/hello_ansible  owner=baizhi001 group=baizhi001&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å…³äºfileæ¨¡å—çš„æ‰€æœ‰å‚æ•°ä½œç”¨">å…³äºfileæ¨¡å—çš„æ‰€æœ‰å‚æ•°ä½œç”¨
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html#parameters
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å…³äºfileæ¨¡å—çš„å®ä¾‹ç”¨æ³•">å…³äºfileæ¨¡å—çš„å®ä¾‹ç”¨æ³•
</h3><p>playbookå‰§æœ¬çš„å†™æ³•ï¼Œyamlå†™æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html#examples
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="46-scriptè„šæœ¬æ¨¡å—">4.6 scriptè„šæœ¬æ¨¡å—
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ä¸€é”®éƒ¨ç½²rsyncï¼Œnfsï¼Œnginxç­‰ï¼Œä¸¤ç§åšæ³•:
</span></span><span class="line"><span class="cl">1.æŠŠè„šæœ¬å‘åˆ°ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œï¼Œ
</span></span><span class="line"><span class="cl">2.è¿œç¨‹æ‰§è¡Œï¼Œç›®æ ‡æœºå™¨ä¸Šä¸éœ€è¦å­˜åœ¨è¿™ä¸ªè„šæœ¬
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®˜ç½‘</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html#ansible-collections-ansible-builtin-script-module
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>scriptsæ¨¡å—åŠŸèƒ½ï¼šæŠŠæœ¬åœ°è„šæœ¬ä¼ è¾“åˆ°è¿œç¨‹èŠ‚ç‚¹ä¸Šå¹¶è¿è¡Œè„šæœ¬</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦ç”¨scriptsæ¨¡å—ï¼Œæ˜¯å› ä¸ºæ¯”èµ·<code>shell</code>æ¨¡å—ï¼Œscriptæ¨¡å—åŠŸèƒ½æ›´å¼ºå¤§ï¼Œç®¡ç†æœºæœ¬åœ°æœ‰ä¸€ä»½è„šæœ¬ï¼Œå°±å¯ä»¥åœ¨æ‰€æœ‰æœºå™¨ä¸Šè¿è¡Œï¼Œæ–Œä¸”scriptæ¨¡å—å¯ä»¥åå¤æ‰§è¡Œå‘½ä»¤ã€è¿œç¨‹æ‰§è¡Œè„šæœ¬</p>
<h3 id="scriptsæ¨¡å—çš„åŠŸèƒ½å‚æ•°">scriptsæ¨¡å—çš„åŠŸèƒ½å‚æ•°
</h3><div class="table-wrapper"><table>
<thead>
<tr>
<th>é€‰é¡¹å‚æ•°</th>
<th>é€‰é¡¹è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>creates</td>
<td>å®šä¹‰ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™è¿è¡Œç›¸åº”å‘½ä»¤ï¼›å­˜åœ¨åˆ™è·³è¿‡</td>
</tr>
<tr>
<td>free_formï¼ˆå¿…é¡»ï¼‰</td>
<td>å‚æ•°ä¿¡æ¯ä¸­å¯ä»¥è¾“å…¥ä»»ä½•ç³»ç»Ÿå‘½ä»¤ï¼Œå®ç°è¿œç¨‹ç®¡ç†</td>
</tr>
<tr>
<td>removes</td>
<td>å®šä¹‰ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿è¡Œç›¸åº”å‘½ä»¤ï¼›å¦‚æœä¸å­˜åœ¨åˆ™è·³è¿‡</td>
</tr>
</tbody>
</table></div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">1.ç®¡ç†æœºåˆ›å»ºæµ‹è¯•è„šæœ¬
</span></span><span class="line"><span class="cl">master-61åˆ›å»ºè¯¥è„šæœ¬
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#vim echo_server_info.sh </span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#cat echo_server_info.sh </span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;</span><span class="k">$(</span>hostname -I<span class="k">)</span><span class="s2">&#34;</span> &gt;&gt; /tmp/server_info.log
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;</span><span class="k">$(</span>uptime<span class="k">)</span><span class="s2">&#34;</span> &gt;&gt; /tmp/server_info.log
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;</span><span class="k">$(</span>free -m<span class="k">)</span><span class="s2">&#34;</span> &gt;&gt; /tmp/server_info.log
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.æ·»åŠ æ‰§è¡Œæƒé™
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#chmod +x echo_server_info.sh </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.è¿œç¨‹æ‰§è¡Œ
</span></span><span class="line"><span class="cl">å‘ç»™nfsæœºå™¨å»æ‰§è¡Œ
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs -m script -a &#34;/root/echo_server_info.sh&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.æ£€æŸ¥ç»“æœ
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs -m shell -a &#34;cat /tmp/server_info.log&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¿œç¨‹åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œè„šæœ¬">è¿œç¨‹åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œè„šæœ¬
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">è¿œç¨‹å®‰è£…nginxè„šæœ¬
</span></span><span class="line"><span class="cl">[root@master-61 ~]#cat install_nginx.sh 
</span></span><span class="line"><span class="cl">#yum install nginx -y
</span></span><span class="line"><span class="cl">#yum remove nginx -y
</span></span><span class="line"><span class="cl">echo &#34;nginxæ“ä½œå®Œæ¯•&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@master-61 ~]#ansible nfs -m script -a &#34;/root/install_nginx.sh&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æŸ¥çœ‹å‘½ä»¤æ‰§è¡Œè¯¦ç»†è¿‡ç¨‹">æŸ¥çœ‹å‘½ä»¤æ‰§è¡Œè¯¦ç»†è¿‡ç¨‹
</h3><p>æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œçš„è¯¦ç»†è¿‡ç¨‹ï¼Œå¼€å¯äº†debugæ—¥å¿—æ¨¡å¼ï¼Œ-vvvvvå‚æ•°æ˜¾ç¤ºè¯¦ç»†è¿‡ç¨‹ï¼Œvè¶Šå¤šï¼Œè¶Šè¯¦ç»†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@master-61 ~]#ansible nfs -vvvv -m shell -a &#34;cat /tmp/server_info.log&#34; 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="47-cronå®šæ—¶ä»»åŠ¡æ¨¡å—">4.7 cronå®šæ—¶ä»»åŠ¡æ¨¡å—
</h2><p>cronæ¨¡å—ç”¨äºç®¡ç†å®šæ—¶ä»»åŠ¡çš„è®°å½•ï¼Œç¼–å†™ä»»åŠ¡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">å®˜ç½‘æ–‡æ¡£
</span></span></span><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/modules/cron_module.html#cron-module
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¯¹æ¯”ansibleçš„cronæ¨¡å—ä»¥åŠcrontab">å¯¹æ¯”ansibleçš„cronæ¨¡å—ä»¥åŠcrontab
</h3><p>å¸¸è§çš„å‚æ•°å¦‚æ­¤ï¼Œä½¿ç”¨ansibleç¼–å†™å®šæ—¶ä»»åŠ¡ï¼Œå’Œç›´æ¥ç¼–å†™æ˜¯æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«çš„</p>
<p><img src="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/aff7e1c089d7fbf568a8ca351a46d5a1.jpeg"
	width="1888"
	height="413"
	srcset="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/aff7e1c089d7fbf568a8ca351a46d5a1_hu3400507602043994949.jpeg 480w, /xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/aff7e1c089d7fbf568a8ca351a46d5a1_hu6034676024120022660.jpeg 1024w"
	loading="lazy"
	
		alt="aff7e1c089d7fbf568a8ca351a46d5a1"
	
	
		class="gallery-image" 
		data-flex-grow="457"
		data-flex-basis="1097px"
	
></p>
<h3 id="æ·»åŠ ntpdateå®šæ—¶ä»»åŠ¡">æ·»åŠ ntpdateå®šæ—¶ä»»åŠ¡
</h3><p>æ·»åŠ æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡å’Œé˜¿é‡Œäº‘æ—¶é—´åŒæ­¥</p>
<p>nameã€jobã€minuteå‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">cronæ¨¡å—åˆ›å»ºå®šæ—¶ä»»åŠ¡
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs  -m cron   -a &#34;name=&#39;ntp aliyun&#39;   minute=*/5   job=&#39;ntpdate -u ntp.aliyun.com&#39;&#34;</span>
</span></span><span class="line"><span class="cl">172.16.1.31 <span class="p">|</span> <span class="nv">CHANGED</span> <span class="o">=</span>&gt; <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ansible_facts&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;discovered_interpreter_python&#34;</span>: <span class="s2">&#34;/usr/bin/python&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;changed&#34;</span>: true, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;envs&#34;</span>: <span class="o">[]</span>, 
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;jobs&#34;</span>: <span class="o">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ntp aliyun&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æŸ¥çœ‹è¿œç¨‹æœºå™¨çš„crontabè®°å½•
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs -m shell -a &#34;crontab -l&#34;</span>
</span></span><span class="line"><span class="cl">172.16.1.31 <span class="p">|</span> CHANGED <span class="p">|</span> <span class="nv">rc</span><span class="o">=</span><span class="m">0</span> &gt;&gt;
</span></span><span class="line"><span class="cl">* * * * * /usr/sbin/ntpdate time1.aliyun.com &gt; /dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Ansible: ntp aliyun</span>
</span></span><span class="line"><span class="cl">*/5 * * * * ntpdate -u ntp.aliyun.com
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ é™¤å®šæ—¶ä»»åŠ¡">åˆ é™¤å®šæ—¶ä»»åŠ¡
</h3><p>åªèƒ½åŸºäºcronæ¨¡å—æŒ‡å®šåå­—çš„ä¿®æ”¹</p>
<p>nameå‚æ•°ï¼Œstateå‚æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">cronæ¨¡å—ç”¨æ³•
</span></span><span class="line"><span class="cl">ansible nfs -m cron -a <span class="s2">&#34;name=&#39;ntp aliyun&#39;  state=absent &#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">shellæ¨¡å—ç”¨æ³•
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs -m shell -a &#34;crontab -r&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ›å»ºæ¯åˆ†é’Ÿæ‰§è¡Œçš„ä»»åŠ¡">åˆ›å»ºæ¯åˆ†é’Ÿæ‰§è¡Œçš„ä»»åŠ¡
</h3><p>ä¸æŒ‡å®šä»»ä½•æ—¶é—´è§„åˆ™ï¼Œé»˜è®¤æ˜¯æ¯åˆ†é’Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@master-61 ~]#ansible nfs -m cron -a &#34;name=&#39;ä¸€å¥è¯&#39;  job=&#39;echo &#34;hellolinux&#34; &gt;&gt;/tmp/hello.log &#39;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@master-61 ~]#ansible nfs -m shell -a &#34;crontab -l&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¿®æ”¹æŒ‡å®šåç§°çš„å®šæ—¶ä»»åŠ¡">ä¿®æ”¹æŒ‡å®šåç§°çš„å®šæ—¶ä»»åŠ¡
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@master-61 ~]#ansible nfs -m cron -a &#34;name=&#39;ä¸€å¥è¯&#39;    minute=30  hour=23   job=&#39;echo hellolinux &gt;&gt;/tmp/hello.log&#39; &#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@master-61 ~]#ansible nfs -m shell -a &#34;crontab -l&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="48-groupæ¨¡å—">4.8 groupæ¨¡å—
</h2><p>ç®¡ç†ç³»ç»Ÿç”¨æˆ·ç»„çš„æ¨¡å—</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">å®˜ç½‘æ–‡æ¡£
</span></span></span><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/modules/group_module.html#group-
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¯­æ³•:</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>æ¨¡å—å‚æ•°</th>
<th>å‚æ•°æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>åˆ›å»ºæŒ‡å®šçš„ç»„å</td>
</tr>
<tr>
<td>gid</td>
<td>ç»„çš„GID</td>
</tr>
<tr>
<td>state</td>
<td>absentï¼Œç§»é™¤è¿œç¨‹ä¸»æœºçš„ç»„</td>
</tr>
<tr>
<td></td>
<td>presentï¼Œåˆ›å»ºè¿œç«¯ä¸»æœºçš„ç»„</td>
</tr>
</tbody>
</table></div>
<h3 id="åˆ›å»ºbaizhi_opsç»„gid1234">åˆ›å»ºbaizhi_opsç»„ï¼Œgid=1234
</h3><p>nameã€gid</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs  -m group  -a &#34;name=baizhi_ops   gid=1234&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ é™¤ç»„">åˆ é™¤ç»„
</h3><p>nameã€gidã€state</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs  -m group  -a &#34;name=baizhi_ops   gid=1234  state=absent&#34;  </span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="49-userç”¨æˆ·æ¨¡å—">4.9 userç”¨æˆ·æ¨¡å—
</h2><p>ç”¨æˆ·ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯å…³äºç”¨æˆ·çš„</p>
<ul>
<li>uid</li>
<li>ç”¨æˆ·å</li>
<li>ç”¨æˆ·ä¸»ç»„</li>
<li>ç”¨æˆ·é™„åŠ ç»„</li>
<li>åˆ›å»ºç”¨æˆ·</li>
<li>åˆ é™¤ç”¨æˆ·</li>
<li>åˆ›å»ºå…³äºç”¨æˆ·çš„å…¬ç§é’¥</li>
<li>ç”¨æˆ·è¿‡æœŸæ—¶é—´</li>
<li>ç”¨æˆ·å¯†ç è¿‡æœŸæ—¶é—´</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">å®˜ç½‘æ–‡æ¡£
</span></span></span><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/modules/user_module.html#user-module
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¯­æ³•å‚æ•°">è¯­æ³•å‚æ•°
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">å®ä¾‹ç”¨æ³•
</span></span></span><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/user_module.html#examples
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="table-wrapper"><table>
<thead>
<tr>
<th>æ¨¡å—å‚æ•°</th>
<th>å‚æ•°æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>create_home</td>
<td>åˆ›å»ºå®¶ç›®å½•ï¼Œè®¾ç½®noåˆ™ä¸åˆ›å»ºå®¶ç›®å½•</td>
</tr>
<tr>
<td>group</td>
<td>åˆ›å»ºç”¨æˆ·ç»„</td>
</tr>
<tr>
<td>name</td>
<td>åˆ›å»ºç”¨æˆ·çš„åå­—</td>
</tr>
<tr>
<td>password</td>
<td>åˆ›å»ºç”¨æˆ·çš„å¯†ç </td>
</tr>
<tr>
<td>uid</td>
<td>åˆ›å»ºç”¨æˆ·çš„UID</td>
</tr>
<tr>
<td>shell</td>
<td>ç”¨æˆ·ç™»å½•è§£é‡Šå™¨</td>
</tr>
<tr>
<td>state</td>
<td>Absentï¼ˆåˆ é™¤ç”¨æˆ·ï¼‰presentï¼ˆé»˜è®¤å‚æ•°ï¼Œåˆ›å»ºï¼‰</td>
</tr>
<tr>
<td>expires</td>
<td>è´¦æˆ·è¿‡æœŸæ—¶é—´</td>
</tr>
</tbody>
</table></div>
<h3 id="åˆ›å»ºbaizhi001ç”¨æˆ·uidä¸º8888">åˆ›å»ºbaizhi001ç”¨æˆ·ï¼Œuidä¸º8888
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs -m user -a &#34;name=baizhi001  uid=8888&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ›å»ºç”¨æˆ·cc01">åˆ›å»ºç”¨æˆ·cc01
</h3><ul>
<li>uidã€gidä¸º1777</li>
<li>æ²¡æœ‰å®¶ç›®å½•ã€ä¸å…è®¸ç™»å½•</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">æ³¨æ„è¯¥ç”¨æˆ·ç»„æ˜¯å¦å­˜åœ¨ï¼Œå¦åˆ™æŠ¥é”™
</span></span><span class="line"><span class="cl">groupã€nameã€gid
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs -m group -a &#34;name=cc01 gid=1777&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">åˆ›å»ºç”¨æˆ·ï¼Œè®¾ç½®æƒé™
</span></span><span class="line"><span class="cl">userã€nameã€uidã€groupã€create_homeã€shell
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible nfs -m user -a &#34;name=cc01 uid=1777 group=1777 create_home=no  shell=/sbin/nologin &#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ£€æŸ¥ç”¨æˆ·
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="410-yumå®‰è£…è½¯ä»¶">4.10 yumå®‰è£…è½¯ä»¶
</h2><p>yumæ¨¡å—æ˜æ˜¾å°±æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç®¡ç†è½¯ä»¶çš„æ¨¡å—ã€‚yumæ¨¡å—å…¶å®å°±æ˜¯åœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šï¼Œæ‰§è¡Œyumå‘½ä»¤ï¼Œä½ å¯ä»¥å¿«é€Ÿç™»å½•åˆ°ç›®æ ‡æœºå™¨ï¼ŒæŸ¥çœ‹è¿›ç¨‹</p>
<h3 id="å®˜ç½‘æ–‡æ¡£ç¤ºä¾‹ç”¨æ³•">å®˜ç½‘æ–‡æ¡£ç¤ºä¾‹ç”¨æ³•
</h3><p><img src="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/image-20200317164841904.png"
	width="1576"
	height="858"
	srcset="/xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/image-20200317164841904_hu8118940964493789301.png 480w, /xiaoshi/p/ansible%E5%9F%BA%E7%A1%80/assets/image-20200317164841904_hu4372038433789442210.png 1024w"
	loading="lazy"
	
		alt="image-20200317164841904"
	
	
		class="gallery-image" 
		data-flex-grow="183"
		data-flex-basis="440px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/yum_module.html#examples
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…net-toolsæœ€æ–°ç‰ˆæœ¬">å®‰è£…net-toolsæœ€æ–°ç‰ˆæœ¬
</h3><p>latestå‚æ•°ä¹Ÿç”¨äºå‡çº§è½¯ä»¶åŒ…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible backup -m yum -a &#34;name=net-tools state=latest&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¸è½½net-toolsè½¯ä»¶">å¸è½½net-toolsè½¯ä»¶
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible backup -m yum -a &#34;name=net-tools state=absent&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…rsyncæœåŠ¡">å®‰è£…rsyncæœåŠ¡
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible backup -m yum -a &#34;name=rsync state=installed&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ£€æŸ¥rsync
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible backup -m shell -a &#34;rpm -qa rsync&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¸è½½rsyncæœåŠ¡">å¸è½½rsyncæœåŠ¡
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible backup -m yum -a &#34;name=rsync state=removed&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="411-servicesystemdæ¨¡å—">4.11 service/systemdæ¨¡å—
</h2><p>è¯¥æ¨¡å—ä½œç”¨æ˜¯é’ˆå¯¹yumåŒ…ç®¡ç†</p>
<p>serviceé€‚ç”¨äºcentos6å‰çš„ç³»ç»Ÿ</p>
<p>systemdå‘½ä»¤åº”ç”¨äºcentos7ç³»ç»Ÿ</p>
<p><strong>è¦æ³¨æ„çš„æ˜¯serviceæ¨¡å—ä¾æ—§å¯¹centos7æœ‰æ•ˆï¼Œä½†æ˜¯å»ºè®®å¤§å®¶ä½¿ç”¨systemdæ¨¡å—</strong></p>
<blockquote>
<ul>
<li>systemdæ¨¡å—ç”¨äºæ§åˆ¶è¿œç¨‹ä¸»æœºçš„systemdæœåŠ¡ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯Linuxä¸‹çš„systemdå‘½ä»¤ã€‚éœ€è¦è¿œç¨‹ä¸»æœºæ”¯æŒsystemd</li>
<li>ç”¨æ³•å’Œserviceæ¨¡å—åŸºæœ¬ç›¸åŒ</li>
</ul>
</blockquote>
<h3 id="systemdæ¨¡å—å‚æ•°">systemdæ¨¡å—å‚æ•°
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="err">å¦‚æœä½¿ç”¨</span><span class="n">systemctl</span> <span class="err">ç®¡ç†ç¨‹åºçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨</span><span class="n">systemdæ¨¡å—</span><span class="err">ï¼Œ</span><span class="n">systemctl</span> <span class="err">å¯ä»¥</span> <span class="err">æ§åˆ¶ç¨‹åºå¯</span><span class="o">/</span><span class="err">åœï¼Œ</span><span class="n">reload</span><span class="err">ï¼Œå¼€æœºå¯åŠ¨ï¼Œè§‚å¯Ÿç¨‹åºçŠ¶æ€ï¼ˆ</span><span class="n">status</span><span class="err">ï¼‰ç­‰ï¼ŒæŒæ¡ä½¿ç”¨åç®¡ç†å°±æ›´æ–¹ä¾¿äº†</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">ä¸»è¦å‚æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">daemon_reload</span><span class="err">ï¼šåœ¨æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œä¹‹å‰è¿è¡Œå®ˆæŠ¤è¿›ç¨‹é‡æ–°åŠ è½½ï¼Œä»¥ç¡®ä¿</span><span class="n">systemdå·²ç»è¯»å–å…¶ä»–æ›´æ”¹</span>
</span></span><span class="line"><span class="cl"><span class="n">enabled</span><span class="err">ï¼šæœåŠ¡æ˜¯å¦å¼€æœºè‡ªåŠ¨å¯åŠ¨</span><span class="n">yes</span><span class="o">|</span><span class="n">no</span><span class="err">ã€‚</span><span class="n">enabledå’Œstateè‡³å°‘è¦æœ‰ä¸€ä¸ªè¢«å®šä¹‰</span>
</span></span><span class="line"><span class="cl"><span class="n">masked</span><span class="err">ï¼šæ˜¯å¦å°†æœåŠ¡è®¾ç½®ä¸º</span><span class="n">maskedçŠ¶æ€</span><span class="err">ï¼Œè¢«</span><span class="n">maskçš„æœåŠ¡æ˜¯æ— æ³•å¯åŠ¨çš„</span>
</span></span><span class="line"><span class="cl"><span class="n">name</span><span class="err">ï¼šå¿…é€‰é¡¹ï¼ŒæœåŠ¡åç§°</span>
</span></span><span class="line"><span class="cl"><span class="n">no_block</span><span class="p">(</span><span class="mf">2.3</span><span class="err">åæ–°å¢</span><span class="p">)</span><span class="err">ï¼šä¸è¦åŒæ­¥ç­‰å¾…æ“ä½œè¯·æ±‚å®Œæˆ</span>
</span></span><span class="line"><span class="cl"><span class="n">state</span><span class="err">ï¼šå¯¹å½“å‰æœåŠ¡æ‰§è¡Œå¯åŠ¨ï¼Œåœæ­¢ã€é‡å¯ã€é‡æ–°åŠ è½½ç­‰æ“ä½œï¼ˆ</span><span class="n">started</span><span class="p">,</span><span class="n">stopped</span><span class="p">,</span><span class="n">restarted</span><span class="p">,</span><span class="n">reloaded</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">user</span><span class="err">ï¼šä½¿ç”¨æœåŠ¡çš„è°ƒç”¨è€…è¿è¡Œ</span><span class="n">systemctl</span><span class="err">ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿçš„æœåŠ¡ç®¡ç†è€…</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…å¯åŠ¨nginxæœåŠ¡">å®‰è£…ã€å¯åŠ¨nginxæœåŠ¡
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">1.å®‰è£…nginxæœåŠ¡
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m yum -a &#34;name=nginx state=installed&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.å¯åŠ¨æœåŠ¡
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m systemd -a &#34;name=nginx state=started&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.æŸ¥è¯¢çŠ¶æ€ï¼Œè¿™é‡Œansibleæœªç›´æ¥æä¾›statuså‚æ•°ï¼Œä½ å¯ä»¥å€ŸåŠ©commandæ¨¡å—å³å¯
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;systemctl status nginx&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4.åœæ­¢nginxæœåŠ¡
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m systemd -a &#34;name=nginx state=stopped&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5.è®¾ç½®nginxå¼€æœºè‡ªå¯
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m systemd -a &#34;name=nginx state=started enabled=yes&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6.æ£€æŸ¥nginxçŠ¶æ€
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;systemctl is-enabled nginx&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;systemctl status nginx&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">7.å…³é—­å¼€æœºè‡ªå¯ã€ä¸”åœæ­¢æœåŠ¡
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m systemd -a &#34;name=nginx state=stopped  enabled=no&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">8.å†æ¬¡æ£€æŸ¥çŠ¶æ€
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web  -m shell -a &#34;systemctl is-enabled nginx;systemctl status nginx&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="412-mountæŒ‚è½½æ¨¡å—">4.12 mountæŒ‚è½½æ¨¡å—
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">å®˜ç½‘
</span></span></span><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/collections/ansible/posix/mount_module.html#mount-
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åœ¨nfs-31æœºå™¨å‡†å¤‡nfs">åœ¨nfs-31æœºå™¨å‡†å¤‡nfs
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@nfs-31 ~<span class="o">]</span><span class="c1">#yum install nfs-utils rpcbind -y</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@nfs-31 ~<span class="o">]</span><span class="c1">#mkdir /nfs-data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@nfs-31 ~<span class="o">]</span><span class="c1">#vim /etc/exports</span>
</span></span><span class="line"><span class="cl">/nfs-data 172.16.1.0/24<span class="o">(</span>rw<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@nfs-31 ~<span class="o">]</span><span class="c1">#systemctl restart nfs</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@nfs-31 ~<span class="o">]</span><span class="c1">#showmount -e 127.0.0.1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç»™web-7æœºå™¨æŒ‚è½½nfsç›®å½•åªå†™å…¥etcfstabè€Œä¸ç«‹å³æŒ‚è½½">ç»™web-7æœºå™¨æŒ‚è½½nfsç›®å½•ï¼ˆåªå†™å…¥/etc/fstabè€Œä¸ç«‹å³æŒ‚è½½ï¼‰
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible  172.16.1.7  -m mount  -a &#34;src=&#39;172.16.1.31:/nfs-data&#39; path=&#39;/test-nfs&#39;    state=present  fstype=nfs &#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æŸ¥çœ‹æŒ‚è½½çŠ¶æ€
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible 172.16.1.7 -m shell -a &#34;cat /etc/fstab&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible 172.16.1.7 -a &#34;df -h&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ç»™web-7æœºå™¨æŒ‚è½½nfsç›®å½•ç«‹å³æŒ‚è½½ä¸”å†™å…¥etcfstab">ç»™web-7æœºå™¨æŒ‚è½½nfsç›®å½•ï¼ˆç«‹å³æŒ‚è½½ä¸”å†™å…¥/etc/fstabï¼‰
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible  172.16.1.7  -m mount  -a &#34;src=&#39;172.16.1.31:/nfs-data&#39; path=&#39;/test-nfs&#39;    state=mounted  fstype=nfs &#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ£€æŸ¥
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible 172.16.1.7 -a &#34;df -h&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible 172.16.1.7 -a &#34;cat /etc/fstab&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å–æ¶ˆæŒ‚è½½ä»¥åŠåˆ é™¤fstabè®°å½•">å–æ¶ˆæŒ‚è½½ï¼Œä»¥åŠåˆ é™¤fstabè®°å½•
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible  172.16.1.7  -m mount  -a &#34;src=&#39;172.16.1.31:/nfs-data&#39; path=&#39;/test-nfs&#39;    state=absent  fstype=nfs &#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">éªŒè¯
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible 172.16.1.7 -a &#34;df -h&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible 172.16.1.7 -a &#34;cat /etc/fstab&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å–æ¶ˆæŒ‚è½½ä¸åˆ é™¤fstabè®°å½•">å–æ¶ˆæŒ‚è½½ï¼Œä¸åˆ é™¤fstabè®°å½•
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible  172.16.1.7  -m mount  -a &#34;src=&#39;172.16.1.31:/nfs-data&#39; path=&#39;/test-nfs&#39;    state=unmounted  fstype=nfs &#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="stateæ€»ç»“å‚æ•°">stateæ€»ç»“å‚æ•°
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mounted æŒ‚è½½è®¾å¤‡ä¸”å†™å…¥fstab
</span></span><span class="line"><span class="cl">present ä»…å†™å…¥fstab ä¸æŒ‚è½½
</span></span><span class="line"><span class="cl">absent  å¸è½½ä¸”åˆ é™¤fstabè®°å½•
</span></span><span class="line"><span class="cl">umounted åªå¸è½½ä¸åˆ é™¤fstabè®°å½•
</span></span><span class="line"><span class="cl">remounted é‡æ–°æŒ‚è½½è¿™ä¸ªè®¾å¤‡
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="413-archiveå‹ç¼©æ¨¡å—">4.13 archiveå‹ç¼©æ¨¡å—
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">å®˜ç½‘æ–‡æ¡£
</span></span></span><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html
</span></span></span><span class="line"><span class="cl"><span class="err">ç”¨æ³•æ–‡æ¡£
</span></span></span><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html#examples
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ”¯æŒå‹ç¼©ç±»å‹">æ”¯æŒå‹ç¼©ç±»å‹
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">bz2
</span></span><span class="line"><span class="cl">gz â† (default)
</span></span><span class="line"><span class="cl">tar
</span></span><span class="line"><span class="cl">xz
</span></span><span class="line"><span class="cl">zip 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å‹ç¼©etcé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„">å‹ç¼©/etcé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m archive -a &#34;path=/etc dest=/opt/etc.tgz&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;ls /opt -l&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;file /opt/etc.tgz&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å‹ç¼©varlogä¸ºzipç±»å‹åˆ°æŒ‡å®šè·¯å¾„">å‹ç¼©/var/logä¸ºzipç±»å‹åˆ°æŒ‡å®šè·¯å¾„
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m archive -a &#34;path=/var/log dest=/opt/log.zip format=zip&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;file /opt/log.zip&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="414-unarchiveè§£å‹ç¼©æ¨¡å—">4.14 unarchiveè§£å‹ç¼©æ¨¡å—
</h2><p>æ³¨æ„äº†ï¼Œä½ ç°åœ¨æ˜¯è¿œç¨‹è§£å‹ç¼©ï¼Œè€Œä¸æ˜¯åœ¨æœ¬æœºç›´æ¥è§£å‹ç¼©</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/unarchive_module.html#examples
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è§£å‹ç¼©etctgzåˆ°æŒ‡å®šç›®å½•è¿œç¨‹è§£å‹">è§£å‹ç¼©etc.tgzåˆ°æŒ‡å®šç›®å½•ï¼ˆè¿œç¨‹è§£å‹ï¼‰
</h3><p>remote_srcè¿œç¨‹æ•°æ®æº</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">æŒ‡å®šç›®å½•å¿…é¡»å­˜åœ¨
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m file -a &#34;path=/opt/etc_file state=directory&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è§£å‹ç¼©
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -m unarchive -a &#34;src=/opt/etc.tgz dest=/opt/etc_file/ remote_src=yes&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æŸ¥çœ‹
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#ansible web -a &#34;ls /opt/etc_file/etc/&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å°†ç®¡ç†æœºçš„å‹ç¼©åŒ…è§£å‹åˆ°è¿œç¨‹æœºå™¨ä¸Š">å°†ç®¡ç†æœºçš„å‹ç¼©åŒ…ï¼Œè§£å‹åˆ°è¿œç¨‹æœºå™¨ä¸Š
</h3><p>å°†master-61çš„å‹ç¼©æ–‡ä»¶ï¼Œè§£å‹åˆ°web-7æœºå™¨ä¸Š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">1.ç”Ÿæˆetc.tgzæ•°æ®
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 ~<span class="o">]</span><span class="c1">#cd / &amp;&amp; tar -zcf /opt/etc.tgz etc</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.è¿œç¨‹è§£å‹åˆ°web-7æœºå™¨ä¸Š
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 /<span class="o">]</span><span class="c1">#ansible web -m unarchive -a &#34;src=/opt/etc.tgz  dest=/tmp/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3.æ£€æŸ¥
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master-61 /<span class="o">]</span><span class="c1">#ansible web -a &#34;ls /tmp/etc/&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 å°è¯—
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/xiaoshi/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
