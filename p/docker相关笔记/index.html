<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="01-Dockeræ¦‚è¿° Dockerç®€ä»‹ Dockeræ˜¯åŸºäºGoè¯­è¨€å®ç°çš„äº‘å¼€æºé¡¹ç›®ã€‚ Dockerçš„ä¸»è¦ç›®æ ‡æ˜¯ï¼šBuild, Ship and Run Any App, Anywh">
<title>Dockerç›¸å…³ç¬”è®°</title>

<link rel='canonical' href='https://ZackMoel.github.io/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/'>

<link rel="stylesheet" href="/xiaoshi/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css"><meta property='og:title' content="Dockerç›¸å…³ç¬”è®°">
<meta property='og:description' content="01-Dockeræ¦‚è¿° Dockerç®€ä»‹ Dockeræ˜¯åŸºäºGoè¯­è¨€å®ç°çš„äº‘å¼€æºé¡¹ç›®ã€‚ Dockerçš„ä¸»è¦ç›®æ ‡æ˜¯ï¼šBuild, Ship and Run Any App, Anywh">
<meta property='og:url' content='https://ZackMoel.github.io/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/'>
<meta property='og:site_name' content='å°è¯—'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-04-15T20:26:37&#43;08:00'/><meta property='article:modified_time' content='2025-04-15T20:26:37&#43;08:00'/>
<meta name="twitter:title" content="Dockerç›¸å…³ç¬”è®°">
<meta name="twitter:description" content="01-Dockeræ¦‚è¿° Dockerç®€ä»‹ Dockeræ˜¯åŸºäºGoè¯­è¨€å®ç°çš„äº‘å¼€æºé¡¹ç›®ã€‚ Dockerçš„ä¸»è¦ç›®æ ‡æ˜¯ï¼šBuild, Ship and Run Any App, Anywh">
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/xiaoshi/">
                
                    
                    
                    
                        
                        <img src="/xiaoshi/img/avatar_hu8920112365793990935.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/xiaoshi">å°è¯—</a></h1>
            <h2 class="site-description">ä¸–ç•Œå’Œå¹³</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/1055981889?spm_id_from=333.1007.0.0'
                        target="_blank"
                        title="bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/ZackMoel/xiaoshi.github.io'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/xiaoshi/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/xiaoshi/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/xiaoshi/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/xiaoshi/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/xiaoshi/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>å‹æƒ…é“¾æ¥</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#dockerç®€ä»‹">Dockerç®€ä»‹</a></li>
    <li><a href="#ä¼ ç»Ÿè™šæ‹Ÿæœºå’Œå®¹å™¨">ä¼ ç»Ÿè™šæ‹Ÿæœºå’Œå®¹å™¨</a></li>
    <li><a href="#dockerè¿è¡Œé€Ÿåº¦å¿«çš„åŸå› ">Dockerè¿è¡Œé€Ÿåº¦å¿«çš„åŸå› </a></li>
    <li><a href="#dockerè½¯ä»¶">Dockerè½¯ä»¶</a>
      <ol>
        <li><a href="#dockeré•œåƒ">Dockeré•œåƒ</a></li>
        <li><a href="#dockerå®¹å™¨">Dockerå®¹å™¨</a></li>
        <li><a href="#dockerä»“åº“">Dockerä»“åº“</a></li>
      </ol>
    </li>
    <li><a href="#dockeræ¶æ„">Dockeræ¶æ„</a></li>
  </ol>

  <ol>
    <li><a href="#centoså®‰è£…docker">CentOSå®‰è£…Docker</a>
      <ol>
        <li><a href="#å¸è½½æ—§ç‰ˆæœ¬">å¸è½½æ—§ç‰ˆæœ¬</a></li>
        <li><a href="#é…ç½®yumèµ„æºåº“">é…ç½®yumèµ„æºåº“</a></li>
        <li><a href="#å®‰è£…dockerå¼•æ“">å®‰è£…Dockerå¼•æ“</a></li>
        <li><a href="#å¯åŠ¨dockerå¼•æ“">å¯åŠ¨dockerå¼•æ“</a></li>
      </ol>
    </li>
    <li><a href="#å¸è½½docker">å¸è½½Docker</a></li>
    <li><a href="#è¿è¡Œhelloworldæµ‹è¯•">è¿è¡ŒHelloWorldæµ‹è¯•</a></li>
    <li><a href="#ubuntuå®‰è£…docker">Ubuntuå®‰è£…Docker</a>
      <ol>
        <li><a href="#å¸è½½æ—§ç‰ˆæœ¬-1">å¸è½½æ—§ç‰ˆæœ¬</a></li>
        <li><a href="#å®‰è£…ä¾èµ–">å®‰è£…ä¾èµ–</a></li>
        <li><a href="#æ·»åŠ dockerè½¯ä»¶æº">æ·»åŠ dockerè½¯ä»¶æº</a></li>
        <li><a href="#å®‰è£…docker">å®‰è£…docker</a></li>
        <li><a href="#å¯åŠ¨å¹¶æµ‹è¯•docker">å¯åŠ¨å¹¶æµ‹è¯•Docker</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#dockerä¸‹è½½åŠ é€Ÿ">dockerä¸‹è½½åŠ é€Ÿ</a></li>
    <li><a href="#dockeré…ç½®ä»£ç†">Dockeré…ç½®ä»£ç†</a></li>
  </ol>

  <ol>
    <li><a href="#å¯åŠ¨ç±»å‘½ä»¤">å¯åŠ¨ç±»å‘½ä»¤</a></li>
    <li><a href="#å¸®åŠ©ç±»å‘½ä»¤">å¸®åŠ©ç±»å‘½ä»¤</a></li>
    <li><a href="#é•œåƒå‘½ä»¤">é•œåƒå‘½ä»¤</a>
      <ol>
        <li><a href="#åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ">åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ</a></li>
        <li><a href="#åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢é•œåƒ">åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢é•œåƒ</a></li>
        <li><a href="#ä¸‹è½½é•œåƒ">ä¸‹è½½é•œåƒ</a></li>
        <li><a href="#æŸ¥çœ‹å æ®çš„ç©ºé—´">æŸ¥çœ‹å æ®çš„ç©ºé—´</a></li>
        <li><a href="#åˆ é™¤é•œåƒ">åˆ é™¤é•œåƒ</a></li>
      </ol>
    </li>
    <li><a href="#å‘½ä»¤è‡ªåŠ¨è¡¥å…¨">å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</a></li>
  </ol>

  <ol>
    <li><a href="#æ–°å»ºå¯åŠ¨å®¹å™¨">æ–°å»ºå¯åŠ¨å®¹å™¨</a>
      <ol>
        <li><a href="#å¯åŠ¨äº¤äº’å¼å®¹å™¨">å¯åŠ¨äº¤äº’å¼å®¹å™¨</a></li>
        <li><a href="#å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨">å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨</a></li>
      </ol>
    </li>
    <li><a href="#åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨">åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨</a></li>
    <li><a href="#å®¹å™¨å…¶ä»–å¯åœæ“ä½œ">å®¹å™¨å…¶ä»–å¯åœæ“ä½œ</a>
      <ol>
        <li><a href="#å¯åŠ¨å·²ç»åœæ­¢çš„å®¹å™¨">å¯åŠ¨å·²ç»åœæ­¢çš„å®¹å™¨</a></li>
        <li><a href="#é‡å¯å®¹å™¨">é‡å¯å®¹å™¨</a></li>
        <li><a href="#åœæ­¢å®¹å™¨">åœæ­¢å®¹å™¨</a></li>
        <li><a href="#å¼ºåˆ¶åœæ­¢å®¹å™¨">å¼ºåˆ¶åœæ­¢å®¹å™¨</a></li>
      </ol>
    </li>
    <li><a href="#åˆ é™¤å®¹å™¨">åˆ é™¤å®¹å™¨</a></li>
    <li><a href="#æŸ¥çœ‹å®¹å™¨æ—¥å¿—">æŸ¥çœ‹å®¹å™¨æ—¥å¿—</a></li>
    <li><a href="#æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹">æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹</a></li>
    <li><a href="#æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚">æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚</a></li>
    <li><a href="#è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨">è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨</a></li>
    <li><a href="#å®¹å™¨å’Œå®¿ä¸»æœºæ–‡ä»¶æ‹·è´">å®¹å™¨å’Œå®¿ä¸»æœºæ–‡ä»¶æ‹·è´</a></li>
    <li><a href="#å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨">å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨</a></li>
    <li><a href="#å°†å®¹å™¨ç”Ÿæˆæ–°é•œåƒ">å°†å®¹å™¨ç”Ÿæˆæ–°é•œåƒ</a></li>
    <li><a href="#å®¹å™¨æ•°æ®å·">å®¹å™¨æ•°æ®å·</a></li>
    <li><a href="#æ‰€æœ‰å‘½ä»¤ç¤ºæ„å›¾">æ‰€æœ‰å‘½ä»¤ç¤ºæ„å›¾</a></li>
  </ol>

  <ol>
    <li><a href="#é•œåƒ">é•œåƒ</a></li>
    <li><a href="#docker-é•œåƒåŠ è½½åŸç†">Docker é•œåƒåŠ è½½åŸç†</a>
      <ol>
        <li><a href="#è”åˆæ–‡ä»¶ç³»ç»Ÿ">è”åˆæ–‡ä»¶ç³»ç»Ÿ</a></li>
        <li><a href="#bootfså’Œrootfs">bootfså’Œrootfs</a></li>
        <li><a href="#é•œåƒåˆ†å±‚">é•œåƒåˆ†å±‚</a></li>
      </ol>
    </li>
    <li><a href="#é•œåƒåˆ†å±‚çš„ä¼˜åŠ¿">é•œåƒåˆ†å±‚çš„ä¼˜åŠ¿</a></li>
    <li><a href="#å®¹å™¨å±‚">å®¹å™¨å±‚</a></li>
  </ol>

  <ol>
    <li><a href="#ä½¿ç”¨nexusåˆ›å»ºdockerç§æœ‰ä»“åº“">ä½¿ç”¨nexusåˆ›å»ºdockerç§æœ‰ä»“åº“</a></li>
    <li><a href="#dockerå®¢æˆ·ç«¯çš„é•œåƒå¯¼å‡ºå’Œå¯¼å…¥">dockerå®¢æˆ·ç«¯çš„é•œåƒå¯¼å‡ºå’Œå¯¼å…¥</a></li>
    <li><a href="#docker-å®¢æˆ·ç«¯å‘ç§ä»“ä¸Šä¼ é•œåƒ">docker å®¢æˆ·ç«¯å‘ç§ä»“ä¸Šä¼ é•œåƒ</a>
      <ol>
        <li><a href="#é…ç½®dockerå…è®¸æ¥æ”¶httpè¯·æ±‚">é…ç½®dockerå…è®¸æ¥æ”¶<code>http</code>è¯·æ±‚</a></li>
        <li><a href="#å‘ç§ä»“æ¨é€é•œåƒ">å‘ç§ä»“æ¨é€é•œåƒ</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#docker-registry">Docker Registry</a></li>
    <li><a href="#ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</a></li>
    <li><a href="#å‘registryç§ä»“ä¸­ä¸Šä¼ é•œåƒ">å‘Registryç§ä»“ä¸­ä¸Šä¼ é•œåƒ</a>
      <ol>
        <li><a href="#é…ç½®dockerå…è®¸æ¥æ”¶httpè¯·æ±‚-1">é…ç½®dockerå…è®¸æ¥æ”¶<code>http</code>è¯·æ±‚</a></li>
        <li><a href="#æ¨é€åˆ°ç§ä»“">æ¨é€åˆ°ç§ä»“</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#docker-å®‰è£…-mysql">Docker å®‰è£… Mysql</a></li>
    <li><a href="#mysql-å•æœº">Mysql å•æœº</a>
      <ol>
        <li><a href="#ç®€å•ç‰ˆ-mysql-57-å®‰è£…">ç®€å•ç‰ˆ Mysql 5.7 å®‰è£…</a></li>
        <li><a href="#å®é™…åº”ç”¨ç‰ˆ-mysql-57å®‰è£…">å®é™…åº”ç”¨ç‰ˆ Mysql 5.7å®‰è£…</a></li>
      </ol>
    </li>
    <li><a href="#mysql-ä¸»ä»å¤åˆ¶å®‰è£…">Mysql ä¸»ä»å¤åˆ¶å®‰è£…</a></li>
  </ol>

  <ol>
    <li><a href="#dockerå®‰è£…redis">Dockerå®‰è£…Redis</a></li>
    <li><a href="#å•æœºç‰ˆå®‰è£…">å•æœºç‰ˆå®‰è£…</a>
      <ol>
        <li><a href="#ç®€å•ç‰ˆ-redis">ç®€å•ç‰ˆ Redis</a></li>
        <li><a href="#å®é™…åº”ç”¨ç‰ˆredis">å®é™…åº”ç”¨ç‰ˆRedis</a></li>
      </ol>
    </li>
    <li><a href="#é›†ç¾¤å­˜å‚¨ç®—æ³•">é›†ç¾¤å­˜å‚¨ç®—æ³•</a>
      <ol>
        <li><a href="#åˆ†å¸ƒå¼å­˜å‚¨ç®—æ³•">åˆ†å¸ƒå¼å­˜å‚¨ç®—æ³•</a></li>
        <li><a href="#å“ˆå¸Œå–ä½™ç®—æ³•">å“ˆå¸Œå–ä½™ç®—æ³•</a></li>
        <li><a href="#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•">ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</a></li>
        <li><a href="#å“ˆå¸Œæ§½åˆ†åŒº">å“ˆå¸Œæ§½åˆ†åŒº</a></li>
        <li><a href="#redisé›†ç¾¤å­˜å‚¨ç­–ç•¥">Redisé›†ç¾¤å­˜å‚¨ç­–ç•¥</a></li>
      </ol>
    </li>
    <li><a href="#3ä¸»3ä»redisé›†ç¾¤">3ä¸»3ä»Redisé›†ç¾¤</a>
      <ol>
        <li><a href="#æ­å»º">æ­å»º</a></li>
        <li><a href="#redisé›†ç¾¤è¯»å†™å‡ºé”™">Redisé›†ç¾¤è¯»å†™å‡ºé”™</a></li>
        <li><a href="#é›†ç¾¤ä¿¡æ¯æ£€æŸ¥">é›†ç¾¤ä¿¡æ¯æ£€æŸ¥</a></li>
      </ol>
    </li>
    <li><a href="#ä¸»ä»æ‰©å®¹ç¼©å®¹">ä¸»ä»æ‰©å®¹ç¼©å®¹</a>
      <ol>
        <li><a href="#ä¸»ä»æ‰©å®¹">ä¸»ä»æ‰©å®¹</a></li>
        <li><a href="#ä¸»ä»ç¼©å®¹">ä¸»ä»ç¼©å®¹</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#dockerfile">Dockerfile</a></li>
    <li><a href="#æ„å»ºè¿‡ç¨‹">æ„å»ºè¿‡ç¨‹</a></li>
    <li><a href="#dockerfileä¿ç•™å­—">Dockerfileä¿ç•™å­—</a>
      <ol>
        <li><a href="#from">FROM</a></li>
        <li><a href="#maintainer">MAINTAINER</a></li>
        <li><a href="#run">RUN</a></li>
        <li><a href="#expose">EXPOSE</a></li>
        <li><a href="#workdir">WORKDIR</a></li>
        <li><a href="#user">USER</a></li>
        <li><a href="#env">ENV</a></li>
        <li><a href="#volume">VOLUME</a></li>
        <li><a href="#add">ADD</a></li>
        <li><a href="#copy">COPY</a></li>
        <li><a href="#cmd">CMD</a></li>
        <li><a href="#entrypoint">ENTRYPOINT</a></li>
      </ol>
    </li>
    <li><a href="#æ„å»ºé•œåƒ">æ„å»ºé•œåƒ</a></li>
    <li><a href="#è™šæ‚¬é•œåƒ">è™šæ‚¬é•œåƒ</a></li>
  </ol>

  <ol>
    <li><a href="#æ­å»ºspringbooté¡¹ç›®">æ­å»ºSpringBooté¡¹ç›®</a></li>
    <li><a href="#å‘å¸ƒå¾®æœåŠ¡é¡¹ç›®åˆ°dockerå®¹å™¨">å‘å¸ƒå¾®æœåŠ¡é¡¹ç›®åˆ°Dockerå®¹å™¨</a></li>
  </ol>

  <ol>
    <li><a href="#docker-ç½‘ç»œ">Docker ç½‘ç»œ</a></li>
    <li><a href="#dockerç½‘ç»œå‘½ä»¤">dockerç½‘ç»œå‘½ä»¤</a></li>
    <li><a href="#docker-ç½‘ç»œæ¨¡å¼">Docker ç½‘ç»œæ¨¡å¼</a></li>
    <li><a href="#docker0">docker0</a></li>
    <li><a href="#bridgeæ¨¡å¼">bridgeæ¨¡å¼</a></li>
    <li><a href="#hostæ¨¡å¼">hostæ¨¡å¼</a></li>
    <li><a href="#noneæ¨¡å¼">noneæ¨¡å¼</a></li>
    <li><a href="#containeræ¨¡å¼">containeræ¨¡å¼</a></li>
    <li><a href="#è‡ªå®šä¹‰ç½‘ç»œ">è‡ªå®šä¹‰ç½‘ç»œ</a></li>
    <li><a href="#linkè¿æ¥">linkè¿æ¥</a></li>
  </ol>

  <ol>
    <li><a href="#docker-compose">Docker-compose</a></li>
    <li><a href="#å®‰è£…docker-compose">å®‰è£…Docker-Compose</a></li>
    <li><a href="#å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</a></li>
    <li><a href="#composeç¼–æ’å®ä¾‹">composeç¼–æ’å®ä¾‹</a></li>
  </ol>

  <ol>
    <li><a href="#portainerdockerè½»é‡çº§å¯è§†åŒ–å·¥å…·">Portainerï¼šDockerè½»é‡çº§å¯è§†åŒ–å·¥å…·</a></li>
    <li><a href="#å®‰è£…">å®‰è£…</a></li>
  </ol>

  <ol>
    <li><a href="#cig">CIG</a>
      <ol>
        <li><a href="#cadvisor">CAdvisor</a></li>
        <li><a href="#influxdb">InfluxDB</a></li>
        <li><a href="#granfana">Granfana</a></li>
      </ol>
    </li>
    <li><a href="#å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²</a></li>
    <li><a href="#grafanaé…ç½®">Grafanaé…ç½®</a>
      <ol>
        <li><a href="#æ·»åŠ æ•°æ®æº">æ·»åŠ æ•°æ®æº</a></li>
        <li><a href="#æ·»åŠ å·¥ä½œå°">æ·»åŠ å·¥ä½œå°</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/">Dockerç›¸å…³ç¬”è®°</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-04-15</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="01-dockeræ¦‚è¿°"><strong>01-Dockeræ¦‚è¿°</strong>
</h1><h2 id="dockerç®€ä»‹">Dockerç®€ä»‹
</h2><p>Dockeræ˜¯åŸºäºGoè¯­è¨€å®ç°çš„äº‘å¼€æºé¡¹ç›®ã€‚</p>
<p>Dockerçš„ä¸»è¦ç›®æ ‡æ˜¯ï¼š<code>Build, Ship and Run Any App, Anywhere</code>ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å¯¹åº”ç”¨ç»„ä»¶çš„å°è£…ã€åˆ†å‘ã€éƒ¨ç½²ã€è¿è¡Œç­‰ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œä½¿ç”¨æˆ·çš„APPåŠå…¶è¿è¡Œç¯å¢ƒèƒ½åšåˆ°<strong>ä¸€æ¬¡é•œåƒ,å¤„å¤„è¿è¡Œ</strong>ã€‚</p>
<h2 id="ä¼ ç»Ÿè™šæ‹Ÿæœºå’Œå®¹å™¨">ä¼ ç»Ÿè™šæ‹Ÿæœºå’Œå®¹å™¨
</h2><p>ä¼ ç»Ÿè™šæ‹Ÿæœºï¼ˆvirtual machineï¼‰ï¼š</p>
<p>ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯åŸºäºå®‰è£…åœ¨ä¸»æ“ä½œç³»ç»Ÿä¸Šçš„è™šæ‹Ÿæœºç®¡ç†ç³»ç»Ÿï¼ˆå¦‚VirtualBoxã€VMwareç­‰ï¼‰ï¼Œåˆ›å»ºè™šæ‹Ÿæœºï¼ˆè™šæ‹Ÿå‡ºå„ç§ç¡¬ä»¶ï¼‰ï¼Œåœ¨è™šæ‹Ÿæœºä¸Šå®‰è£…ä»æ“ä½œç³»ç»Ÿï¼Œåœ¨ä»æ“ä½œç³»ç»Ÿä¸­å®‰è£…éƒ¨ç½²å„ç§åº”ç”¨ã€‚</p>
<p>ç¼ºç‚¹ï¼šèµ„æºå ç”¨å¤šã€å†—ä½™æ­¥éª¤å¤šã€å¯åŠ¨æ…¢</p>
<p>Linuxå®¹å™¨ï¼ˆLinux Containerï¼Œç®€ç§°LXCï¼‰ï¼š</p>
<p>Linuxå®¹å™¨æ˜¯ä¸ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†åˆ†éš”å¼€çš„ä¸€ç³»åˆ—è¿›ç¨‹ï¼Œä»å¦ä¸€ä¸ªé•œåƒè¿è¡Œï¼Œå¹¶ç”±è¯¥é•œåƒæä¾›æ”¯æŒè¿›ç¨‹æ‰€éœ€çš„å…¨éƒ¨æ–‡ä»¶ã€‚å®¹å™¨æä¾›çš„é•œåƒåŒ…å«äº†åº”ç”¨çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Œå› è€Œåœ¨ä»å¼€å‘åˆ°æµ‹è¯•å†åˆ°ç”Ÿäº§çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®ƒéƒ½å…·æœ‰å¯ç§»æ¤æ€§å’Œä¸€è‡´æ€§ã€‚</p>
<p>Linuxå®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚æœ‰äº†å®¹å™¨ï¼Œå°±å¯ä»¥å°†è½¯ä»¶è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰èµ„æºæ‰“åŒ…åˆ°ä¸€ä¸ªéš”ç¦»çš„å®¹å™¨ä¸­ã€‚å®¹å™¨ä¸è™šæ‹Ÿæœºä¸åŒï¼Œä¸éœ€è¦æ†ç»‘ä¸€æ•´å¥—æ“ä½œç³»ç»Ÿï¼Œåªéœ€è¦è½¯ä»¶å·¥ä½œæ‰€éœ€çš„åº“èµ„æºå’Œè®¾ç½®ã€‚ç³»ç»Ÿå› æ­¤è€Œå˜å¾—é«˜æ•ˆè½»é‡å¹¶ä¿è¯éƒ¨ç½²åœ¨ä»»ä½•ç¯å¢ƒä¸­çš„è½¯ä»¶éƒ½èƒ½å§‹ç»ˆå¦‚ä¸€çš„è¿è¡Œã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/virtual-machine-vs-docker-container.jpg"
	width="937"
	height="499"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/virtual-machine-vs-docker-container_hu2953685954180483545.jpg 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/virtual-machine-vs-docker-container_hu16085751589340386713.jpg 1024w"
	loading="lazy"
	
		alt="virtual-machine-vs-docker-container"
	
	
		class="gallery-image" 
		data-flex-grow="187"
		data-flex-basis="450px"
	
></p>
<p>å¯¹æ¯”ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>å®¹å™¨</th>
<th>è™šæ‹Ÿæœº</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯åŠ¨</td>
<td>ç§’çº§</td>
<td>åˆ†é’Ÿçº§</td>
</tr>
<tr>
<td>å¤§å°</td>
<td>ä¸€èˆ¬ä¸ºMb</td>
<td>ä¸€èˆ¬ä¸ºGb</td>
</tr>
<tr>
<td>é€Ÿåº¦</td>
<td>æ¥è¿‘åŸç”Ÿ</td>
<td>æ¯”è¾ƒæ…¢</td>
</tr>
<tr>
<td>ç³»ç»Ÿæ”¯æŒæ•°é‡</td>
<td>å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨</td>
<td>ä¸€èˆ¬å‡ åä¸ª</td>
</tr>
<tr>
<td><strong>éš”ç¦»æ€§</strong></td>
<td><strong>é€šè¿‡namespaceå®ç°èµ„æºéš”ç¦»ï¼Œé€šè¿‡cgroupå®ç°é™åˆ¶èµ„æºçš„æœ€å¤§ä½¿ç”¨é‡</strong></td>
<td><strong>å®Œå…¨éš”ç¦»ï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æœ‰ç‹¬ç«‹çš„ç¡¬ä»¶</strong></td>
</tr>
<tr>
<td><strong>å†…æ ¸</strong></td>
<td><strong>æ‰€æœ‰å®¹å™¨å…±äº«å®¿ä¸»æœºçš„å†…æ ¸</strong></td>
<td><strong>æ¯ä¸ªè™šæ‹Ÿæœºéƒ½æœ‰ç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿå’Œå†…æ ¸</strong></td>
</tr>
</tbody>
</table></div>
<h2 id="dockerè¿è¡Œé€Ÿåº¦å¿«çš„åŸå› ">Dockerè¿è¡Œé€Ÿåº¦å¿«çš„åŸå› 
</h2><p>Dockeræœ‰æ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚ï¼š</p>
<p>ç”±äºDockerä¸éœ€è¦Hypervisorï¼ˆè™šæ‹Ÿæœºï¼‰å®ç°ç¡¬ä»¶èµ„æºè™šæ‹ŸåŒ–ï¼Œè¿è¡Œåœ¨Dockerå®¹å™¨ä¸Šçš„ç¨‹åºç›´æ¥ä½¿ç”¨çš„éƒ½æ˜¯å®é™…ç‰©ç†æœºçš„ç¡¬ä»¶èµ„æºï¼Œå› æ­¤åœ¨CPUã€å†…å­˜åˆ©ç”¨ç‡ä¸Šdockeræœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚</p>
<p>Dockeråˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ï¼Œè€Œä¸éœ€è¦åŠ è½½æ“ä½œç³»ç»ŸOSå†…æ ¸ï¼š</p>
<p>å½“æ–°å»ºä¸€ä¸ªå®¹å™¨æ—¶ï¼ŒDockerä¸éœ€è¦å’Œè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸ã€‚è¿›è€Œé¿å…å¼•å¯»ã€åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸è¿”å›ç­‰æ¯”è¾ƒè€—æ—¶è€—èµ„æºçš„è¿‡ç¨‹ã€‚å½“æ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ—¶ï¼Œè™šæ‹Ÿæœºè½¯ä»¶éœ€è¦åŠ è½½OSï¼Œè¿”å›æ–°å»ºè¿‡ç¨‹æ˜¯åˆ†é’Ÿçº§åˆ«çš„ã€‚è€ŒDockerç”±äºç›´æ¥åˆ©ç”¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œåˆ™çœç•¥äº†è¿”å›è¿‡ç¨‹ï¼Œå› æ­¤æ–°å»ºä¸€ä¸ªdockerå®¹å™¨åªéœ€è¦å‡ ç§’é’Ÿã€‚</p>
<p>Dockerå®¹å™¨çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚</p>
<h2 id="dockerè½¯ä»¶">Dockerè½¯ä»¶
</h2><p>Dockerå¹¶éä¸€ä¸ªé€šç”¨çš„å®¹å™¨å·¥å…·ï¼Œå®ƒä¾èµ–äºå·²ç»å­˜åœ¨å¹¶è¿è¡Œçš„Linuxå†…æ ¸ç¯å¢ƒã€‚ï¼ˆåœ¨Windowsä¸Šå®‰è£…Dockeræ—¶éœ€è¦ä¾èµ–WLSï¼Œä¹Ÿå³Windowsä¸‹çš„Linuxå­ç³»ç»Ÿï¼‰ã€‚</p>
<p>Dockerå®è´¨ä¸Šæ˜¯åœ¨å·²ç»è¿è¡Œçš„Linuxä¸‹åˆ¶é€ äº†ä¸€ä¸ªéš”ç¦»çš„æ–‡ä»¶ç¯å¢ƒï¼Œå› æ­¤å®ƒæ‰§è¡Œçš„æ•ˆç‡å‡ ä¹ç­‰åŒäºæ‰€éƒ¨ç½²çš„Linuxä¸»æœºã€‚</p>
<p>Dockerçš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼š</p>
<ul>
<li>
<p>é•œåƒï¼ˆimageï¼‰</p>
</li>
<li>
<p>å®¹å™¨ï¼ˆcontainerï¼‰</p>
</li>
<li>
<p>ä»“åº“ï¼ˆrepositoryï¼‰</p>
</li>
</ul>
<h3 id="dockeré•œåƒ">Dockeré•œåƒ
</h3><p>Dockeré•œåƒå°±æ˜¯ä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ã€‚é•œåƒå¯ä»¥ç”¨æ¥åˆ›å»ºDockerå®¹å™¨ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ã€‚</p>
<h3 id="dockerå®¹å™¨">Dockerå®¹å™¨
</h3><p>Dockeråˆ©ç”¨å®¹å™¨ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºæˆ–æœåŠ¡è¿è¡Œåœ¨å®¹å™¨é‡Œé¢ï¼Œå®¹å™¨å°±ç±»ä¼¼äºä¸€ä¸ªè™šæ‹ŸåŒ–çš„è¿è¡Œç¯å¢ƒï¼Œå®¹å™¨æ˜¯ç”¨é•œåƒåˆ›å»ºçš„è¿è¡Œå®ä¾‹ã€‚</p>
<h3 id="dockerä»“åº“">Dockerä»“åº“
</h3><p>Dockerä»“åº“æ˜¯é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœºæ‰€ã€‚</p>
<p>ä»“åº“åˆ†ä¸ºå…¬å¼€ä»“åº“å’Œç§æœ‰ä»“åº“ä¸¤ç§ã€‚</p>
<p>æœ€å¤§çš„å…¬å¼€ä»“åº“æ˜¯Dockerå®˜æ–¹çš„Docker Hubï¼šhttps://hub.docker.com/</p>
<h2 id="dockeræ¶æ„">Dockeræ¶æ„
</h2><p>Dockeræ˜¯ä¸€ä¸ª C/Sï¼ˆClient-Serverï¼‰ ç»“æ„çš„ç³»ç»Ÿï¼Œåç«¯æ˜¯ä¸€ä¸ªæ¾è€¦åˆæ¶æ„ï¼Œä¼—å¤šæ¨¡å—å„å¸å…¶èŒã€‚</p>
<p>Dockerå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸»æœºä¸Šï¼Œç„¶åé€šè¿‡Socketè¿æ¥ä»å®¢æˆ·ç«¯è®¿é—®ï¼Œå®ˆæŠ¤è¿›ç¨‹ä»å®¹å™¨æ¥æ”¶å‘½ä»¤å¹¶ç®¡ç†è¿è¡Œåœ¨ä¸»æœºä¸Šçš„å®¹å™¨ã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/architecture.svg"
	
	
	
	loading="lazy"
	
		alt="architecture"
	
	
></p>
<p>Dockerè¿è¡Œçš„åŸºæœ¬æµç¨‹ä¸ºï¼š</p>
<ol>
<li>
<p>ç”¨æˆ·æ˜¯ä½¿ç”¨Docker Client ä¸ Docker Daemon å»ºç«‹é€šä¿¡ï¼Œå¹¶å‘é€è¯·æ±‚ç»™åè€…</p>
</li>
<li>
<p>Docker Daemon ä½œä¸º Docker æ¶æ„çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé¦–å…ˆæä¾› Docker Server çš„åŠŸèƒ½ä½¿å…¶å¯ä»¥æ¥æ”¶ Docker Client çš„è¯·æ±‚</p>
</li>
<li>
<p>Docker Engine æ‰§è¡Œ Docker å†…éƒ¨çš„ä¸€ç³»åˆ—å·¥ä½œï¼Œæ¯ä¸€é¡¹å·¥ä½œéƒ½æ˜¯ä»¥ä¸€ä¸ª Job çš„å½¢å¼å­˜åœ¨</p>
</li>
<li>
<p>Job çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦å®¹å™¨é•œåƒæ—¶ï¼Œåˆ™ä» Docker Registry ä¸­ä¸‹è½½é•œåƒï¼Œå¹¶é€šè¿‡é•œåƒç®¡ç†é©±åŠ¨ Graph Driver å°†ä¸‹è½½é•œåƒä»¥ Graph çš„å½¢å¼å­˜å‚¨</p>
</li>
<li>
<p>å½“éœ€è¦ä¸º Docker åˆ›å»ºç½‘ç»œç¯å¢ƒæ—¶ï¼Œé€šè¿‡ç½‘ç»œç®¡ç†é©±åŠ¨ Network driver åˆ›å»ºå¹¶é…ç½® Docker å®¹å™¨ç½‘ç»œç¯å¢ƒ</p>
</li>
<li>
<p>å½“éœ€è¦é™åˆ¶ Docker å®¹å™¨è¿è¡Œèµ„æºæˆ–æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ç­‰æ“ä½œæ—¶ï¼Œåˆ™é€šè¿‡ Exec driver æ¥å®Œæˆ</p>
</li>
<li>
<p>Libcontainer æ˜¯ä¸€é¡¹ç‹¬ç«‹çš„å®¹å™¨ç®¡ç†åŒ…ï¼ŒNetwork driver ä»¥åŠ Exec driver éƒ½æ˜¯é€šè¿‡ Libcontainer æ¥å®ç°å…·ä½“å¯¹å®¹å™¨è¿›è¡Œçš„æ“ä½œ</p>
</li>
</ol>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/flow.png"
	width="937"
	height="1295"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/flow_hu6210446523311892339.png 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/flow_hu6167510121319342689.png 1024w"
	loading="lazy"
	
		alt="flow"
	
	
		class="gallery-image" 
		data-flex-grow="72"
		data-flex-basis="173px"
	
></p>
<h1 id="02-dockerå®‰è£…"><strong>02-Dockerå®‰è£…</strong>
</h1><h2 id="centoså®‰è£…docker">CentOSå®‰è£…Docker
</h2><p>å‚è€ƒå®˜ç½‘ï¼šhttps://docs.docker.com/engine/install/centos/</p>
<h3 id="å¸è½½æ—§ç‰ˆæœ¬">å¸è½½æ—§ç‰ˆæœ¬
</h3><p>å¦‚æœä¹‹å‰å®‰è£…è¿‡Dockerï¼Œéœ€è¦å…ˆå¸è½½æ—§ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum remove docker <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                  docker-client <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                  docker-client-latest <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                  docker-common <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                  docker-latest <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                  docker-latest-logrotate <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                  docker-logrotate <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                  docker-engine
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ—§ç‰ˆæœ¬çš„Dockerå¼•æ“åŒ…å¯èƒ½å«åšï¼š<code>docker</code>ã€<code>docker-engine</code>ã€‚</p>
<p>æ–°ç‰ˆæœ¬çš„Dockerå¼•æ“åŒ…å«åšï¼š<code>docker-ce</code></p>
<h3 id="é…ç½®yumèµ„æºåº“">é…ç½®yumèµ„æºåº“
</h3><p>å®‰è£…<code>yum-config-manager</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># yum-utilæä¾›yum-config-manageråŠŸèƒ½ </span>
</span></span><span class="line"><span class="cl">sudo yum install -y yum-utils
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®dockerçš„èµ„æºåº“åœ°å€ï¼š</p>
<p>å®˜æ–¹åœ°å€ï¼šï¼ˆæ¯”è¾ƒæ…¢ï¼Œä¸æ¨èï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># åœ¨yumèµ„æºåº“ä¸­æ·»åŠ dockerèµ„æºåº“</span>
</span></span><span class="line"><span class="cl">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
</span></span></code></pre></td></tr></table>
</div>
</div><p>é˜¿é‡Œäº‘é•œåƒåœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</span></span></code></pre></td></tr></table>
</div>
</div><p>é˜¿é‡Œäº‘å®˜ç½‘æä¾›äº†å¾ˆå¤šèµ„æºé•œåƒï¼Œé•œåƒåœ°å€ï¼š<code>https://mirrors.aliyun.com</code>ï¼Œè¿›å…¥ä¹‹åå¯ä»¥é€‰æ‹©è‡ªå·±éœ€è¦çš„èµ„æºè¿›è¡Œé…ç½®</p>
<p>åˆ›å»ºç¼“å­˜ï¼ˆå¯é€‰ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yum makecache fast
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…dockerå¼•æ“">å®‰è£…Dockerå¼•æ“
</h3><p>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Dockerå¼•æ“ã€Dockerå®¢æˆ·ç«¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># docker-ceæ˜¯Dockerå¼•æ“ï¼Œdocker-ce-cliæ˜¯å®¢æˆ·ç«¯</span>
</span></span><span class="line"><span class="cl">sudo yum install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶ï¼Œé»˜è®¤å®‰è£…çš„dockerå¼•æ“ã€å®¢æˆ·ç«¯éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<p>å¦‚æœè¦å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æŸ¥è¯¢ç‰ˆæœ¬åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl">yum list docker-ce --showduplicates <span class="p">|</span> sort -r
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŒ‡å®šç‰ˆæœ¬å®‰è£…17.09.0.ceç‰ˆ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-compose-plugin</span>
</span></span><span class="line"><span class="cl">sudo yum install docker-ce-17.09.0.ce docker-ce-cli-17.09.0.ce containerd.io docker-compose-plugin
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¯åŠ¨dockerå¼•æ“">å¯åŠ¨dockerå¼•æ“
</h3><p>å¦‚æœæ²¡æœ‰å¯åŠ¨Dockerå¼•æ“ï¼Œé‚£ä¹ˆæ‰§è¡Œ <code>docker version</code>æŸ¥çœ‹ç‰ˆæœ¬å·æ—¶ï¼Œåªèƒ½çœ‹åˆ° <code>Client: Docker Engine</code>ï¼ˆDockerå¼•æ“å®¢æˆ·ç«¯ï¼‰çš„ç‰ˆæœ¬å·ã€‚</p>
<p>å¯åŠ¨Dockerå¼•æ“ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ–°ç‰ˆæœ¬çš„Dockerå°±æ˜¯ä¸€ä¸ªç³»ç»ŸæœåŠ¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¯åŠ¨ç³»ç»ŸæœåŠ¡æ–¹å¼å¯åŠ¨</span>
</span></span><span class="line"><span class="cl">systemctl start docker
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ­¤æ—¶æŸ¥çœ‹dockerç‰ˆæœ¬ï¼Œå¯ä»¥çœ‹åˆ°Server: Docker Engineï¼ˆDockerå¼•æ“ï¼‰ç‰ˆæœ¬å·</span>
</span></span><span class="line"><span class="cl">docker version
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¸è½½docker">å¸è½½Docker
</h2><p>å¸è½½Dockeræ­¥éª¤ï¼š</p>
<ol>
<li>å…³é—­æœåŠ¡</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl stop docker
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>ä½¿ç”¨<code>yum</code>åˆ é™¤dockerå¼•æ“</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum remove docker-ce docker-ce-cli containerd.io
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>åˆ é™¤é•œåƒã€å®¹å™¨ã€å·ã€è‡ªå®šä¹‰é…ç½®ç­‰æ–‡ä»¶</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> sudo rm -rf /var/lib/docker
</span></span><span class="line"><span class="cl"> sudo rm -rf /var/lib/containerd
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è¿è¡Œhelloworldæµ‹è¯•">è¿è¡ŒHelloWorldæµ‹è¯•
</h2><p>è¿è¡ŒHelloWorldï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run hello-world
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ubuntuå®‰è£…docker">Ubuntuå®‰è£…Docker
</h2><h3 id="å¸è½½æ—§ç‰ˆæœ¬-1">å¸è½½æ—§ç‰ˆæœ¬
</h3><p>å¸è½½æ—§ç‰ˆæœ¬Dockerï¼ˆå¦‚æœå·²ç»å®‰è£…ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get remove docker docker-engine docker.io containerd runc
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…ä¾èµ–">å®‰è£…ä¾èµ–
</h3><p>å®‰è£…å¿…è¦çš„ä¾èµ–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install apt-transport-https ca-certificates curl gnupg lsb-release
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ·»åŠ dockerè½¯ä»¶æº">æ·»åŠ dockerè½¯ä»¶æº
</h3><p>å®˜ç½‘æºï¼š(ä¸æ¨èï¼Œå¯èƒ½ä¼šè¿ä¸ä¸ŠæŠ¥é”™)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¯¼å…¥æºä»“åº“çš„ GPG key</span>
</span></span><span class="line"><span class="cl">curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="p">|</span> sudo apt-key add -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å°† Docker APT è½¯ä»¶æºæ·»åŠ åˆ°ä½ çš„ç³»ç»Ÿ</span>
</span></span><span class="line"><span class="cl">sudo add-apt-repository <span class="s2">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é˜¿é‡Œäº‘æºï¼ˆæ¨èï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ·»åŠ Docker GPGå¯†é’¥</span>
</span></span><span class="line"><span class="cl">curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg <span class="p">|</span> sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ·»åŠ Dockerè½¯ä»¶æºä¿¡æ¯</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://mirrors.aliyun.com/docker-ce/linux/ubuntu </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®‰è£…docker">å®‰è£…docker
</h3><p>æ›´æ–°è½¯ä»¶æºå¹¶å®‰è£…Dockerï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install docker-ce docker-ce-cli containerd.io
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¯åŠ¨å¹¶æµ‹è¯•docker">å¯åŠ¨å¹¶æµ‹è¯•Docker
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start docker
</span></span><span class="line"><span class="cl">sudo docker run hello-world
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="03-dockerä¸‹è½½åŠ é€Ÿ"><strong>03-Dockerä¸‹è½½åŠ é€Ÿ</strong>
</h1><h2 id="dockerä¸‹è½½åŠ é€Ÿ">dockerä¸‹è½½åŠ é€Ÿ
</h2><p>æ–¹å¼1ï¼šä½¿ç”¨ ç½‘æ˜“æ•°å¸†ã€é˜¿é‡Œäº‘ç­‰å®¹å™¨é•œåƒä»“åº“è¿›è¡Œä¸‹è½½ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹è½½ç½‘æ˜“æ•°å¸†é•œåƒä¸­çš„mysqlã€‚ï¼ˆç½‘æ˜“æ•°å¸†çš„åœ°å€ä¸º <code>hub.c.163.com</code>ï¼Œç½‘æ˜“æ•°å¸†å¯¹dockerhubå®˜æ–¹çš„é•œåƒå‘½åç©ºé—´ä¸º <code>library</code>ï¼‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull hub.c.163.com/library/mysql:latest
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ–¹å¼2ï¼šé…ç½®é˜¿é‡Œäº‘åŠ é€Ÿã€‚</p>
<p><strong>æ³¨æ„ï¼šè¯¥æ–¹å¼å½“å‰ä»…æ”¯æŒé˜¿é‡Œäº‘ç”¨æˆ·ä½¿ç”¨å…·å¤‡å…¬ç½‘è®¿é—®èƒ½åŠ›çš„é˜¿é‡Œäº‘äº§å“è¿›è¡Œé•œåƒåŠ é€Ÿï¼Œä¸”ä»…é™äºç‰¹å®šèŒƒå›´å†…çš„å®¹å™¨é•œåƒ</strong></p>
<p>ç™»å½•é˜¿é‡Œäº‘ï¼Œè¿›å…¥ <code>å·¥ä½œå°</code> -&gt; <code>å®¹å™¨é•œåƒæœåŠ¡</code> -&gt; <code>é•œåƒå·¥å…·</code> -&gt; <code>é•œåƒåŠ é€Ÿå™¨</code>ã€‚</p>
<p>é‡Œé¢æä¾›äº†ä¸€ä¸ªåŠ é€Ÿå™¨åœ°å€ï¼š<code>https://xxxxx.mirror.aliyuncs.com</code>ï¼Œå°†è¯¥åœ°å€é…ç½®åˆ°dockerä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/docker
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆæ¬¡è¿›æ¥æ—¶æ²¡æœ‰/etc/docker/daemon.jsonæ–‡ä»¶ï¼Œç›´æ¥åˆ›å»ºè¯¥æ–‡ä»¶å³å¯</span>
</span></span><span class="line"><span class="cl">vi /etc/docker/daemon.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>daemon.json</code>ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼šï¼ˆå³åŠ é€Ÿå™¨åœ°å€ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;registry-mirrors&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;https://xxxxx.mirror.aliyuncs.com&#34;</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶ååˆ·æ–°é…ç½®ã€é‡å¯dockerå³å¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># centos6 çš„å‘½ä»¤</span>
</span></span><span class="line"><span class="cl">sudo chkconfig daemon-reload
</span></span><span class="line"><span class="cl">sudo service docker restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># centos7 çš„å‘½ä»¤</span>
</span></span><span class="line"><span class="cl">sudo systemctl daemon-reload
</span></span><span class="line"><span class="cl">sudo systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ–¹å¼2å¯ä»¥ç›´æ¥ä¸‹è½½å®˜æ–¹çš„é•œåƒï¼Œä¸”é•œåƒtagä¸ºå®˜æ–¹tagï¼Œä¸éœ€è¦åŠ ä¸Šäº‘æœåŠ¡å•†çš„åœ°å€ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull mysql:latest
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="dockeré…ç½®ä»£ç†">Dockeré…ç½®ä»£ç†
</h2><p>å¦‚æœä½¿ç”¨äº†ç§‘å­¦ä¸Šç½‘ï¼Œå¯ä»¥ä¸ºdockeré…ç½®ä»£ç†ã€‚</p>
<p>åœ¨<code>/etc/docker/daemon.json</code>æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;proxies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;http-proxy&#34;</span><span class="p">:</span> <span class="s2">&#34;http://127.0.0.1:7890&#34;</span><span class="p">,</span>  <span class="c1">// ä»£ç†åœ°å€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nt">&#34;https-proxy&#34;</span><span class="p">:</span> <span class="s2">&#34;http://127.0.0.1:7890&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;no-proxy&#34;</span><span class="p">:</span> <span class="s2">&#34;localhost&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="04-dockerå¸¸ç”¨å‘½ä»¤"><strong>04-Dockerå¸¸ç”¨å‘½ä»¤</strong>
</h1><h2 id="å¯åŠ¨ç±»å‘½ä»¤">å¯åŠ¨ç±»å‘½ä»¤
</h2><p>å¯åŠ¨dockerï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl start docker
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœæ­¢Dockerï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl stop docker
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‡å¯Dockerï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹çŠ¶æ€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl status docker
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®¾ç½®å¼€æœºè‡ªå¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl <span class="nb">enable</span> docker
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¸®åŠ©ç±»å‘½ä»¤">å¸®åŠ©ç±»å‘½ä»¤
</h2><p>æŸ¥çœ‹Dockerç‰ˆæœ¬ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker version
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹Dockeræ¦‚è¦ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker info
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹Dockeræ€»ä½“å¸®åŠ©æ–‡æ¡£ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker --help
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹dockerå…·ä½“å‘½ä»¤å¸®åŠ©æ–‡æ¡£ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker å…·ä½“å‘½ä»¤ --help
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é•œåƒå‘½ä»¤">é•œåƒå‘½ä»¤
</h2><h3 id="åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ">åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker images
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‚æ•°ï¼š</p>
<ul>
<li>
<p><code>-a</code>ï¼šåˆ—å‡ºæ‰€æœ‰é•œåƒï¼ˆå«å†å²é•œåƒï¼‰</p>
</li>
<li>
<p><code>-q</code>ï¼šåªæ˜¾ç¤ºé•œåƒID</p>
</li>
<li>
<p><code>-f</code>ï¼šè¿‡æ»¤</p>
</li>
</ul>
<h3 id="åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢é•œåƒ">åœ¨è¿œç¨‹ä»“åº“ä¸­æœç´¢é•œåƒ
</h3><p>ï¼ˆé»˜è®¤å–docker hubä¸­æœç´¢ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker search é•œåƒåç§°
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‚æ•°ï¼š</p>
<ul>
<li>
<p><code>-f</code>ï¼šè¿‡æ»¤</p>
</li>
<li>
<p><code>--limit æ•°é‡</code>ï¼šåªå±•ç¤ºå‰å‡ é¡¹</p>
</li>
</ul>
<h3 id="ä¸‹è½½é•œåƒ">ä¸‹è½½é•œåƒ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull é•œåƒåç§°<span class="o">[</span>:tag<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸åŠ  tag æ—¶ï¼Œé»˜è®¤ä¸‹è½½æœ€æ–°çš„é•œåƒï¼ˆå³tagä¸º<code>latest</code>ï¼‰ã€‚</p>
<h3 id="æŸ¥çœ‹å æ®çš„ç©ºé—´">æŸ¥çœ‹å æ®çš„ç©ºé—´
</h3><p>æŸ¥çœ‹é•œåƒ/å®¹å™¨/æ•°æ®å·æ‰€å çš„ç©ºé—´ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker system df
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆ é™¤é•œåƒ">åˆ é™¤é•œåƒ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker rmi é•œåƒåç§°/ID
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥ä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼Œåˆ é™¤å¤šä¸ªé•œåƒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker rmi é•œåƒ1 é•œåƒ2 é•œåƒ3
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ é™¤å…¨éƒ¨é•œåƒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker rmi -f <span class="k">$(</span>docker images -qa<span class="k">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å‘½ä»¤è‡ªåŠ¨è¡¥å…¨">å‘½ä»¤è‡ªåŠ¨è¡¥å…¨
</h2><p>dockeræ”¯æŒå‘½ä»¤è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œå½“è¾“å…¥é•œåƒåå‰å‡ ä½æ—¶ï¼Œå¯ä»¥æŒ‰<code>tab</code>é”®è‡ªåŠ¨è¡¥å…¨é•œåƒåç§°ã€tagç­‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¦‚æœé•œåƒä¸­æœ‰ubuntuï¼ŒæŸ¥çœ‹è¾“å…¥ubæŒ‰ä¸‹tabæ˜¯å¦å¯ä»¥è¡¥å…¨</span>
</span></span><span class="line"><span class="cl">docker run ub
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæŒ‰ä¸‹<code>tab</code>æ—¶æ²¡æœ‰è‡ªåŠ¨è¡¥å…¨ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
<ol>
<li>æ£€æŸ¥æ˜¯å¦å®‰è£…äº†<code>bash-completion</code>ï¼ˆå‘½ä»¤è¡¥å…¨å¢å¼ºåŒ…ï¼‰</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥æœ‰ /usr/share/bash-completion/bash_completion è¿™ä¸ªæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">ls /usr/share/bash-completion/bash_completion
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>å¦‚æœæœ‰<code>/usr/share/bash-completion</code>ç›®å½•ï¼Œä½†æ˜¯æ²¡æœ‰<code>/usr/share/bash-completion/bash_completion</code>æ–‡ä»¶ï¼ˆcentos6ä¸º<code>/etc/bash_completion</code>æ–‡ä»¶ï¼‰ï¼Œåˆ™éœ€è¦å®‰è£…<code>bash-completion</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yum -y install bash-completion
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>æ£€æŸ¥æ˜¯å¦å®‰è£…äº†dockerçš„è‡ªåŠ¨è¡¥å…¨</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥/usr/share/bash-completion/completionsæ–‡ä»¶å¤¹ä¸‹æ˜¯å¦æœ‰dockerå¼€å¤´çš„è‡ªåŠ¨è¡¥å…¨</span>
</span></span><span class="line"><span class="cl"><span class="c1"># dockerå®‰è£…å®Œåä¼šåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆè‡ªåŠ¨è¡¥å…¨æ–‡ä»¶docker</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœå®‰è£…äº†docker-composeï¼Œåˆ™è¯¥æ–‡ä»¶å¤¹ä¸‹è¿˜ä¼šæœ‰ docker-composeæ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">ll /usr/share/bash-completion/completions/docker*
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>å¦‚æœå·²ç»å®‰è£…äº†dockerè‡ªåŠ¨è¡¥å…¨ï¼Œä½¿ç”¨<code>source</code>å‘½ä»¤ä½¿å…¶ç”Ÿæ•ˆ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">source</span> /usr/share/bash-completion/completions/docker
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>å†æ¬¡ä½¿ç”¨<code>tab</code>æŸ¥çœ‹æ˜¯å¦å¯ä»¥è‡ªåŠ¨è¡¥å…¨</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¦‚æœé•œåƒä¸­æœ‰ubuntuï¼ŒæŸ¥çœ‹è¾“å…¥ubæŒ‰ä¸‹tabæ˜¯å¦å¯ä»¥è¡¥å…¨</span>
</span></span><span class="line"><span class="cl">docker run ub
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>å¦‚æœæœ‰æŠ¥é”™ï¼Œä¸”æŠ¥é”™ä¸­æç¤º<code>_get_comp_words_by_ref: command not found</code>ã€‚è¯´æ˜<code>bash-completion</code>çš„é…ç½®æ–‡ä»¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œéœ€è¦<code>source</code>ä¸€ä¸‹</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¯¹äºcentos7ï¼Œbash-completionå®‰è£…çš„æ˜¯2.xç‰ˆæœ¬ï¼Œé…ç½®æ–‡ä»¶ä¸º/usr/share/bash-completion/bash_completion</span>
</span></span><span class="line"><span class="cl"><span class="nb">source</span> /usr/share/bash-completion/bash_completion
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¦‚æœæ˜¯centos6ï¼Œè‡ªåŠ¨å®‰è£…çš„bash-completionæœ€æ–°ç‰ˆä¸º1.xç‰ˆæœ¬ï¼Œé…ç½®æ–‡ä»¶ä¸º/etc/bash_completion</span>
</span></span><span class="line"><span class="cl"><span class="c1"># bash /etc/bash_completion</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>å†æ¬¡ä½¿ç”¨<code>tab</code>æŸ¥çœ‹æ˜¯å¦å¯ä»¥è‡ªåŠ¨è¡¥å…¨</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¦‚æœé•œåƒä¸­æœ‰ubuntuï¼ŒæŸ¥çœ‹è¾“å…¥ubæŒ‰ä¸‹tabæ˜¯å¦å¯ä»¥è¡¥å…¨</span>
</span></span><span class="line"><span class="cl">docker run ub
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="05-å®¹å™¨å‘½ä»¤"><strong>05-å®¹å™¨å‘½ä»¤</strong>
</h1><h2 id="æ–°å»ºå¯åŠ¨å®¹å™¨">æ–°å»ºå¯åŠ¨å®¹å™¨
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run <span class="o">[</span>OPTIONS<span class="o">]</span> IMAGE <span class="o">[</span>COMMAND<span class="o">]</span> <span class="o">[</span>ARG...<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¸¸ç”¨çš„å‚æ•°ï¼š</p>
<ul>
<li>
<p><code>--name</code>ï¼šä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°</p>
</li>
<li>
<p><code>-d</code>ï¼šåå°è¿è¡Œå®¹å™¨å¹¶è¿”å›å®¹å™¨IDï¼Œä¹Ÿå³å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨</p>
</li>
<li>
<p><code>-i</code>ï¼šä»¥äº¤äº’æ¨¡å¼ï¼ˆinteractiveï¼‰è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸<code>-t</code>åŒæ—¶ä½¿ç”¨</p>
</li>
<li>
<p><code>-t</code>ï¼šä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼ˆttyï¼‰ï¼Œé€šå¸¸ä¸<code>-i</code>åŒæ—¶ä½¿ç”¨ã€‚ä¹Ÿå³å¯åŠ¨äº¤äº’å¼å®¹å™¨ï¼ˆå‰å°æœ‰ä¼ªç»ˆç«¯ï¼Œç­‰å¾…äº¤äº’ï¼‰</p>
</li>
<li>
<p><code>-e</code>ï¼šä¸ºå®¹å™¨æ·»åŠ ç¯å¢ƒå˜é‡</p>
</li>
<li>
<p><code>-P</code>ï¼šéšæœºç«¯å£æ˜ å°„ã€‚å°†å®¹å™¨å†…æš´éœ²çš„æ‰€æœ‰ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºéšæœºç«¯å£</p>
</li>
<li>
<p><code>-p</code>ï¼šæŒ‡å®šç«¯å£æ˜ å°„</p>
</li>
</ul>
<p><code>-p</code>æŒ‡å®šç«¯å£æ˜ å°„çš„å‡ ç§ä¸åŒå½¢å¼ï¼š</p>
<ul>
<li>
<p><code>-p hostPort:containerPort</code>ï¼šç«¯å£æ˜ å°„ï¼Œä¾‹å¦‚<code>-p 8080:80</code></p>
</li>
<li>
<p><code>-p ip:hostPort:containerPort</code>ï¼šé…ç½®ç›‘å¬åœ°å€ï¼Œä¾‹å¦‚ <code>-p 10.0.0.1:8080:80</code></p>
</li>
<li>
<p><code>-p ip::containerPort</code>ï¼šéšæœºåˆ†é…ç«¯å£ï¼Œä¾‹å¦‚ <code>-p 10.0.0.1::80</code></p>
</li>
<li>
<p><code>-p hostPort1:containerPort1 -p hostPort2:containerPort2</code>ï¼šæŒ‡å®šå¤šä¸ªç«¯å£æ˜ å°„ï¼Œä¾‹å¦‚<code>-p 8080:80 -p 8888:3306</code></p>
</li>
</ul>
<h3 id="å¯åŠ¨äº¤äº’å¼å®¹å™¨">å¯åŠ¨äº¤äº’å¼å®¹å™¨
</h3><p>ä»¥äº¤äº’æ–¹å¼å¯åŠ¨ubuntué•œåƒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># -i äº¤äº’æ¨¡å¼</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -t åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯tty</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ubuntu é•œåƒåç§°</span>
</span></span><span class="line"><span class="cl"><span class="c1"># /bin/bashï¼ˆæˆ–è€…bashï¼‰ shelläº¤äº’çš„æ¥å£</span>
</span></span><span class="line"><span class="cl">docker run -it ubuntu /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€€å‡ºäº¤äº’æ¨¡å¼ï¼š</p>
<p>æ–¹å¼1ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># åœ¨äº¤äº’shellä¸­exitå³å¯é€€å›å®¿ä¸»æœº</span>
</span></span><span class="line"><span class="cl">exit<span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ–¹å¼2ï¼šä½¿ç”¨å¿«æ·é”®<code>ctrl</code> + <code>P</code> + <code>Q</code></p>
<p>æ–¹å¼1ï¼šé€€å‡ºåï¼Œå®¹å™¨ä¼šåœæ­¢ï¼›</p>
<p>æ–¹å¼2 é€€å‡ºåå®¹å™¨ä¾ç„¶æ­£åœ¨è¿è¡Œã€‚</p>
<h3 id="å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨">å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨
</h3><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç³»ç»Ÿdockerå®¹å™¨æœåŠ¡æ—¶åœ¨åå°è¿è¡Œçš„ï¼Œå¯ä»¥é€šè¿‡<code>-d</code>æŒ‡å®šå®¹å™¨çš„åå°è¿è¡Œæ¨¡å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d å®¹å™¨å
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„äº‹é¡¹ï¼š</p>
<p>å¦‚æœä½¿ç”¨<code>docker run -d ubuntu</code>å°è¯•å¯åŠ¨å®ˆæŠ¤å¼çš„ubuntuï¼Œä¼šå‘ç°å®¹å™¨å¯åŠ¨åå°±è‡ªåŠ¨é€€å‡ºäº†ã€‚</p>
<p>å› ä¸ºDockerå®¹å™¨å¦‚æœåœ¨åå°è¿è¡Œï¼Œå°±å¿…é¡»è¦æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ã€‚å®¹å™¨è¿è¡Œçš„å‘½ä»¤å¦‚æœä¸æ˜¯é‚£äº›ä¸€ç›´æŒ‚èµ·çš„å‘½ä»¤ï¼ˆä¾‹å¦‚<code>top</code>ã€<code>tail</code>ï¼‰ï¼Œå°±ä¼šè‡ªåŠ¨é€€å‡ºã€‚</p>
<h2 id="åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨">åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨
</h2><p>åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker ps <span class="o">[</span>OPTIONS<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¸¸ç”¨å‚æ•°ï¼š</p>
<ul>
<li>
<p><code>-a</code>ï¼šåˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨+å†å²ä¸Šè¿è¡Œè¿‡çš„å®¹å™¨</p>
</li>
<li>
<p><code>-l</code>ï¼šæ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨</p>
</li>
<li>
<p><code>-n</code>ï¼šæ˜¾ç¤ºæœ€è¿‘nä¸ªåˆ›å»ºçš„å®¹å™¨</p>
</li>
<li>
<p><code>-q</code>ï¼šé™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·</p>
</li>
</ul>
<h2 id="å®¹å™¨å…¶ä»–å¯åœæ“ä½œ">å®¹å™¨å…¶ä»–å¯åœæ“ä½œ
</h2><h3 id="å¯åŠ¨å·²ç»åœæ­¢çš„å®¹å™¨">å¯åŠ¨å·²ç»åœæ­¢çš„å®¹å™¨
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker start å®¹å™¨IDæˆ–å®¹å™¨å
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="é‡å¯å®¹å™¨">é‡å¯å®¹å™¨
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker restart å®¹å™¨IDæˆ–å®¹å™¨å
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åœæ­¢å®¹å™¨">åœæ­¢å®¹å™¨
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker stop å®¹å™¨IDæˆ–å®¹å™¨å
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¼ºåˆ¶åœæ­¢å®¹å™¨">å¼ºåˆ¶åœæ­¢å®¹å™¨
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">kill</span> å®¹å™¨IDæˆ–å®¹å™¨å
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ é™¤å®¹å™¨">åˆ é™¤å®¹å™¨
</h2><p>åˆ é™¤å·²ç»åœæ­¢çš„å®¹å™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker rm å®¹å™¨IDæˆ–å®¹å™¨å
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ é™¤å®¹å™¨æ˜¯ <code>docker rm</code>ï¼Œåˆ é™¤é•œåƒæ˜¯ <code>docker rmi</code>ï¼Œæ³¨æ„åŒºåˆ†ã€‚</p>
<p>å¼ºåˆ¶åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker rm -f å®¹å™¨IDæˆ–å®¹å™¨å
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€æ¬¡åˆ é™¤å¤šä¸ªå®¹å™¨å®ä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker rm -f <span class="si">${</span><span class="nv">docker</span><span class="p"> ps -a -q</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æˆ–è€…</span>
</span></span><span class="line"><span class="cl">docker ps -a -q <span class="p">|</span> xargs docker rm
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æŸ¥çœ‹å®¹å™¨æ—¥å¿—">æŸ¥çœ‹å®¹å™¨æ—¥å¿—
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker logs å®¹å™¨IDæˆ–å®¹å™¨å
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹">æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker top å®¹å™¨IDæˆ–å®¹å™¨å
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚">æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker inspect å®¹å™¨IDæˆ–å®¹å™¨å
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨">è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨
</h2><p>è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¹¶ä»¥å‘½ä»¤è¡Œäº¤äº’ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it å®¹å™¨ID bashShell
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‡æ–°è¿›å…¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker attach å®¹å™¨ID
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>docker exec</code> å’Œ <code>docker attach</code> åŒºåˆ«ï¼š</p>
<ul>
<li>
<p><code>attach</code>ç›´æ¥è¿›å…¥å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹ï¼Œç”¨<code>exit</code>é€€å‡ºä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢</p>
</li>
<li>
<p><code>exec</code>æ˜¯åœ¨å®¹å™¨ä¸­æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå¹¶ä¸”å¯ä»¥å¯åŠ¨æ–°çš„è¿›ç¨‹ï¼Œç”¨<code>exit</code>é€€å‡ºä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢</p>
</li>
</ul>
<p>å¦‚æœæœ‰å¤šä¸ªç»ˆç«¯ï¼Œéƒ½å¯¹åŒä¸€ä¸ªå®¹å™¨æ‰§è¡Œäº† <code>docker attach</code>ï¼Œå°±ä¼šå‡ºç°ç±»ä¼¼æŠ•å±æ˜¾ç¤ºçš„æ•ˆæœã€‚ä¸€ä¸ªç»ˆç«¯ä¸­è¾“å…¥è¾“å‡ºçš„å†…å®¹ï¼Œåœ¨å…¶ä»–ç»ˆç«¯ä¸Šä¹Ÿä¼šåŒæ­¥çš„æ˜¾ç¤ºã€‚</p>
<h2 id="å®¹å™¨å’Œå®¿ä¸»æœºæ–‡ä»¶æ‹·è´">å®¹å™¨å’Œå®¿ä¸»æœºæ–‡ä»¶æ‹·è´
</h2><p>å®¹å™¨å†…æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker cp å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®¿ä¸»æœºæ–‡ä»¶æ‹·è´åˆ°å®¹å™¨ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker cp ä¸»æœºè·¯å¾„ å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨">å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨
</h2><p><code>export</code>ï¼šå¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ªtarå½’æ¡£æ–‡ä»¶ï¼ˆå¯¹åº”<code>import</code>å‘½ä»¤ï¼‰ï¼›</p>
<p><code>import</code>ï¼šä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿå†å¯¼å…¥ä¸ºé•œåƒï¼ˆå¯¹åº”<code>export</code>å‘½ä»¤ï¼‰ï¼›</p>
<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¯¼å‡º</span>
</span></span><span class="line"><span class="cl"><span class="c1"># docker export å®¹å™¨ID &gt; taræ–‡ä»¶å</span>
</span></span><span class="line"><span class="cl">docker <span class="nb">export</span> abc &gt; aaa.tar
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯¼å…¥</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cat taræ–‡ä»¶ | docker import - è‡ªå®šä¹‰é•œåƒç”¨æˆ·/è‡ªå®šä¹‰é•œåƒå:è‡ªå®šä¹‰é•œåƒç‰ˆæœ¬å·</span>
</span></span><span class="line"><span class="cl">cat aaa.tar <span class="p">|</span> docker import - test/mytest:1.0.1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å°†å®¹å™¨ç”Ÿæˆæ–°é•œåƒ">å°†å®¹å™¨ç”Ÿæˆæ–°é•œåƒ
</h2><p><code>docker commit</code>æäº¤å®¹å™¨å‰¯æœ¬ä½¿ä¹‹æˆä¸ºä¸€ä¸ªæ–°çš„é•œåƒã€‚</p>
<p>docker å¯åŠ¨ä¸€ä¸ªé•œåƒå®¹å™¨åï¼Œ å¯ä»¥åœ¨é‡Œé¢æ‰§è¡Œä¸€äº›å‘½ä»¤æ“ä½œï¼Œç„¶åä½¿ç”¨<code>docker commit</code>å°†æ–°çš„è¿™ä¸ªå®¹å™¨å¿«ç…§ç”Ÿæˆä¸€ä¸ªé•œåƒã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker commit -m<span class="o">=</span><span class="s2">&#34;æäº¤çš„æè¿°ä¿¡æ¯&#34;</span> -a<span class="o">=</span><span class="s2">&#34;ä½œè€…&#34;</span> å®¹å™¨ID è¦åˆ›å»ºçš„ç›®æ ‡é•œåƒå:<span class="o">[</span>tag<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>DockeræŒ‚è½½ä¸»æœºç›®å½•ï¼Œå¯èƒ½ä¼šå‡ºç°æŠ¥é”™ï¼š<code>cannot open directory .: Perission denied</code>ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šåœ¨å‘½ä»¤ä¸­åŠ å…¥å‚æ•° <code>--privileged=true</code>ã€‚</p>
<p>CentOS7å®‰å…¨æ¨¡å—æ¯”ä¹‹å‰ç³»ç»Ÿç‰ˆæœ¬åŠ å¼ºï¼Œä¸å®‰å…¨çš„ä¼šå…ˆç¦æ­¢ï¼Œç›®å½•æŒ‚è½½çš„æƒ…å†µè¢«é»˜è®¤ä¸ºä¸å®‰å…¨çš„è¡Œä¸ºï¼Œåœ¨SELinuxé‡Œé¢æŒ‚è½½ç›®å½•è¢«ç¦æ­¢æ‰äº†ã€‚å¦‚æœè¦å¼€å¯ï¼Œä¸€èˆ¬ä½¿ç”¨ <code>--privileged=true</code>ï¼Œæ‰©å¤§å®¹å™¨çš„æƒé™è§£å†³æŒ‚è½½æ²¡æœ‰æƒé™çš„é—®é¢˜ã€‚ä¹Ÿå³ä½¿ç”¨è¯¥å‚æ•°ï¼Œå®¹å™¨å†…çš„rootæ‰æ‹¥æœ‰çœŸæ­£çš„rootæƒé™ï¼Œå¦åˆ™å®¹å™¨å†…çš„rootåªæ˜¯å¤–éƒ¨çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·æƒé™ã€‚</p>
<h2 id="å®¹å™¨æ•°æ®å·">å®¹å™¨æ•°æ®å·
</h2><p>å·å°±æ˜¯ç›®å½•æˆ–æ–‡ä»¶ï¼Œå­˜åœ¨äºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä¸­ï¼Œç”±dockeræŒ‚è½½åˆ°å®¹å™¨ï¼Œä½†ä¸å±äºè”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤èƒ½å¤Ÿç»•è¿‡UnionFSï¼Œæä¾›ä¸€äº›ç”¨äºæŒç»­å­˜å‚¨æˆ–å…±äº«æ•°æ®ã€‚</p>
<p>ç‰¹æ€§ï¼šå·è®¾è®¡çš„ç›®çš„å°±æ˜¯æ•°æ®çš„æŒä¹…åŒ–ï¼Œå®Œå…¨ç‹¬ç«‹äºå®¹å™¨çš„ç”Ÿå­˜å‘¨æœŸï¼Œå› æ­¤Dockerä¸ä¼šåœ¨å®¹å™¨åˆ é™¤æ—¶åˆ é™¤å…¶æŒ‚è½½çš„æ•°æ®å·ã€‚</p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>
<p>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«æˆ–é‡ç”¨æ•°æ®</p>
</li>
<li>
<p>å·ä¸­çš„æ›´æ”¹å¯ä»¥ç›´æ¥å®æ–½ç”Ÿæ•ˆ</p>
</li>
<li>
<p>æ•°æ®å·ä¸­çš„æ›´æ”¹ä¸ä¼šåŒ…å«åœ¨é•œåƒçš„æ›´æ–°ä¸­</p>
</li>
<li>
<p>æ•°æ®å·çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨å®ƒä¸ºæ­¢</p>
</li>
</ul>
<p>è¿è¡Œä¸€ä¸ªå¸¦æœ‰å®¹å™¨å·å­˜å‚¨åŠŸèƒ½çš„å®¹å™¨å®ä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -it --privileged<span class="o">=</span><span class="nb">true</span> -v å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:å®¹å™¨å†…ç›®å½•<span class="o">[</span>rw <span class="p">|</span> ro<span class="o">]</span> é•œåƒå
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥ä½¿ç”¨<code>docker inspect</code>æŸ¥çœ‹å®¹å™¨ç»‘å®šçš„æ•°æ®å·ã€‚</p>
<p>æƒé™ï¼š</p>
<ul>
<li>
<p><code>rw</code>ï¼šè¯»å†™</p>
</li>
<li>
<p><code>ro</code>ï¼šåªè¯»ã€‚å¦‚æœå®¿ä¸»æœºå†™å…¥å†…å®¹ï¼Œå¯ä»¥åŒæ­¥ç»™å®¹å™¨å†…ï¼Œå®¹å™¨å†…å¯ä»¥è¯»å–ã€‚</p>
</li>
</ul>
<p>å®¹å™¨å·çš„ç»§æ‰¿ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ä¸€ä¸ªå®¹å™¨</span>
</span></span><span class="line"><span class="cl">docker run -it --privileged<span class="o">=</span><span class="nb">true</span> /tmp/test:/tmp/docker --name u1 ubuntu /bin/bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨ --volumes-from ç»§æ‰¿ u1çš„å®¹å™¨å·æ˜ å°„é…ç½®</span>
</span></span><span class="line"><span class="cl">docker run -it --privileged<span class="o">=</span><span class="nb">true</span> --volumes-from u1 --name u2 ubuntu
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ‰€æœ‰å‘½ä»¤ç¤ºæ„å›¾">æ‰€æœ‰å‘½ä»¤ç¤ºæ„å›¾
</h2><p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/Docker-Command-Diagram.png"
	width="1024"
	height="768"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/Docker-Command-Diagram_hu7209810290307319200.png 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/Docker-Command-Diagram_hu2838129469340573726.png 1024w"
	loading="lazy"
	
		alt="Docker-Command-Diagram"
	
	
		class="gallery-image" 
		data-flex-grow="133"
		data-flex-basis="320px"
	
></p>
<h1 id="06-dockeré•œåƒ"><strong>06-Dockeré•œåƒ</strong>
</h1><h2 id="é•œåƒ">é•œåƒ
</h2><p>é•œåƒæ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼Œæˆ‘ä»¬æŠŠåº”ç”¨ç¨‹åºå’Œé…ç½®ä¾èµ–æ‰“åŒ…å¥½è¡Œç¨‹ä¸€ä¸ªå¯äº¤ä»˜çš„è¿è¡Œç¯å¢ƒï¼ˆåŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶éœ€è¦çš„åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ç­‰ï¼‰ï¼Œè¿™ä¸ªæ‰“åŒ…å¥½çš„è¿è¡Œç¯å¢ƒå°±æ˜¯imageé•œåƒæ–‡ä»¶ã€‚</p>
<h2 id="docker-é•œåƒåŠ è½½åŸç†">Docker é•œåƒåŠ è½½åŸç†
</h2><h3 id="è”åˆæ–‡ä»¶ç³»ç»Ÿ">è”åˆæ–‡ä»¶ç³»ç»Ÿ
</h3><p>Docker ä¸­çš„æ–‡ä»¶å­˜å‚¨é©±åŠ¨å«åš storage driverã€‚</p>
<p>Docker æœ€æ—©æ”¯æŒçš„stotage driveræ˜¯ AUFSï¼Œå®ƒå®é™…ä¸Šç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œè¿™ç§å±‚çº§çš„æ–‡ä»¶ç³»ç»Ÿå«UnionFSã€‚</p>
<p>è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰ï¼šUnion æ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ï¼ˆunite serveral directories into a single virtual filesystemï¼‰ã€‚</p>
<p>Unionæ–‡ä»¶ç³»ç»Ÿæ˜¯Dockeré•œåƒçš„åŸºç¡€ã€‚é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œé›†æˆï¼ŒåŸºäºåŸºç¡€é•œåƒå¯ä»¥åˆ¶ä½œå…·ä½“çš„åº”ç”¨é•œåƒã€‚</p>
<p>ç‰¹æ€§ï¼šä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½•ã€‚</p>
<p>åæ¥å‡ºç°çš„dockerç‰ˆæœ¬ä¸­ï¼Œé™¤äº†AUFSï¼Œè¿˜æ”¯æŒOverlayFSã€Btrfsã€Device Mapperã€VFSã€ZFSç­‰storage driverã€‚</p>
<h3 id="bootfså’Œrootfs">bootfså’Œrootfs
</h3><p>bootfsï¼ˆboot file systemï¼‰ä¸»è¦åŒ…å« bootloader å’Œ kernelï¼Œbootloaderä¸»è¦æ˜¯å¼•å¯¼åŠ è½½ kernelï¼ŒLinuxåˆšå¯åŠ¨æ—¶ä¼šåŠ è½½bootfsæ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>åœ¨Dockeré•œåƒçš„æœ€åº•å±‚æ˜¯å¼•å¯¼æ–‡ä»¶ç³»ç»Ÿbootfsã€‚è¿™ä¸€å±‚ä¸æˆ‘ä»¬å…¸å‹çš„Linux/Unixç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å«bootåŠ è½½å™¨å’Œå†…æ ¸ã€‚å½“bootåŠ è½½å®Œæˆä¹‹åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç»ç”± bootfs è½¬äº¤ç»™å†…æ ¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¹Ÿä¼šå¸è½½ bootfsã€‚</p>
<p>rootfsï¼ˆroot file systemï¼‰ï¼Œåœ¨bootfsä¹‹ä¸Šï¼ŒåŒ…å«çš„å°±æ˜¯å…¸å‹Linuxç³»ç»Ÿä¸­çš„ <code>/dev</code>ã€<code>/proc</code>ã€<code>/bin</code>ã€<code>/etc</code>ç­‰æ ‡å‡†ç›®å½•å’Œæ–‡ä»¶ã€‚rootfså°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚Ubuntuã€CentOSç­‰ã€‚</p>
<p>dockeré•œåƒåº•å±‚å±‚æ¬¡ï¼š</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer01.jpg"
	width="633"
	height="468"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer01_hu12499913941508150826.jpg 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer01_hu7237665284351715241.jpg 1024w"
	loading="lazy"
	
		alt="layer01"
	
	
		class="gallery-image" 
		data-flex-grow="135"
		data-flex-basis="324px"
	
></p>
<p>å¯¹äºä¸€ä¸ªç²¾ç®€çš„OSï¼Œrootfså¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„å‘½ä»¤ã€å·¥å…·å’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ä½¿ç”¨Hostçš„Kernelï¼Œè‡ªå·±åªéœ€è¦æä¾›rootfså°±å¯ä»¥ã€‚æ‰€ä»¥ï¼Œå¯¹äºä¸åŒçš„Linuxå‘è¡Œç‰ˆï¼ŒbootfsåŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œrootfsä¼šæœ‰å·®åˆ«ï¼Œä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…±ç”¨bootfsã€‚</p>
<p>æœ‰å·®åˆ«çš„rootfsï¼š</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer02.jpg"
	width="637"
	height="437"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer02_hu13619571272626573117.jpg 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer02_hu14456280541078403519.jpg 1024w"
	loading="lazy"
	
		alt="layer02"
	
	
		class="gallery-image" 
		data-flex-grow="145"
		data-flex-basis="349px"
	
></p>
<h3 id="é•œåƒåˆ†å±‚">é•œåƒåˆ†å±‚
</h3><p>Dockeræ”¯æŒæ‰©å±•ç°æœ‰é•œåƒï¼Œåˆ›å»ºæ–°çš„é•œåƒã€‚æ–°é•œåƒæ˜¯ä»baseé•œåƒä¸€å±‚ä¸€å±‚å åŠ ç”Ÿæˆçš„ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># Version: 0.0.1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian  # ç›´æ¥åœ¨debain baseé•œåƒä¸Šæ„å»º</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">MAINTAINER</span><span class="s"> mylinux</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y emacs <span class="c1"># å®‰è£…emacs</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get install -y apache2 <span class="c1"># å®‰è£…apache2</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;/bin/bash&#34;</span><span class="p">]</span> <span class="c1"># å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œbash</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é•œåƒåˆ›å»ºè¿‡ç¨‹ï¼š</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer03.png"
	width="2144"
	height="696"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer03_hu11200481854660346429.png 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer03_hu11656135983662875512.png 1024w"
	loading="lazy"
	
		alt="layer03"
	
	
		class="gallery-image" 
		data-flex-grow="308"
		data-flex-basis="739px"
	
></p>
<h2 id="é•œåƒåˆ†å±‚çš„ä¼˜åŠ¿">é•œåƒåˆ†å±‚çš„ä¼˜åŠ¿
</h2><p>é•œåƒåˆ†å±‚çš„ä¸€ä¸ªæœ€å¤§å¥½å¤„å°±æ˜¯å…±äº«èµ„æºï¼Œæ–¹ä¾¿å¤åˆ¶è¿ç§»ï¼Œæ–¹ä¾¿å¤ç”¨ã€‚</p>
<h2 id="å®¹å™¨å±‚">å®¹å™¨å±‚
</h2><p>å½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„<strong>å¯å†™å±‚</strong>å°†è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ï¼Œè¿™ä¸€å±‚é€šå¸¸è¢«ç§°ä¸º<code>å®¹å™¨å±‚</code>ï¼Œå®¹å™¨å±‚ä¹‹ä¸‹çš„éƒ½å«<code>é•œåƒå±‚</code>ã€‚</p>
<p>æ‰€æœ‰å¯¹å®¹å™¨çš„æ”¹åŠ¨ï¼Œæ— è®ºæ·»åŠ ã€åˆ é™¤ã€è¿˜æ˜¯ä¿®æ”¹æ–‡ä»¶éƒ½åªä¼šå‘ç”Ÿåœ¨å®¹å™¨å±‚ä¸­ã€‚</p>
<p>åªæœ‰å®¹å™¨å±‚æ˜¯å¯å†™çš„ï¼Œå®¹å™¨å±‚ä¸‹é¢çš„æ‰€æœ‰é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ã€‚</p>
<p>å¦‚å›¾ï¼š</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer04.jpg"
	width="800"
	height="600"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer04_hu15356079341779747914.jpg 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/layer04_hu12433220794110476370.jpg 1024w"
	loading="lazy"
	
		alt="layer04"
	
	
		class="gallery-image" 
		data-flex-grow="133"
		data-flex-basis="320px"
	
></p>
<h1 id="07-nexusæ­å»ºdockerç§ä»“"><strong>07-nexusæ­å»ºdockerç§ä»“</strong>
</h1><h2 id="ä½¿ç”¨nexusåˆ›å»ºdockerç§æœ‰ä»“åº“">ä½¿ç”¨nexusåˆ›å»ºdockerç§æœ‰ä»“åº“
</h2><p>Nexusçš„å®‰è£…è¯·å‚è€ƒè¯¥æ–‡æ¡£ï¼šhttps://www.yuque.com/tmfl/pom/uumrx2</p>
<p>Nexusé…ç½®Dockerä»“åº“æ­¥éª¤ï¼›</p>
<ol>
<li>
<p>nexusé»˜è®¤dockeræ˜¯å¤±æ•ˆçš„ï¼Œéœ€è¦ åœ¨<code>security</code> &ndash;&gt; <code>Realms</code>ï¼Œå°†dockeré…ç½®æˆ<code>Active</code></p>
</li>
<li>
<p>åœ¨ <code>Repository</code> çš„ <code>Blob Store</code> ä¸­åˆ›å»ºä¸€ä¸ªç”¨äºå­˜æ”¾dockeré•œåƒçš„å­˜å‚¨ã€‚å†…ç½‘æ²¡æœ‰<code>S3</code>çš„è¯ï¼ŒæŠŠ<code>Type</code>é…ç½®ä¸º<code>file</code>å°±è¡Œã€‚</p>
</li>
</ol>
<blockquote>
<p>S3ï¼šSimple Storage Serviceï¼Œç®€å•å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œå³äº‘å­˜å‚¨ã€‚</p>
</blockquote>
<ol start="3">
<li>åœ¨ <code>Repository</code> çš„ <code>Repositories</code> ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºåº“ï¼Œç±»å‹ä¸º <code>docker-hosted</code>ã€‚</li>
</ol>
<p>åˆ›å»ºçš„ <code>docker-hosted</code>èµ„æºåº“çš„ç›¸å…³é…ç½®ï¼š</p>
<ol>
<li>
<p><code>Name</code>ï¼šæŒ‡å®šè¯¥èµ„æºåº“çš„åç§°ï¼Œä¾‹å¦‚å°±å« <code>docker-hosted</code></p>
</li>
<li>
<p><code>Online</code>ï¼šé»˜è®¤å‹¾é€‰å³å¯</p>
</li>
<li>
<p><code>HTTP</code>ï¼šä¸ä¸‹é¢çš„HTTPSï¼Œè‡³å°‘éœ€è¦å‹¾é€‰å…¶ä¸­ä¸€ä¸ªé€‰æ‹©æ¡†ï¼Œå¹¶é…ç½®ä¸€ä¸ªå’Œnexusä¸åŒçš„ç«¯å£å·ï¼Œä¾‹å¦‚ <code>8881</code>ã€‚å°†æ¥dockerå®¢æˆ·ç«¯å‘é•œåƒä¸­å¿ƒä¸Šä¼ é•œåƒæ—¶ï¼Œéœ€è¦å‘è¯¥ç«¯å£å·è¿›è¡Œä¸Šä¼ ã€‚</p>
</li>
<li>
<p><code>HTTPS</code>ï¼šå¦‚æœæœåŠ¡å™¨å¯ä»¥å¼€å¯httpsæœåŠ¡ï¼Œåˆ™ä¹Ÿå¯ä»¥å‹¾é€‰<code>HTTPS</code>ï¼Œç„¶åé…ç½®ä¸€ä¸ªç«¯å£å·ï¼Œæ¥æ”¶dockerå®¢æˆ·ç«¯ä¸Šä¼ ä¸Šæ¥çš„é•œåƒã€‚</p>
</li>
<li>
<p><code>Allow anonymous docker pull</code>ï¼šå…è®¸åŒ¿åä¸Šä¼ ï¼Œé»˜è®¤ä¸å‹¾é€‰</p>
</li>
<li>
<p><code>Enable docker V1 API</code>ï¼šæ˜¯å¦å¯ç”¨ dockeræ—©æœŸ<code>V1</code>ç‰ˆæœ¬çš„APIï¼Œé»˜è®¤ä¸å‹¾é€‰ï¼Œå³åªå¯ç”¨<code>V2 API</code>ï¼š<code>http://xxx.xxx.xxx.xxx:8881/v2/</code></p>
</li>
<li>
<p><code>Blob Store</code>ï¼šé€‰æ‹©ä¸Šé¢åˆ›å»ºçš„dockeré•œåƒçš„å­˜å‚¨`</p>
</li>
<li>
<p><code>Deployment Policy</code>ï¼šæ˜¯å¦å…è®¸é‡å¤ä¸Šä¼ åŒä¸€ä¸ªèµ„æºï¼Œé»˜è®¤å…è®¸</p>
</li>
</ol>
<p>é…ç½®å¥½ä¹‹åï¼Œä¿®æ”¹é˜²ç«å¢™è®¾ç½®ï¼Œå¼€å¯åˆšåˆšé…ç½®çš„<code>8881</code> ç«¯å£ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vim /etc/sysconfig/iptables
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ·»åŠ ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">-A INPUT -p tcp -m tcp --dport 8881 -j ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‡å¯iptablesï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">service iptables restart
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="dockerå®¢æˆ·ç«¯çš„é•œåƒå¯¼å‡ºå’Œå¯¼å…¥">dockerå®¢æˆ·ç«¯çš„é•œåƒå¯¼å‡ºå’Œå¯¼å…¥
</h2><p>é•œåƒä¸‹è½½å’Œå¯¼å‡ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># ä¸‹è½½é•œåƒ</span>
</span></span><span class="line"><span class="cl">docker pull mysql:8.0.28
</span></span><span class="line"><span class="cl"><span class="c1"># å°†é•œåƒå¯¼å‡ºæˆæœ¬åœ°taræ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">docker save -o mysql-8.0.28.tar mysql:8.0.28
</span></span></code></pre></td></tr></table>
</div>
</div><p>é•œåƒçš„å¯¼å…¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å°†æœ¬åœ°æ–‡ä»¶å¯¼å…¥åˆ°dockeré•œåƒä¸­ï¼ˆdockerä¼šè‡ªåŠ¨è§£æå‡ºæ–‡ä»¶ä¸­çš„tagï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®šï¼‰</span>
</span></span><span class="line"><span class="cl">docker load &lt; mysql-8.0.28.tar
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="docker-å®¢æˆ·ç«¯å‘ç§ä»“ä¸Šä¼ é•œåƒ">docker å®¢æˆ·ç«¯å‘ç§ä»“ä¸Šä¼ é•œåƒ
</h2><h3 id="é…ç½®dockerå…è®¸æ¥æ”¶httpè¯·æ±‚">é…ç½®dockerå…è®¸æ¥æ”¶<code>http</code>è¯·æ±‚
</h3><p>dockeré»˜è®¤åªæ¥æ”¶<code>https</code>è¯·æ±‚ï¼Œè€Œæˆ‘ä»¬çš„<code>nexus</code>ç§ä»“å¦‚æœé…ç½®çš„æ˜¯<code>HTTP</code>æ¥å£çš„è¯ï¼Œdockerç›´æ¥è¿ä¼šæŠ¥é”™ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">server gave HTTP response to HTTPS client
</span></span></code></pre></td></tr></table>
</div>
</div><p>éœ€è¦é…ç½®dockerå…è®¸è¿æ¥æˆ‘ä»¬ç§ä»“çš„<code>http</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vim /usr/lib/systemd/system/docker.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å…¶ä¸­çš„<code>ExecStart</code> é€‰é¡¹åé¢ï¼Œæ·»åŠ  <code>--insecure-registry {docker ç§æœ‰é•œåƒåº“ IP} --ipv6=false</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">[Service]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#  å‰é¢çš„-Hå‚æ•°å¯èƒ½ä¸åŒï¼Œä¸éœ€è¦ç®¡ï¼Œåªéœ€åœ¨æœ€åé¢åŠ ä¸Šæˆ‘ä»¬çš„ç§ä»“åœ°å€å³å¯ï¼š--insecure-registry 192.168.x.xxx:8881 --ipv6=false
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock --insecure-registry 192.168.x.xxx:8881 --ipv6=false
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åé‡å¯dockerï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># centos6 çš„å‘½ä»¤</span>
</span></span><span class="line"><span class="cl">sudo chkconfig daemon-reload
</span></span><span class="line"><span class="cl">sudo service docker restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># centos7 çš„å‘½ä»¤</span>
</span></span><span class="line"><span class="cl">sudo systemctl daemon-reload
</span></span><span class="line"><span class="cl">sudo systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹Ÿå¯ä»¥åœ¨<code>/etc/docker/daemon.json</code> ä¸­è¿›è¡Œé…ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;insecure-reigstries&#34;</span><span class="p">:[</span><span class="s2">&#34;192.168.xxx.xxx:8881&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å‘ç§ä»“æ¨é€é•œåƒ">å‘ç§ä»“æ¨é€é•œåƒ
</h3><ol>
<li>å¦‚æœç§ä»“ä¸å…è®¸åŒ¿åä¸Šä¼ é•œåƒï¼Œåˆ™éœ€è¦å…ˆè¿›è¡Œç™»é™†ã€‚ï¼ˆä¸€èˆ¬ç§ä»“éƒ½ä¸å…è®¸åŒ¿åä¸Šä¼ ï¼Œ<code>nexus</code>é»˜è®¤åŒ¿åä¸Šä¼ ä¹Ÿæ²¡æœ‰å‹¾é€‰ï¼‰</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">  <span class="c1"># --usernameåé¢ä¸ºnexusç”¨æˆ·åï¼Œæ‰§è¡Œå‘½ä»¤åä¼šæç¤ºè¾“å…¥å¯†ç </span>
</span></span><span class="line"><span class="cl">  docker login --username<span class="o">=</span>admin http://192.168.xxx.xxx:8881
</span></span><span class="line"><span class="cl">  <span class="c1"># ç™»å½•ä¹‹åï¼Œä¼šåœ¨ $HOME/.docker/config.json ä¸­è®°å½•ä¸‹ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä¹‹åä¾¿ä¸éœ€è¦å†è¿›è¡Œç™»é™†æ“ä½œ</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># å¦‚æœè¦å–æ¶ˆç™»å½•ï¼Œåˆ™åªéœ€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># docker logout http://192.168.xxx.xxx:8881</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>å°†è¦ä¸Šä¼ çš„é•œåƒé‡æ–°è®¾ç½®<code>Tag</code>ã€‚
dockeræŒ‰ç…§é•œåƒåç§°åŒºåˆ†ä¸Šä¼ çš„èµ„æºåº“ã€‚
ä¾‹å¦‚ï¼š
<code>mysql:8.0.28</code>ä¼šè¢«ä¸Šä¼ åˆ°dockerå®˜æ–¹<code>dockerhub</code>ï¼›
<code>tengyer/helloworld:lasted</code>ä¼šè¢«ä¸Šä¼ åˆ°dockerhubçš„<code>tengyer</code>å‘½åç©ºé—´ä¸­ï¼›
<code>registry.cn-hangzhou.aliyuncs.com/å‘½åç©ºé—´/é•œåƒåç§°:[é•œåƒç‰ˆæœ¬å·]</code> ä¼šä¸Šä¼ åˆ°é˜¿é‡Œäº‘æŒ‡å®šå‘½åç©ºé—´ä¸­ï¼›
<code>ccr.ccs.tencentyun.com/å‘½åç©ºé—´/hello-world</code>ï¼šä¼šä¸Šä¼ åˆ°è…¾è®¯äº‘æŒ‡å®šå‘½åç©ºé—´ä¸­ï¼›
<code>hub.c.163.com/å‘½åç©ºé—´/hello-world</code>ï¼šä¼šä¸Šä¼ åˆ°ç½‘æ˜“æ•°å¸†æŒ‡å®šå‘½åç©ºé—´ä¸­ï¼›
æ‰€ä»¥ï¼Œæˆ‘ä»¬å¦‚æœè¦ä¸Šä¼ åˆ°æˆ‘ä»¬çš„ç§ä»“ï¼Œéœ€è¦å°†<code>Tag</code>ä¿®æ”¹ä¸º<code>xxx.xxx.xxx.xxx:8881/å‘½åç©ºé—´/mysql:5.0.27</code>æ ¼å¼ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å°†mysql:8.0.28å¤åˆ¶å‡ºä¸€ä¸ªç§ä»“æ ¼å¼çš„Tag</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¯¥æ“ä½œåœ¨ docker imagesä¸­ä¼šå¤šå‡ºä¸€ä¸ªå¤åˆ¶å‡ºæ¥çš„tagï¼Œä½†æ˜¯ImageIdå’ŒåŸå§‹çš„ç›¸åŒ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ ä¸ªofficialå‘½åç©ºé—´ï¼Œæ–¹ä¾¿åŒºåˆ†è¿™ä¸ªé•œåƒæ˜¯ä»å®˜æ–¹é•œåƒä¸‹è½½ä¸‹æ¥çš„ï¼Œä¸åŠ å‘½åç©ºé—´ä¹Ÿå¯ä»¥ä¸Šä¼ </span>
</span></span><span class="line"><span class="cl">docker tag <span class="o">[</span>ImageId<span class="o">]</span> xxx.xxx.xxx.xxx:8881/official/mysql:8.0.28
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>å°†ä¿®æ”¹å¥½<code>Tag</code>çš„é•œåƒè¿›è¡Œä¸Šä¼ ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker push xxx.xxx.xxx.xxx:8881/official/mysql:8.0.28
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="08-registryæ­å»ºdockerç§ä»“"><strong>08-Registryæ­å»ºdockerç§ä»“</strong>
</h1><h2 id="docker-registry">Docker Registry
</h2><p>Docker Registryæ˜¯å®˜æ–¹æä¾›çš„å·¥å…·ï¼Œç”¨äºæ„å»ºç§æœ‰é•œåƒä»“åº“ã€‚</p>
<h2 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º
</h2><p>Docker Registryä¹Ÿæ˜¯Docker Hubæä¾›çš„ä¸€ä¸ªé•œåƒï¼Œå¯ä»¥ç›´æ¥æ‹‰å–è¿è¡Œã€‚</p>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>æ‹‰å–é•œåƒ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull registry
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>å¯åŠ¨Docker Registry</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d -p 5000:5000 -v /app/myregistry/:/tmp/registry --privileged<span class="o">=</span><span class="nb">true</span> registry
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>éªŒè¯ï¼ˆæŸ¥çœ‹ç§æœä¸­çš„æ‰€æœ‰é•œåƒï¼‰</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl http://192.168.xxx.xxx:5000/v2/_catalog
</span></span><span class="line"><span class="cl">Registryä¼šè¿”å›jsonæ ¼å¼çš„æ‰€æœ‰é•œåƒç›®å½•  
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å‘registryç§ä»“ä¸­ä¸Šä¼ é•œåƒ">å‘Registryç§ä»“ä¸­ä¸Šä¼ é•œåƒ
</h2><h3 id="é…ç½®dockerå…è®¸æ¥æ”¶httpè¯·æ±‚-1">é…ç½®dockerå…è®¸æ¥æ”¶<code>http</code>è¯·æ±‚
</h3><p>ï¼ˆé…ç½®æ–¹å¼å’Œä¸Šä¼ åˆ°nexusç§ä»“ç›¸åŒï¼‰ã€‚</p>
<p>ä¿®æ”¹<code>/etc/docker/daemon.json</code>ï¼Œæ·»åŠ <code>insecure-registries</code>å…è®¸httpï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;registry-mirros&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;https://xxxx.mirror.aliyuncs.com&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;insecure-registries&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;192.168.xxx.xxx:5000&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åé‡å¯dockerï¼šï¼ˆæ–°ç‰ˆæœ¬çš„dockerä¼šç«‹å³ç”Ÿæ•ˆï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># centos6 çš„å‘½ä»¤</span>
</span></span><span class="line"><span class="cl">sudo chkconfig daemon-reload
</span></span><span class="line"><span class="cl">sudo service docker restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># centos7 çš„å‘½ä»¤</span>
</span></span><span class="line"><span class="cl">sudo systemctl daemon-reload
</span></span><span class="line"><span class="cl">sudo systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ¨é€åˆ°ç§ä»“">æ¨é€åˆ°ç§ä»“
</h3><p>æ­¥éª¤ï¼š</p>
<ol>
<li>æ·»åŠ ä¸€ä¸ªå¯¹åº”ç§ä»“åœ°å€çš„tag</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker tag lee/myubuntu:1.0.1 192.168.xxx.xxx:5000/lee/myubuntu:1.0.1
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>pushåˆ°ç§ä»“</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker push 192.168.xxx.xxx:5000/lee/myubuntu:1.0.1
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>æŸ¥çœ‹ç§ä»“ä¸­é•œåƒç›®å½•éªŒè¯</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl http://192.168.xxx.xxx:5000/v2/_catalog
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‹‰å–éªŒè¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull 192.169.xxx.xxx:5000/lee/myubuntu:1.0.1
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="09-dockerå®‰è£…mysql"><strong>09-Dockerå®‰è£…Mysql</strong>
</h1><h2 id="docker-å®‰è£…-mysql">Docker å®‰è£… Mysql
</h2><p>ä»¥å®‰è£… Mysql 5.7ä¸ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull mysql:5.7
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="mysql-å•æœº">Mysql å•æœº
</h2><h3 id="ç®€å•ç‰ˆ-mysql-57-å®‰è£…">ç®€å•ç‰ˆ Mysql 5.7 å®‰è£…
</h3><p>ç®€å•çš„å¯åŠ¨Mysqlå®¹å™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># éœ€è¦ä½¿ç”¨ -e é…ç½®ç¯å¢ƒå˜é‡ MYSQL_ROOT_PASSWORDï¼ˆmysql rootç”¨æˆ·çš„å¯†ç ï¼‰</span>
</span></span><span class="line"><span class="cl">docker run -p 3306:3306 -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>root -d mysql:5.7
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç®€å•ç‰ˆçš„Mysqlä¼šå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>
<p>ä¸­æ–‡ä¹±ç </p>
</li>
<li>
<p>æ²¡æœ‰å®¹å™¨å·æ˜ å°„</p>
</li>
</ul>
<p>å¯åŠ¨dockerå®¹å™¨åï¼Œå¯ä»¥æ­£å¸¸çš„è¿æ¥ã€åˆ›å»ºæ•°æ®åº“ï¼Œåˆ›å»ºè¡¨ï¼Œæ’å…¥æ•°æ®ã€‚ä½†æ˜¯æ’å…¥ä¸­æ–‡åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- åˆ›å»ºdb01æ•°æ®åº“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">db01</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- åˆ‡æ¢åˆ°db01;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">use</span><span class="w"> </span><span class="n">db01</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- åˆ›å»ºè¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t1</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- æ’å…¥è‹±æ–‡å¯ä»¥æ­£å¸¸æ’å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;abc&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- æ’å…¥ä¸­æ–‡æŠ¥é”™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¼ ä¸‰&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ˜¯å› ä¸ºdockeré»˜è®¤çš„å­—ç¬¦é›†çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨mysqlä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ•°æ®åº“å­—ç¬¦é›†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">show</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;character%&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿”å›çš„å­—ç¬¦é›†ä¸­ï¼Œ<code>character_set_database</code>ã€<code>character_set_server</code>ç­‰éƒ½ä¸º<code>latin1</code>å­—ç¬¦é›†ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ã€‚</p>
<p>è€Œä¸”å› ä¸ºå¯åŠ¨å®¹å™¨æ—¶æ²¡æœ‰é…ç½®å®¹å™¨å·æ˜ å°„ï¼Œå½“å®¹å™¨æ„å¤–è¢«åˆ æ—¶ï¼Œæ•°æ®æ— æ³•æ‰¾å›ã€‚</p>
<h3 id="å®é™…åº”ç”¨ç‰ˆ-mysql-57å®‰è£…">å®é™…åº”ç”¨ç‰ˆ Mysql 5.7å®‰è£…
</h3><p>å¯åŠ¨ Mysql å®¹å™¨ï¼Œå¹¶é…ç½®å®¹å™¨å·æ˜ å°„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d -p 33506:3306 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           --privileged<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/mysql/log:/var/log/mysql <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/mysql/data:/var/lib/mysql <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/mysql/conf:/etc/mysql/conf.d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>lj@0322.. <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           --name mysql <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           mysql:5.7
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>/app/mysql/conf</code>ä¸‹æ–°å»º <code>my.cnf</code>ï¼Œé€šè¿‡å®¹å™¨å·åŒæ­¥ç»™mysqlå®ä¾‹ï¼Œè§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">[client]
</span></span><span class="line"><span class="cl">default_character_set=utf8
</span></span><span class="line"><span class="cl">[mysqld]
</span></span><span class="line"><span class="cl">collation_server = utf8_general_ci
</span></span><span class="line"><span class="cl">character_set_server = utf8
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‡å¯mysqlå®¹å™¨ï¼Œä½¿å¾—å®¹å™¨é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker restart mysql
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶ä¾¿è§£å†³äº†ä¸­æ–‡ä¹±ç ï¼ˆä¸­æ–‡æ’å…¥æŠ¥é”™ï¼‰é—®é¢˜ã€‚</p>
<p>è€Œä¸”å› ä¸ºå¯åŠ¨æ—¶å°†å®¹å™¨åšäº†å®¹å™¨å·æ˜ å°„ï¼Œå°†mysqlçš„é…ç½®ï¼ˆæ˜ å°„åˆ°<code>/app/mysql/conf</code>ï¼‰ã€æ•°æ®ï¼ˆæ˜ å°„åˆ°<code>/app/mysql/data</code>ï¼‰ã€æ—¥å¿—ï¼ˆæ˜ å°„åˆ°<code>/app/mysql/log</code>ï¼‰éƒ½æ˜ å°„åˆ°äº†å®¿ä¸»æœºå®é™…ç›®å½•ï¼Œæ‰€ä»¥å³ä½¿åˆ é™¤äº†å®¹å™¨ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿå¤ªå¤§å½±å“ã€‚åªéœ€è¦å†æ‰§è¡Œä¸€ä¸‹å¯åŠ¨Mysqlå®¹å™¨å‘½ä»¤ï¼Œå®¹å™¨å·è¿˜æŒ‰ç›¸åŒä½ç½®è¿›è¡Œæ˜ å°„ï¼Œæ‰€æœ‰çš„æ•°æ®ä¾¿éƒ½å¯ä»¥æ­£å¸¸æ¢å¤ã€‚</p>
<h2 id="mysql-ä¸»ä»å¤åˆ¶å®‰è£…">Mysql ä¸»ä»å¤åˆ¶å®‰è£…
</h2><p>å®‰è£…ä¸»æœåŠ¡å™¨å®¹å™¨å®ä¾‹ï¼ˆç«¯å£å·3307ï¼‰ï¼š</p>
<ol>
<li>å¯åŠ¨å®¹å™¨å®ä¾‹</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -p 3307:3306 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           --name mysql-master <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           --privileged<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/mysql-master/log:/var/log/mysql <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/mysql-master/data:/var/lib/mysql <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/mysql-master/conf:/etc/mysql <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -d mysql:5.7
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>è¿›å…¥<code>/app/mysql-master/conf</code>ï¼Œæ–°å»º<code>my.cnf</code>é…ç½®æ–‡ä»¶ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">[mysqld]
</span></span><span class="line"><span class="cl">## è®¾ç½®server_id, åŒä¸€ä¸ªå±€åŸŸç½‘ä¸­éœ€è¦å”¯ä¸€
</span></span><span class="line"><span class="cl">server_id=101
</span></span><span class="line"><span class="cl">## æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“åç§°
</span></span><span class="line"><span class="cl">binlog-ignore-db=mysql
</span></span><span class="line"><span class="cl">## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½
</span></span><span class="line"><span class="cl">log-bin=mall-mysql-bin
</span></span><span class="line"><span class="cl">## è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—ä½¿ç”¨å†…å­˜å¤§å°ï¼ˆäº‹åŠ¡ï¼‰
</span></span><span class="line"><span class="cl">binlog_cache_size=1M
</span></span><span class="line"><span class="cl">## è®¾ç½®ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ï¼ˆmixed,statement,rowï¼‰
</span></span><span class="line"><span class="cl">binlog_format=mixed
</span></span><span class="line"><span class="cl">## äºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸæ¸…ç†æ—¶é—´ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†
</span></span><span class="line"><span class="cl">expire_logs_days=7
</span></span><span class="line"><span class="cl">## è·³è¿‡ä¸»ä»å¤åˆ¶ä¸­é‡åˆ°çš„æ‰€æœ‰é”™è¯¯æˆ–æŒ‡å®šç±»å‹çš„é”™è¯¯ï¼Œé¿å…slaveç«¯å¤åˆ¶ä¸­æ–­
</span></span><span class="line"><span class="cl">## å¦‚ï¼š1062é”™è¯¯æ˜¯æŒ‡ä¸€äº›ä¸»é”®é‡å¤ï¼Œ1032é”™è¯¯æ˜¯å› ä¸ºä¸»ä»æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´
</span></span><span class="line"><span class="cl">slave_skip_errors=1062
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>é‡å¯å®¹å™¨å®ä¾‹</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker restart mysql-master
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>è¿›å…¥å®¹å™¨å®ä¾‹å†…</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it mysql-master /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>ç™»å½•mysqlï¼Œåˆ›å»ºæ•°æ®åŒæ­¥ç”¨æˆ·</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- é¦–å…ˆä½¿ç”¨ mysql -uroot -p ç™»å½•mysql
</span></span></span><span class="line"><span class="cl"><span class="c1">-- åˆ›å»ºæ•°æ®åŒæ­¥ç”¨æˆ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">create</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="s1">&#39;slave&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">identified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- æˆæƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">grant</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">slave</span><span class="p">,</span><span class="w"> </span><span class="n">replication</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="s1">&#39;slave&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">flush</span><span class="w"> </span><span class="k">privileges</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å®‰è£…ä»æœåŠ¡å™¨å®¹å™¨å®ä¾‹ï¼ˆç«¯å£å·3308ï¼‰ï¼š</p>
<ol>
<li>å¯åŠ¨å®¹å™¨æœåŠ¡ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -p 3308:3306 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           --name mysql-slave <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           --privileged<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/mysql-slave/log:/var/log/mysql <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/mysql-slave/data:/var/lib/mysql <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/mysql-slave/conf:/etc/mysql <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>root <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -d mysql:5.7
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>è¿›å…¥<code>/app/mysql-slave/conf</code>ç›®å½•ï¼Œåˆ›å»º<code>my.cnf</code>é…ç½®æ–‡ä»¶ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">[mysqld]
</span></span><span class="line"><span class="cl">## è®¾ç½®server_id, åŒä¸€ä¸ªå±€åŸŸç½‘å†…éœ€è¦å”¯ä¸€
</span></span><span class="line"><span class="cl">server_id=102
</span></span><span class="line"><span class="cl">## æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“åç§°
</span></span><span class="line"><span class="cl">binlog-ignore-db=mysql
</span></span><span class="line"><span class="cl">## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ï¼Œä»¥å¤‡slaveä½œä¸ºå…¶å®ƒæ•°æ®åº“å®ä¾‹çš„Masteræ—¶ä½¿ç”¨
</span></span><span class="line"><span class="cl">log-bin=mall-mysql-slave1-bin
</span></span><span class="line"><span class="cl">## è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—ä½¿ç”¨å†…å­˜å¤§å°ï¼ˆäº‹åŠ¡ï¼‰
</span></span><span class="line"><span class="cl">binlog_cache_size=1M
</span></span><span class="line"><span class="cl">## è®¾ç½®ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ï¼ˆmixed,statement,rowï¼‰
</span></span><span class="line"><span class="cl">binlog_format=mixed
</span></span><span class="line"><span class="cl">## äºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸæ¸…ç†æ—¶é—´ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†
</span></span><span class="line"><span class="cl">expire_logs_days=7
</span></span><span class="line"><span class="cl">## è·³è¿‡ä¸»ä»å¤åˆ¶ä¸­é‡åˆ°çš„æ‰€æœ‰é”™è¯¯æˆ–æŒ‡å®šç±»å‹çš„é”™è¯¯ï¼Œé¿å…slaveç«¯å¤åˆ¶ä¸­æ–­
</span></span><span class="line"><span class="cl">## å¦‚ï¼š1062é”™è¯¯æ˜¯æŒ‡ä¸€äº›ä¸»é”®é‡å¤ï¼Œ1032æ˜¯å› ä¸ºä¸»ä»æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´
</span></span><span class="line"><span class="cl">slave_skip_errors=1062
</span></span><span class="line"><span class="cl">## relay_logé…ç½®ä¸­ç»§æ—¥å¿—
</span></span><span class="line"><span class="cl">relay_log=mall-mysql-relay-bin
</span></span><span class="line"><span class="cl">## log_slave_updatesè¡¨ç¤ºslaveå°†å¤åˆ¶äº‹ä»¶å†™è¿›è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—
</span></span><span class="line"><span class="cl">log_slave_updates=1
</span></span><span class="line"><span class="cl">## slaveè®¾ç½®åªè¯»ï¼ˆå…·æœ‰superæƒé™çš„ç”¨æˆ·é™¤å¤–ï¼‰
</span></span><span class="line"><span class="cl">read_only=1
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>ä¿®æ”¹å®Œé…ç½®éœ€è¦é‡å¯slaveå®¹å™¨å®ä¾‹</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker restart mysql-slave
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ä¸»æ•°æ®åº“ä¸­æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€ï¼š</p>
<ol>
<li>è¿›å…¥ä¸»æ•°æ®åº“å®¹å™¨ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it mysql-master /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>è¿›å…¥Mysql</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mysql -uroot -p
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">show</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ä¸»è¦æŸ¥çœ‹è¿”å›ç»“æœçš„æ–‡ä»¶å</span><span class="o">`</span><span class="n">File</span><span class="o">`</span><span class="err">ã€å½“å‰ä½ç½®</span><span class="o">`</span><span class="k">Position</span><span class="o">`</span><span class="w"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥ä»æ•°æ®åº“å®¹å™¨ï¼Œé…ç½®ä¸»ä»å¤åˆ¶ï¼š</p>
<ol>
<li>è¿›å…¥ä»æ•°æ®åº“å®¹å™¨ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it mysql-slave /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>è¿›å…¥æ•°æ®åº“</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mysql -uroot -p
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>é…ç½®ä»æ•°æ®åº“æ‰€å±çš„ä¸»æ•°æ®åº“ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- æ ¼å¼ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1">-- change master to master_host=&#39;å®¿ä¸»æœºip&#39;,master_user=&#39;ä¸»æ•°æ®åº“é…ç½®çš„ä¸»ä»å¤åˆ¶ç”¨æˆ·å&#39;,master_password=&#39;ä¸»æ•°æ®åº“é…ç½®çš„ä¸»ä»å¤åˆ¶ç”¨æˆ·å¯†ç &#39;,master_port=å®¿ä¸»æœºä¸»æ•°æ®åº“ç«¯å£,master_log_file=&#39;ä¸»æ•°æ®åº“ä¸»ä»åŒæ­¥çŠ¶æ€çš„æ–‡ä»¶åFile&#39;,master_log_pos=ä¸»æ•°æ®åº“ä¸»ä»åŒæ­¥çŠ¶æ€çš„Position,master_connect_retry=è¿æ¥å¤±è´¥é‡è¯•æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">change</span><span class="w"> </span><span class="n">master</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">master_host</span><span class="o">=</span><span class="s1">&#39;192.168.xxx.xxx&#39;</span><span class="p">,</span><span class="n">master_user</span><span class="o">=</span><span class="s1">&#39;slave&#39;</span><span class="p">,</span><span class="n">master_password</span><span class="o">=</span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="n">master_port</span><span class="o">=</span><span class="mi">3307</span><span class="p">,</span><span class="n">master_log_file</span><span class="o">=</span><span class="s1">&#39;mall-mysql-bin.000001&#39;</span><span class="p">,</span><span class="n">master_log_pos</span><span class="o">=</span><span class="mi">769</span><span class="p">,</span><span class="n">master_connect_retry</span><span class="o">=</span><span class="mi">30</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">#</span><span class="w"> </span><span class="err">\</span><span class="k">G</span><span class="w"> </span><span class="err">å¯ä»¥å°†æ¨ªå‘çš„ç»“æœé›†è¡¨æ ¼è½¬æ¢æˆçºµå‘å±•ç¤ºã€‚</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="w"> </span><span class="n">slave</span><span class="w"> </span><span class="n">statusçš„å­—æ®µæ¯”è¾ƒå¤š</span><span class="err">ï¼Œçºµå‘å±•ç¤ºæ¯”å‹å¥½</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">show</span><span class="w"> </span><span class="n">slave</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="err">\</span><span class="k">G</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†å±•ç¤ºåˆšåˆšé…ç½®çš„ä¸»æ•°æ®åº“ä¿¡æ¯å¤–ï¼Œä¸»è¦å…³æ³¨ <code>Slave_IO_Running</code>ã€<code>Slave_SQL_Running</code>ã€‚ç›®å‰ä¸¤ä¸ªå€¼åº”è¯¥éƒ½ä¸º <code>No</code>ï¼Œè¡¨ç¤ºè¿˜æ²¡æœ‰å¼€å§‹ã€‚</p>
<ol start="5">
<li>å¼€å¯ä¸»ä»åŒæ­¥ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">start</span><span class="w"> </span><span class="n">slave</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="6">
<li>å†æ¬¡æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€ï¼Œ<code>Slave_IO_Running</code>ã€<code>Slave_SQL_Running</code>éƒ½å˜ä¸º<code>Yes</code>ã€‚</li>
</ol>
<p>ä¸»ä»å¤åˆ¶æµ‹è¯•ï¼š</p>
<ol>
<li>åœ¨ä¸»æ•°æ®åº“ä¸Šæ–°å»ºåº“ã€ä½¿ç”¨åº“ã€æ–°å»ºè¡¨ã€æ’å…¥æ•°æ®</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">db01</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">use</span><span class="w"> </span><span class="n">db01</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;abc&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>åœ¨ä»æ•°æ®åº“ä¸Šä½¿ç”¨åº“ã€æŸ¥çœ‹è®°å½•</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">show</span><span class="w"> </span><span class="n">databases</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">use</span><span class="w"> </span><span class="n">db01</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="10-dockerå®‰è£…redis"><strong>10-Dockerå®‰è£…Redis</strong>
</h1><h2 id="dockerå®‰è£…redis">Dockerå®‰è£…Redis
</h2><p>ä»¥ Redis 6.0.8 ä¸ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull redis:6.0.8
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å•æœºç‰ˆå®‰è£…">å•æœºç‰ˆå®‰è£…
</h2><h3 id="ç®€å•ç‰ˆ-redis">ç®€å•ç‰ˆ Redis
</h3><p>ç®€å•çš„å¯åŠ¨Rediså®¹å™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -p 6379:6379 -d redis:6.0.8
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç®€å•ç‰ˆæ²¡æœ‰é…ç½®å®¹å™¨å·æ˜ å°„ï¼Œå½“å®¹å™¨è¢«åˆ é™¤æ—¶æ•°æ®æ— æ³•æ¢å¤ã€‚</p>
<h3 id="å®é™…åº”ç”¨ç‰ˆredis">å®é™…åº”ç”¨ç‰ˆRedis
</h3><p>é…ç½®æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶éƒ½å’Œå®¹å™¨å·è¿›è¡Œæ˜ å°„ã€‚</p>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>å®¿ä¸»æœºåˆ›å»ºç›®å½•<code>/app/redis</code></li>
<li>åœ¨<code>/app/redis</code>ä¸‹åˆ›å»ºæ–‡ä»¶<code>redis.conf</code>ï¼Œä¸»è¦ä¿®æ”¹ä»¥ä¸‹å‡ é¡¹é…ç½®</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl"># å¼€å¯å¯†ç éªŒè¯ï¼ˆå¯é€‰ï¼‰
</span></span><span class="line"><span class="cl">requirepass 123
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># å…è®¸rediså¤–åœ°è¿æ¥ï¼Œéœ€è¦æ³¨é‡Šæ‰ç»‘å®šçš„IP
</span></span><span class="line"><span class="cl"># bind 127.0.0.1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># å…³é—­ä¿æŠ¤æ¨¡å¼ï¼ˆå¯é€‰ï¼‰
</span></span><span class="line"><span class="cl">protected-mode no
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># æ³¨é‡Šæ‰daemonize yesï¼Œæˆ–è€…é…ç½®æˆ daemonize noã€‚å› ä¸ºè¯¥é…ç½®å’Œ docker runä¸­çš„ -d å‚æ•°å†²çªï¼Œä¼šå¯¼è‡´å®¹å™¨ä¸€ç›´å¯åŠ¨å¤±è´¥
</span></span><span class="line"><span class="cl">daemonize no
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># å¼€å¯redisæ•°æ®æŒä¹…åŒ–ï¼Œ ï¼ˆå¯é€‰ï¼‰
</span></span><span class="line"><span class="cl">appendonly yes  
</span></span></code></pre></td></tr></table>
</div>
</div><p>å³æœ€åçš„é…ç½®æ–‡ä»¶ä¸ºï¼š</p>
<ol start="3">
<li>å¯åŠ¨dockerå®¹å™¨ï¼šï¼ˆå› ä¸ºè¦ä½¿ç”¨è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šå®¹å™¨è¿è¡Œçš„å‘½ä»¤ä¸º<code>redis-server å®¹å™¨å†…é…ç½®æ–‡ä»¶è·¯å¾„</code>ï¼‰</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d -p 63789:6379 --name redis --privileged<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/redis/redis.conf:/etc/redis/redis.conf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           -v /app/redis/data:/data <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           redis:6.0.8 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>           redis-server /etc/redis/redis.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é›†ç¾¤å­˜å‚¨ç®—æ³•">é›†ç¾¤å­˜å‚¨ç®—æ³•
</h2><h3 id="åˆ†å¸ƒå¼å­˜å‚¨ç®—æ³•">åˆ†å¸ƒå¼å­˜å‚¨ç®—æ³•
</h3><p>åˆ†å¸ƒå¼å­˜å‚¨çš„å¸¸è§ç®—æ³•ï¼š</p>
<ul>
<li>
<p>å“ˆå¸Œå–ä½™ç®—æ³•åˆ†åŒº</p>
</li>
<li>
<p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åˆ†åŒº</p>
</li>
<li>
<p>å“ˆå¸Œæ§½ç®—æ³•åˆ†åŒº</p>
</li>
</ul>
<h3 id="å“ˆå¸Œå–ä½™ç®—æ³•">å“ˆå¸Œå–ä½™ç®—æ³•
</h3><p>ç®—æ³•æè¿°ï¼š<code>hash(key) % N</code>ï¼ˆå…¶ä¸­ï¼Œ<code>key</code>æ˜¯è¦å­˜å…¥Redisçš„é”®åï¼Œ<code>N</code>æ˜¯Redisé›†ç¾¤çš„æœºå™¨å°æ•°ï¼‰ã€‚ç”¨æˆ·æ¯æ¬¡è¯»å†™æ“ä½œï¼Œéƒ½æ˜¯æ ¹æ®ä¼ å…¥çš„é”®åç»è¿‡å“ˆå¸Œè¿ç®—ï¼Œå¯¹æœºå™¨å°æ•°å–ä½™å†³å®šè¯¥é”®å­˜å‚¨åœ¨å“ªå°æœåŠ¡å™¨ä¸Šã€‚</p>
<p>ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥æœ‰æ•ˆï¼Œåªéœ€è¦é¢„ä¼°å¥½æ•°æ®è§„åˆ’å¥½èŠ‚ç‚¹ï¼Œå°±èƒ½ä¿è¯ä¸€æ®µæ—¶é—´çš„æ•°æ®æ”¯æ’‘ã€‚ä½¿ç”¨Hashç®—æ³•è®©å›ºå®šçš„ä¸€éƒ¨åˆ†è¯·æ±‚è½åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æ¯å°æœåŠ¡å™¨å›ºå®šå¤„ç†ä¸€éƒ¨åˆ†è¯·æ±‚ï¼ˆå¹¶ç»´æŠ¤è¿™äº›è¯·æ±‚çš„ä¿¡æ¯ï¼‰ï¼Œèµ·åˆ°è´Ÿè½½å‡è¡¡+åˆ†è€Œæ²»ä¹‹çš„ä½œç”¨ã€‚</p>
<p>ç¼ºç‚¹ï¼šåŸæ¥è§„åˆ’å¥½çš„èŠ‚ç‚¹ï¼Œå¦‚æœè¿›è¡Œäº†æ‰©å®¹æˆ–è€…ç¼©å®¹ï¼Œå¯¼è‡´èŠ‚ç‚¹æœ‰å˜åŠ¨ï¼Œæ˜ å°„å…³ç³»éœ€è¦é‡æ–°è¿›è¡Œè®¡ç®—ã€‚åœ¨æœåŠ¡å™¨ä¸ªæ•°å›ºå®šä¸å˜æ—¶æ²¡é—®é¢˜ï¼Œå¦‚æœéœ€è¦å¼¹æ€§æ‰©å®¹æˆ–è€…æ•…éšœåœæœºçš„æƒ…å†µä¸‹ï¼ŒåŸæ¥å–æ¨¡å…¬å¼ä¸­çš„ <code>N</code>å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶ç»è¿‡å–æ¨¡è¿ç®—çš„ç»“æœå°±ä¼šå‘ç”Ÿå¾ˆå¤§å˜åŒ–ï¼Œå¯¼è‡´æ ¹æ®å…¬å¼è·å–çš„æœåŠ¡å™¨å˜å¾—ä¸å¯æ§ã€‚</p>
<h3 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•">ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•
</h3><p>ç®—æ³•èƒŒæ™¯ï¼šä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯<strong>ä¸ºäº†è§£å†³å“ˆå¸Œå–ä½™ç®—æ³•ä¸­çš„åˆ†å¸ƒå¼ç¼“å­˜æ•°æ®å˜åŠ¨å’Œæ˜ å°„é—®é¢˜</strong>ã€‚å½“æœåŠ¡å™¨ä¸ªæ•°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°½é‡å‡å°‘å½±å“åˆ°å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„æ˜ å°„å…³ç³»ã€‚</p>
<p>ç®—æ³•æè¿°ï¼š</p>
<p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¿…ç„¶æœ‰ä¸ªhashå‡½æ•°å¹¶æŒ‰ç…§ç®—æ³•äº§ç”ŸHashå€¼ï¼Œè¿™ä¸ªç®—æ³•çš„æ‰€æœ‰å¯èƒ½å“ˆå¸Œå€¼ä¼šæ„æˆä¸€ä¸ªå…¨é‡é›†ï¼Œè¿™ä¸ªé›†åˆå¯ä»¥æˆä¸ºä¸€ä¸ªHashåŒºé—´<code>[0, 2^32 - 1]</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªçº¿æ€§ç©ºé—´ã€‚ä½†æ˜¯åœ¨è¿™ä¸ªç®—æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡é€‚å½“çš„é€»è¾‘æ§åˆ¶å°†å®ƒé¦–å°¾ç›¸è¿ï¼ˆ<code>0 = 2^32</code>ï¼‰ï¼Œè¿™æ ·è®©å®ƒé€»è¾‘ä¸Šå½¢æˆäº†ä¸€ä¸ªç¯å½¢ç©ºé—´ã€‚</p>
<p>å®ƒä¹Ÿæ˜¯æŒ‰ç…§ä½¿ç”¨å–æ¨¡çš„æ–¹å¼ã€‚å‰é¢çš„å“ˆå¸Œå–ä½™ç®—æ³•æ˜¯å¯¹èŠ‚ç‚¹ä¸ªæ•°è¿›è¡Œå–æ¨¡ï¼Œè€Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ˜¯å¯¹ <code>2^32</code>å–æ¨¡ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œä¸€è‡´æ€§Hashç®—æ³•å°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ã€‚å¦‚å‡è®¾æŸä¸ªå“ˆå¸Œå‡½æ•°<code>H</code>çš„å€¼ç©ºé—´ä¸º <code>0</code>åˆ°<code>2^32 - 1</code>ï¼ˆå³å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´å½¢ï¼‰ï¼Œæ•´ä¸ªå“ˆå¸Œç¯å¦‚ä¸‹å›¾ï¼šæ•´ä¸ªç©ºé—´æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„ç»‡ï¼Œåœ†ç¯çš„æ­£ä¸Šæ–¹çš„ç‚¹ä»£è¡¨0ï¼Œ0ç‚¹å³ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨1ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ2ã€3ã€4&hellip;&hellip;.ç›´åˆ°<code>2^32 - 1</code>ï¼Œä¹Ÿå°±æ˜¯è¯´0ç‚¹å·¦ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨ <code>2^32 - 1</code>ã€‚0 å’Œ <code>2^32 - 1</code>åœ¨é›¶ç‚¹é’Ÿæ–¹å‘é‡åˆï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç”± <code>2^32</code>ä¸ªç‚¹ç»„æˆçš„åœ†ç¯ç§°ä¸ºHashç¯ã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash01.jpg"
	width="413"
	height="439"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash01_hu13685704357302040426.jpg 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash01_hu904947526921931736.jpg 1024w"
	loading="lazy"
	
		alt="hash01"
	
	
		class="gallery-image" 
		data-flex-grow="94"
		data-flex-basis="225px"
	
></p>
<p>æœ‰äº†å“ˆå¸Œç¯ä¹‹åï¼Œè¿˜éœ€è¦è¿›è¡ŒèŠ‚ç‚¹æ˜ å°„ï¼Œå°†é›†ç¾¤ä¸­å„ä¸ªIPèŠ‚ç‚¹æ˜ å°„åˆ°ç¯ä¸Šçš„æŸä¸€ä¸ªä½ç½®ã€‚</p>
<p>å°†å„ä¸ªæœåŠ¡å™¨ä½¿ç”¨Hashè¿›è¡Œä¸€ä¸ªå“ˆå¸Œï¼Œå…·ä½“å¯ä»¥é€‰æ‹©æœåŠ¡å™¨çš„IPæˆ–ä¸»æœºåä½œä¸ºå…³é”®å­—è¿›è¡Œå“ˆå¸Œã€‚è¿™æ ·æ¯å°æœºå™¨å°±èƒ½ç¡®å®šå…¶åœ¨å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ã€‚</p>
<p>å‡å¦‚4ä¸ªèŠ‚ç‚¹NodeAã€Bã€Cã€Dï¼Œç»è¿‡IPåœ°å€çš„å“ˆå¸Œå‡½æ•°è®¡ç®—ï¼ˆ<code>hash(ip)</code>ï¼‰ï¼Œä½¿ç”¨IPåœ°å€å“ˆå¸Œå€¼ååœ¨ç¯ç©ºé—´çš„ä½ç½®å¦‚ä¸‹ï¼š</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash02.jpg"
	width="653"
	height="682"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash02_hu2360171310765157114.jpg 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash02_hu8269989832877052150.jpg 1024w"
	loading="lazy"
	
		alt="hash02"
	
	
		class="gallery-image" 
		data-flex-grow="95"
		data-flex-basis="229px"
	
></p>
<p><code>key</code>è½åˆ°æœåŠ¡å™¨çš„è½é”®è§„åˆ™ã€‚å½“æˆ‘ä»¬éœ€è¦å­˜å‚¨ä¸€ä¸ª<code>key</code>é”®å€¼å¯¹æ—¶ï¼Œé¦–å…ˆè®¡ç®—<code>key</code>çš„<code>hash</code>å€¼ï¼ˆ<code>hash(key)</code>ï¼‰ï¼Œå°†è¿™ä¸ª<code>key</code>ä½¿ç”¨ç›¸åŒçš„å‡½æ•°hashï¼Œè®¡ç®—å‡ºå“ˆå¸Œå€¼å¹¶ç¡®å®šæ­¤æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œä»æ­¤ä½ç½®æ²¿ç¯é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€ï¼Œç¬¬ä¸€å°é‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥å®šä½åˆ°çš„æœåŠ¡å™¨ï¼Œå¹¶å°†è¯¥é”®å€¼å¯¹å­˜å‚¨å­—è¯¥èŠ‚ç‚¹ä¸Šã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬æœ‰ObjectAã€Bã€Cã€Då››ä¸ªæ•°æ®å¯¹è±¡ï¼Œç»è¿‡å“ˆå¸Œè®¡ç®—åï¼Œåœ¨ç¯ç©ºé—´ä¸Šçš„ä½ç½®å¦‚ä¸‹ï¼šæ ¹æ®ä¸€è‡´æ€§hashç®—æ³•ï¼Œæ•°æ®Aä¼šè¢«å®šä½åˆ°NodeAä¸Šï¼ŒBè¢«å®šä½åˆ°NodeBä¸Šï¼ŒCè¢«å®šä½åˆ°NodeCä¸Šï¼ŒDè¢«å®šä½åˆ°NodeDä¸Šã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash03.jpg"
	width="640"
	height="657"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash03_hu2849148150806299457.jpg 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash03_hu11975313045933705383.jpg 1024w"
	loading="lazy"
	
		alt="hash03"
	
	
		class="gallery-image" 
		data-flex-grow="97"
		data-flex-basis="233px"
	
></p>
<p>å‡è®¾NodeCå®•æœºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶å¯¹è±¡Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Cå¯¹è±¡è¢«é‡æ–°å®šä½åˆ°NodeDã€‚</p>
<p>ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§Hashç®—æ³•ä¸­ï¼Œå¦‚æœä¸€å°æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´çš„æ•°æ®ï¼Œå…¶ä»–ä¸ä¼šå—åˆ°å½±å“ã€‚</p>
<p>å³ï¼šå‡è®¾NodeCå®•æœºï¼Œåªä¼šå½±å“åˆ°Hashå®šä½åˆ°NodeBåˆ°NodeCä¹‹é—´çš„æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®ä¼šè¢«è½¬ç§»åˆ°NodeDè¿›è¡Œå­˜å‚¨ã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash04.jpg"
	width="421"
	height="435"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash04_hu1037251975870481196.jpg 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash04_hu16055805743191088506.jpg 1024w"
	loading="lazy"
	
		alt="hash04"
	
	
		class="gallery-image" 
		data-flex-grow="96"
		data-flex-basis="232px"
	
></p>
<p>å‡å¦‚éœ€è¦æ‰©å®¹å¢åŠ ä¸€å°èŠ‚ç‚¹NodeXï¼ŒNodeXçš„<code>hash(ip)</code>ä½äºNodeBå’ŒNodeCä¹‹é—´ï¼Œé‚£å—åˆ°å½±å“çš„å°±æ˜¯NodeB åˆ° NodeX ä¹‹é—´çš„æ•°æ®ã€‚é‡æ–°å°†Båˆ°Xçš„æ•°æ®å½•å…¥åˆ°XèŠ‚ç‚¹ä¸Šå³å¯ï¼Œä¸ä¼šå¯¼è‡´Hashå–ä½™å…¨éƒ¨æ•°æ®é‡æ–°æ´—ç‰Œçš„åæœã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash05.jpg"
	width="635"
	height="660"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash05_hu2170455223849715486.jpg 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash05_hu9824778234852266788.jpg 1024w"
	loading="lazy"
	
		alt="hash05"
	
	
		class="gallery-image" 
		data-flex-grow="96"
		data-flex-basis="230px"
	
></p>
<p>ä½†æ˜¯Hashç¯ä¼šå­˜åœ¨æ•°æ®å€¾æ–œé—®é¢˜ã€‚</p>
<p>ä¸€è‡´æ€§Hashç®—æ³•åœ¨æœåŠ¡èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†å¸ƒä¸å‡åŒ€è€Œé€ æˆæ•°æ®å€¾æ–œï¼ˆè¢«ç¼“å­˜çš„å¯¹è±¡éƒ½é›†ä¸­åˆ°æŸä¸€å°æˆ–æŸå‡ å°æœåŠ¡å™¨ï¼‰ã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash06.webp"
	width="444"
	height="473"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash06_hu2732235108979521478.webp 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash06_hu12244106516663788417.webp 1024w"
	loading="lazy"
	
		alt="hash06"
	
	
		class="gallery-image" 
		data-flex-grow="93"
		data-flex-basis="225px"
	
></p>
<p>ä¸ºäº†è§£å†³æ•°æ®å€¾æ–œé—®é¢˜ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶ã€‚</p>
<p>å¯¹æ¯ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹è®¡ç®—å¤šä¸ªå“ˆå¸Œï¼Œæ¯ä¸ªè®¡ç®—ç»“æœä½ç½®éƒ½æ”¾ç½®ä¸€ä¸ªæ­¤æœåŠ¡èŠ‚ç‚¹ï¼Œç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚å…·ä½“åšæ³•å¯ä»¥å…ˆç¡®å®šæ¯ä¸ªç‰©ç†èŠ‚ç‚¹å…³è”çš„è™šæ‹ŸèŠ‚ç‚¹æ•°é‡ï¼Œç„¶ååœ¨IPæˆ–ä¸»æœºååé¢åŠ ä¸Šç¼–å·ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯ä»¥å¯¹NodeAèŠ‚ç‚¹è™šæ‹Ÿå‡º NodeA#1ã€NodeA#2ã€NodeA#3ï¼Œå¯¹NodeBè™šæ‹Ÿå‡ºNodeB#1ã€NodeB#2ã€NodeB#3çš„èŠ‚ç‚¹ï¼Œå½¢æˆå…­ä¸ªè™šæ‹ŸèŠ‚ç‚¹ã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash07.jpg"
	width="638"
	height="666"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash07_hu17833186865241087784.jpg 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/hash07_hu3244121677151060295.jpg 1024w"
	loading="lazy"
	
		alt="hash07"
	
	
		class="gallery-image" 
		data-flex-grow="95"
		data-flex-basis="229px"
	
></p>
<p>ä¼˜ç‚¹ï¼šåŠ å…¥å’Œåˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œåªä¼šå½±å“å“ˆå¸Œç¯ä¸­é¡ºæ—¶é’ˆæ–¹å‘ç›¸é‚»èŠ‚ç‚¹ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ— å½±å“ã€‚</p>
<p>ç¼ºç‚¹ï¼šæ•°æ®çš„åˆ†å¸ƒå’ŒèŠ‚ç‚¹çš„ä½ç½®æœ‰å…³ï¼Œå› ä¸ºè¿™äº›èŠ‚ç‚¹ä¸æ˜¯å‡åŒ€åˆ†å¸ƒåœ¨å“ˆå¸Œç¯ä¸Šçš„ï¼Œæ‰€ä»¥åœ¨æ•°æ®è¿›è¡Œå­˜å‚¨æ—¶è¾¾ä¸åˆ°å‡åŒ€éƒ¨åˆ†çš„æ•ˆæœã€‚</p>
<h3 id="å“ˆå¸Œæ§½åˆ†åŒº">å“ˆå¸Œæ§½åˆ†åŒº
</h3><p>å“ˆå¸Œæ§½åˆ†åŒºæ˜¯ä¸ºäº†è§£å†³ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„æ•°æ®å€¾æ–œé—®é¢˜ã€‚</p>
<p>å“ˆå¸Œæ§½å®è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ <code>[0, 2^14 - 1]</code>å½¢æˆçš„ hash slotç©ºé—´ã€‚</p>
<p>ç›®çš„æ˜¯ä¸ºäº†è§£å†³å‡åŒ€åˆ†é…çš„é—®é¢˜ã€‚åœ¨æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´åˆåŠ å…¥äº†ä¸€å±‚ï¼ŒæŠŠè¿™å±‚ç§°ä¹‹ä¸ºæ§½ï¼ˆslotï¼‰ï¼Œç”¨äºç®¡ç†æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ã€‚å°±ç›¸å½“äºèŠ‚ç‚¹ä¸Šæ”¾çš„æ˜¯æ§½ï¼Œæ§½é‡Œé¢æ”¾çš„æ˜¯æ•°æ®ã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/slot01.png"
	width="723"
	height="218"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/slot01_hu4202728621939854112.png 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/slot01_hu7015128119803337554.png 1024w"
	loading="lazy"
	
		alt="slot01"
	
	
		class="gallery-image" 
		data-flex-grow="331"
		data-flex-basis="795px"
	
></p>
<p>æ§½è§£å†³çš„æ˜¯ç²’åº¦é—®é¢˜ï¼Œç›¸å½“äºæŠŠç²’åº¦å˜å¤§äº†ï¼Œè¿™æ ·ä¾¿äºæ•°æ®ç§»åŠ¨ã€‚</p>
<p>å“ˆå¸Œè§£å†³çš„æ˜¯æ˜ å°„é—®é¢˜ï¼Œä½¿ç”¨<code>key</code>çš„å“ˆå¸Œå€¼æ¥è®¡ç®—æ‰€åœ¨çš„æ§½ï¼Œä¾¿äºæ•°æ®åˆ†é…ã€‚</p>
<p>ä¸€ä¸ªé›†ç¾¤åªèƒ½æœ‰ 16394ä¸ªæ§½ï¼Œç¼–å· 0 - 16383ï¼ˆ<code>2^14 - 1</code>ï¼‰ã€‚è¿™äº›æ§½ä¼šåˆ†é…ç»™é›†ç¾¤ä¸­æ‰€æœ‰çš„ä¸»èŠ‚ç‚¹ï¼Œåˆ†é…ç­–ç•¥æ²¡æœ‰è¦æ±‚ã€‚å¯ä»¥æŒ‡å®šå“ªäº›ç¼–å·çš„æ§½åˆ†é…ç»™å“ªä¸ªä¸»èŠ‚ç‚¹ï¼Œé›†ç¾¤ä¼šè®°å½•èŠ‚ç‚¹å’Œæ§½çš„å¯¹åº”å…³ç³»ã€‚</p>
<p>è§£å†³äº†èŠ‚ç‚¹å’Œæ§½çš„å…³ç³»åï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å¯¹<code>key</code>æ±‚å“ˆå¸Œå€¼ï¼Œç„¶åå¯¹16384å–ä½™ï¼Œæ ¹æ®ä½™æ•°å†³å®š<code>key</code>è½åˆ°å“ªä¸ªæ§½é‡Œã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">slot = CRC16(key) % 16384
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»¥æ§½ä¸ºå•ä½ç§»åŠ¨æ•°æ®ï¼Œå› ä¸ºæ§½çš„æ•°ç›®æ˜¯å›ºå®šçš„ï¼Œå¤„ç†èµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œè¿™æ ·æ•°æ®ç§»åŠ¨é—®é¢˜å°±è§£å†³äº†ã€‚</p>
<h3 id="redisé›†ç¾¤å­˜å‚¨ç­–ç•¥">Redisé›†ç¾¤å­˜å‚¨ç­–ç•¥
</h3><p>Redisé›†ç¾¤ä½¿ç”¨çš„å°±æ˜¯å“ˆå¸Œæ§½ã€‚Redisé›†ç¾¤æœ‰16384ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ª<code>key</code>é€šè¿‡<code>CRC16</code>æ ¡éªŒåå¯¹16384å–æ¨¡æ¥å†³å®šæ”¾ç½®åœ¨å“ªä¸ªæ§½ï¼Œé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½ã€‚</p>
<p>å“ˆå¸Œæ§½æ•°é‡16384ï¼ˆ<code>2^14</code>ï¼‰çš„å†³å®šåŸå› ï¼š</p>
<p><code>CRC16</code>ç®—æ³•äº§ç”Ÿçš„hashå€¼æœ‰ 16bitï¼Œè¯¥ç®—æ³•å¯ä»¥äº§ç”Ÿ <code>2^16</code> = 65536ä¸ªå€¼ã€‚ä½†æ˜¯ä¸ºäº†å¿ƒè·³æ–¹ä¾¿å’Œæ•°æ®ä¼ è¾“æœ€å¤§åŒ–ï¼Œæ§½çš„æ•°é‡åªèƒ½æœ‰ <code>2^14</code>ä¸ªã€‚</p>
<ol>
<li>å¦‚æœæ§½ä½æ•°é‡ä¸º65535ä¸ªï¼Œé‚£ä¹ˆå‘é€å¿ƒè·³ä¿¡æ¯çš„æ¶ˆæ¯å¤´å°†è¾¾åˆ° 8kï¼Œå‘é€çš„å¿ƒè·³åŒ…è¿‡äºåºå¤§ã€‚åœ¨æ¶ˆæ¯å¤´ä¸­æœ€å ç©ºé—´çš„æ˜¯ <code>myslots[CLUSTER_SLOTS/8]</code>ã€‚å½“æ§½ä½ä¸º65536æ—¶ï¼Œè¿™å—çš„å¤§å°æ˜¯ ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">65536 Ã· 8 Ã· 1024 = 8Kb
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¯ç§’ä¸­redisèŠ‚ç‚¹éœ€è¦å‘é€ä¸€å®šæ•°é‡çš„pingæ¶ˆæ¯ä½œä¸ºå¿ƒè·³ï¼Œå¦‚æœæ§½ä½ä¸º65536ï¼Œé‚£ä¹ˆè¿™ä¸ªpingæ¶ˆæ¯å¤´å°±ä¼šå¤ªå¤§æµªè´¹å¸¦å®½ã€‚</p>
<ol start="2">
<li>
<p>redisé›†ç¾¤çš„ä¸»èŠ‚ç‚¹æ•°é‡åŸºæœ¬ä¸å¯èƒ½è¶…è¿‡1000ä¸ªã€‚é›†ç¾¤èŠ‚ç‚¹è¶Šå¤šï¼Œå¿ƒè·³åŒ…çš„æ¶ˆæ¯ä½“å†…æºå¸¦çš„æ•°æ®è¶Šå¤šã€‚å¦‚æœèŠ‚ç‚¹è¶…è¿‡1000ä¸ªï¼Œä¹Ÿä¼šå¯¼è‡´ç½‘ç»œæ‹¥å µã€‚å› æ­¤redisä½œè€…ä¸å»ºè®®redis clusterèŠ‚ç‚¹è¶…è¿‡1000ä¸ªã€‚å¯¹äºèŠ‚ç‚¹æ•°åœ¨1000ä»¥å†…çš„redis clusteré›†ç¾¤ï¼Œ16384ä¸ªæ§½ä½è¶³å¤Ÿäº†ï¼Œæ²¡æœ‰å¿…è¦æ‰©å±•åˆ°65536ä¸ªã€‚</p>
</li>
<li>
<p>æ§½ä½è¶Šå°ï¼ŒèŠ‚ç‚¹å°‘çš„æƒ…å†µä¸‹å‹ç¼©æ¯”è¶Šé«˜ï¼Œå®¹æ˜“ä¼ è¾“ã€‚Redisä¸»èŠ‚ç‚¹çš„é…ç½®ä¿¡æ¯ä¸­å®ƒé”è´Ÿè´£çš„å“ˆå¸Œæ§½æ˜¯é€šè¿‡ä¸€å¼ bitmapçš„å½¢å¼æ¥ä¿å­˜çš„ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¼šå¯¹bitmapè¿›è¡Œå‹ç¼©ï¼Œä½†æ˜¯å¦‚æœbitmapçš„å¡«å……ç‡ <code>slots / N</code>ï¼ˆNä¸ºèŠ‚ç‚¹æ•°ï¼‰å¾ˆé«˜çš„è¯ï¼Œbitmapçš„å‹ç¼©ç‡å°±å¾ˆä½ã€‚å¦‚æœèŠ‚ç‚¹æ•°å¾ˆå°‘ï¼Œè€Œå“ˆå¸Œæ§½æ•°å¾ˆå¤šçš„è¯ï¼Œbitmapçš„å‹ç¼©ç‡å°±å¾ˆä½ã€‚</p>
</li>
</ol>
<blockquote>
<p>åŸæ–‡ï¼š</p>
<p>æ­£å¸¸çš„å¿ƒè·³æ•°æ®åŒ…å¸¦æœ‰èŠ‚ç‚¹çš„å®Œæ•´é…ç½®ï¼Œä½¿å¾—å¯ä»¥ç”¨å¹‚ç­‰æ–¹å¼ç”¨æ—§çš„èŠ‚ç‚¹æ›¿æ¢æ—§èŠ‚ç‚¹ï¼Œä»¥ä¾¿æ›´æ–°æ—§çš„é…ç½®ã€‚è¿™æ„å‘³ç€å®ƒä»¬åŒ…å«åŸå§‹èŠ‚ç‚¹çš„æ’æ§½é…ç½®ï¼Œè¯¥èŠ‚ç‚¹ä½¿ç”¨ 2k çš„ç©ºé—´å’Œ 16k çš„æ’æ§½ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ 8k çš„ç©ºé—´ï¼ˆä½¿ç”¨65kçš„æ’æ§½ï¼‰ã€‚</p>
<p>åŒæ—¶ï¼Œå› ä¸ºå…¶ä»–è®¾è®¡æŠ˜è¡·ï¼ŒRedisé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ä¸å¤ªå¯èƒ½æ‰©å±•åˆ°1000ä¸ªä»¥ä¸Š</p>
</blockquote>
<p>Redisé›†ç¾¤ä¸­å†…ç½®äº†16384ä¸ªå“ˆå¸Œæ§½ï¼Œredisä¼šæ ¹æ®èŠ‚ç‚¹æ•°é‡å¤§è‡´å‡ç­‰çš„å°†å“ˆå¸Œæ§½æ˜ å°„åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚å½“éœ€è¦åœ¨Redisé›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ª<code>Key-Value</code>æ—¶ï¼Œrediså…ˆå¯¹<code>key</code>ä½¿ç”¨ <code>CRC16</code> ç®—æ³•ç®—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå¯¹ 16384 å–ä½™ï¼Œè¿™æ ·æ¯ä¸ª<code>key</code>éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨0-16383ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œä¹Ÿå°±æ˜¯æ˜ å°„åˆ°æŸä¸ªèŠ‚ç‚¹ä¸Šã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/slot02.png"
	width="693"
	height="499"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/slot02_hu1628074592932486108.png 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/slot02_hu10241368228933932198.png 1024w"
	loading="lazy"
	
		alt="slot02"
	
	
		class="gallery-image" 
		data-flex-grow="138"
		data-flex-basis="333px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// import io.lettuce.core.cluster.SlotHash;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">SlotHash</span><span class="p">.</span><span class="na">getSlot</span><span class="p">(</span><span class="sc">&#39;A&#39;</span><span class="p">));</span><span class="w">  </span><span class="c1">// è®¡ç®—ç»“æœ6373ï¼Œå­˜å…¥ä¸Šå›¾çš„Node2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">SlotHash</span><span class="p">.</span><span class="na">getSlot</span><span class="p">(</span><span class="sc">&#39;B&#39;</span><span class="p">));</span><span class="w">  </span><span class="c1">// è®¡ç®—ç»“æœ10374ï¼Œå­˜å…¥ä¸Šå›¾çš„Node2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">SlotHash</span><span class="p">.</span><span class="na">getSlot</span><span class="p">(</span><span class="sc">&#39;C&#39;</span><span class="p">));</span><span class="w">  </span><span class="c1">// è®¡ç®—ç»“æœ14503ï¼Œå­˜å…¥ä¸Šå›¾çš„Node3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">SlotHash</span><span class="p">.</span><span class="na">getSlot</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Hello</span><span class="err">&#39;</span><span class="p">));</span><span class="w">  </span><span class="c1">// è®¡ç®—ç»“æœ866ï¼Œå­˜å…¥ä¸Šå›¾çš„Node1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3ä¸»3ä»redisé›†ç¾¤">3ä¸»3ä»Redisé›†ç¾¤
</h2><h3 id="æ­å»º">æ­å»º
</h3><p>ä½¿ç”¨dockeræ­å»º3ä¸»3ä»çš„Redisé›†ç¾¤ï¼Œæ¯å°ä¸»æœºéƒ½å¯¹åº”ä¸€å°ä»æœºã€‚</p>
<p>å¯åŠ¨6å°rediså®¹å™¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ç¬¬1å°èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --net host ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£ï¼Œé»˜è®¤</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --cluster-enabled yes å¼€å¯redisé›†ç¾¤</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --appendonly yes å¼€å¯redisæŒä¹…åŒ–</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --port 6381 é…ç½®redisç«¯å£å·</span>
</span></span><span class="line"><span class="cl">docker run -d --name redis-node-1 --net host --privileged<span class="o">=</span><span class="nb">true</span> -v /app/redis-cluster/share/redis-node-1:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port <span class="m">6381</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ç¬¬2å°èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">docker run -d --name redis-node-2 --net host --privileged<span class="o">=</span><span class="nb">true</span> -v /app/redis-cluster/share/redis-node-2:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port <span class="m">6382</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ç¬¬3å°èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">docker run -d --name redis-node-3 --net host --privileged<span class="o">=</span><span class="nb">true</span> -v /app/redis-cluster/share/redis-node-3:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port <span class="m">6383</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ç¬¬4å°èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">docker run -d --name redis-node-4 --net host --privileged<span class="o">=</span><span class="nb">true</span> -v /app/redis-cluster/share/redis-node-4:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port <span class="m">6384</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ç¬¬5å°èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">docker run -d --name redis-node-5 --net host --privileged<span class="o">=</span><span class="nb">true</span> -v /app/redis-cluster/share/redis-node-5:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port <span class="m">6385</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ç¬¬6å°èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">docker run -d --name redis-node-6 --net host --privileged<span class="o">=</span><span class="nb">true</span> -v /app/redis-cluster/share/redis-node-6:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port <span class="m">6386</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ„å»ºä¸»ä»å…³ç³»ï¼š</p>
<ol>
<li>è¿›å…¥èŠ‚ç‚¹1ï¼ˆæˆ–å…¶ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼‰:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it redis-node-1 /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>æ„å»ºä¸»ä»å…³ç³»ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å®¿ä¸»æœºIP:ç«¯å£</span>
</span></span><span class="line"><span class="cl">redis-cli --cluster create 192.168.xxx.xxx:6381 192.168.xxx.xxx:6382 192.168.xxx.xxx:6383 192.168.xxx.xxx:6384 192.168.xxx.xxx:6385 192.168.xxx.xxx:6386 --cluster-replicas <span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>
<p>rediså°è¯•è‡ªåŠ¨è¿›è¡Œä¸»ä»èŠ‚ç‚¹åˆ†é…</p>
</li>
<li>
<p>å› ä¸ºæˆ‘ä»¬çš„dockerå®¹å™¨IPç›¸åŒï¼Œæ‰€ä»¥ä¼šå‡ºç°è­¦å‘Šï¼Œå¯ä»¥ç›´æ¥å¿½ç•¥è¯¥è­¦å‘Š</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">[WARNING] Some slaves are in the same host as their master
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>redisè‡ªåŠ¨åˆ†é…ç»“æœå®Œæˆåï¼Œéœ€è¦è¾“å…¥ <code>Yes</code> ç¡®è®¤é…ç½®ä¿¡æ¯ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">M: f451eb48bbc0a7c31c7da022ffe80cc1696e0f37 192.168.xxx.xxx:6381
</span></span><span class="line"><span class="cl">   slots:[0-5460] (5461 slots) master
</span></span><span class="line"><span class="cl">M: 05984211b8c38222a73abeff1d4e459c0fe1efbc 192.168.xxx.xxx:6382
</span></span><span class="line"><span class="cl">   slots:[5461-10922] (5462 slots) master
</span></span><span class="line"><span class="cl">M: 1fc935c12b1d34a7df50aed643c195eb29bb3435 192.168.xxx.xxx:6383
</span></span><span class="line"><span class="cl">   slots:[10923-16383] (5461 slots) master
</span></span><span class="line"><span class="cl">S: f8d0de47114bf33438747acd713cce4e412ae721 192.168.xxx.xxx:6384
</span></span><span class="line"><span class="cl">   replicates 1fc935c12b1d34a7df50aed643c195eb29bb3435
</span></span><span class="line"><span class="cl">S: de0b393c17e452d856f6de2b348e9ca4e5aa4002 192.168.xxx.xxx:6385
</span></span><span class="line"><span class="cl">   replicates f451eb48bbc0a7c31c7da022ffe80cc1696e0f37
</span></span><span class="line"><span class="cl">S: 0c0767e13a09ee48541738d4163592cd9842c143 192.168.xxx.xxx:6386
</span></span><span class="line"><span class="cl">   replicates 05984211b8c38222a73abeff1d4e459c0fe1efbc
</span></span><span class="line"><span class="cl">Can I set the above configuration? (type &#39;yes&#39; to accept):
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="6">
<li>è¾“å…¥<code>Yes</code>ç¡®è®¤åï¼Œredisä¼šå‘å…¶ä»–èŠ‚ç‚¹å‘é€ä¿¡æ¯åŠ å…¥é›†ç¾¤ï¼Œå¹¶åˆ†é…å“ˆå¸Œæ§½ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">&gt;&gt;&gt; Nodes configuration updated
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Assign a different config epoch to each node
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
</span></span><span class="line"><span class="cl">Waiting for the cluster to join
</span></span><span class="line"><span class="cl">.....
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Performing Cluster Check (using node 192.168.xxx.xxx:6381)
</span></span><span class="line"><span class="cl">M: f451eb48bbc0a7c31c7da022ffe80cc1696e0f37 192.168.xxx.xxx:6381
</span></span><span class="line"><span class="cl">   slots:[0-5460] (5461 slots) master
</span></span><span class="line"><span class="cl">   1 additional replica(s)
</span></span><span class="line"><span class="cl">M: 1fc935c12b1d34a7df50aed643c195eb29bb3435 192.168.xxx.xxx:6383
</span></span><span class="line"><span class="cl">   slots:[10923-16383] (5461 slots) master
</span></span><span class="line"><span class="cl">   1 additional replica(s)
</span></span><span class="line"><span class="cl">M: 05984211b8c38222a73abeff1d4e459c0fe1efbc 192.168.xxx.xxx:6382
</span></span><span class="line"><span class="cl">   slots:[5461-10922] (5462 slots) master
</span></span><span class="line"><span class="cl">   1 additional replica(s)
</span></span><span class="line"><span class="cl">S: 0c0767e13a09ee48541738d4163592cd9842c143 192.168.xxx.xxx:6386
</span></span><span class="line"><span class="cl">   slots: (0 slots) slave
</span></span><span class="line"><span class="cl">   replicates 05984211b8c38222a73abeff1d4e459c0fe1efbc
</span></span><span class="line"><span class="cl">S: f8d0de47114bf33438747acd713cce4e412ae721 192.168.xxx.xxx:6384
</span></span><span class="line"><span class="cl">   slots: (0 slots) slave
</span></span><span class="line"><span class="cl">   replicates 1fc935c12b1d34a7df50aed643c195eb29bb3435
</span></span><span class="line"><span class="cl">S: de0b393c17e452d856f6de2b348e9ca4e5aa4002 192.168.xxx.xxx:6385
</span></span><span class="line"><span class="cl">   slots: (0 slots) slave
</span></span><span class="line"><span class="cl">   replicates f451eb48bbc0a7c31c7da022ffe80cc1696e0f37
</span></span><span class="line"><span class="cl">[OK] All nodes agree about slots configuration.
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Check for open slots...
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Check slots coverage...
</span></span><span class="line"><span class="cl">[OK] All 16384 slots covered.
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p>
<ol>
<li>è¿›å…¥å®¹å™¨èŠ‚ç‚¹1ï¼ˆæˆ–é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹ï¼‰ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it redis-node-1 /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>ä½¿ç”¨<code>redis-cli</code>è¿æ¥åˆ°<code>6381</code>èŠ‚ç‚¹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli -p <span class="m">6381</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>ä½¿ç”¨<code>redis</code>çš„ç›¸å…³å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cluster info
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ï¼Œåˆ†é…çš„å“ˆå¸Œæ§½æ•°é‡ <code>cluster_slots_assigned</code>ä¸º16384ï¼Œé›†ç¾¤èŠ‚ç‚¹æ•°é‡<code>cluster_known_nodes</code>ä¸º6</p>
<ol start="4">
<li>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cluster nodes
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="redisé›†ç¾¤è¯»å†™å‡ºé”™">Redisé›†ç¾¤è¯»å†™å‡ºé”™
</h3><p>å½“ä½¿ç”¨ <code>redis-cli</code>è¿æ¥redisé›†ç¾¤æ—¶ï¼Œéœ€è¦æ·»åŠ  <code>-c</code>å‚æ•°ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°è¯»å†™å‡ºé”™ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<ol>
<li>è¿›å…¥å®¹å™¨èŠ‚ç‚¹1</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it redis-node-1 /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>ä½¿ç”¨<code>redis-cli</code>è¿æ¥ï¼Œä¸åŠ <code>-c</code>å‚æ•°æ—¶</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli -p <span class="m">6381</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>æ­¤æ—¶å‘redisä¸­æ·»åŠ é”®å€¼å¯¹ï¼Œå¯èƒ½ä¼šæˆåŠŸï¼Œä¹Ÿå¯èƒ½ä¼šå¤±è´¥</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">set</span> k1 v1
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŠ¥é”™ï¼š<code>k1</code>ç»è¿‡è®¡ç®—å¾—åˆ°çš„å“ˆå¸Œæ§½ä¸º12706ï¼Œä½†æ˜¯å½“å‰è¿æ¥çš„redis-serverä¸º<code>6381</code>ï¼ˆå³èŠ‚ç‚¹1ï¼‰ï¼Œå®ƒçš„å“ˆå¸Œæ§½ä¸ºï¼š<code>[0,5460]</code>ï¼ˆåœ¨åˆ›å»ºæ„å»ºä¸»ä»å…³ç³»æ—¶redisæœ‰æç¤ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>cluster nodes</code>æŸ¥çœ‹ï¼‰ï¼Œæ‰€ä»¥ä¼šå› ä¸ºå­˜ä¸è¿›å»è€ŒæŠ¥é”™ã€‚
æ‰§è¡Œ <code>set k2 v2</code>å¯ä»¥æˆåŠŸï¼Œå› ä¸º<code>k2</code>è®¡ç®—å‡ºçš„å“ˆå¸Œæ§½åœ¨<code>[0-5460]</code>åŒºé—´ä¸­ã€‚</p>
<ol start="4">
<li>ä½¿ç”¨<code>-c</code>å‚æ•°çš„<code>redis-cli</code>å‘½ä»¤è¿æ¥å³å¯</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli -p <span class="m">6381</span> -c
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>æ­¤æ—¶å¯ä»¥æ­£å¸¸çš„æ’å…¥æ‰€æœ‰æ•°æ®</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">set</span> k1 v1
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¼šæœ‰æç¤ºä¿¡æ¯ï¼Œå“ˆå¸Œæ§½ä¸º12706ï¼Œé‡å®šå‘åˆ°<code>6383</code>ï¼ˆå³èŠ‚ç‚¹3ï¼Œå“ˆå¸Œæ§½<code>[10923, 16383]</code>ï¼‰ï¼š</p>
<h3 id="é›†ç¾¤ä¿¡æ¯æ£€æŸ¥">é›†ç¾¤ä¿¡æ¯æ£€æŸ¥
</h3><p>æ£€æŸ¥æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼š</p>
<ol>
<li>è¿›å…¥å®¹å™¨èŠ‚ç‚¹1</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it redis-node-1 /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>è¿›è¡Œé›†ç¾¤ä¿¡æ¯æ£€æŸ¥</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># è¾“å…¥ä»»æ„ä¸€å°ä¸»èŠ‚ç‚¹åœ°å€éƒ½å¯ä»¥è¿›è¡Œé›†ç¾¤æ£€æŸ¥</span>
</span></span><span class="line"><span class="cl">redis-cli --cluster check 192.168.xxx.xxx:6381
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿”å›çš„æ£€æŸ¥ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">å½“å‰é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„keyçš„æ•°é‡
</span></span><span class="line"><span class="cl">192.168.xxx.xxx:6381 (f451eb48...) -&gt; 0 keys | 5461 slots | 1 slaves.
</span></span><span class="line"><span class="cl">192.168.xxx.xxx:6383 (1fc935c1...) -&gt; 1 keys | 5461 slots | 1 slaves.
</span></span><span class="line"><span class="cl">192.168.xxx.xxx:6382 (05984211...) -&gt; 0 keys | 5462 slots | 1 slaves.
</span></span><span class="line"><span class="cl">[OK] 1 keys in 3 masters.  
</span></span><span class="line"><span class="cl">0.00 keys per slot on average.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¸»ä»æœºå™¨ä¿¡æ¯
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Performing Cluster Check (using node 192.168.xxx.xxx:6381)
</span></span><span class="line"><span class="cl">M: f451eb48bbc0a7c31c7da022ffe80cc1696e0f37 192.168.xxx.xxx:6381
</span></span><span class="line"><span class="cl">   slots:[0-5460] (5461 slots) master
</span></span><span class="line"><span class="cl">   1 additional replica(s)
</span></span><span class="line"><span class="cl">M: 1fc935c12b1d34a7df50aed643c195eb29bb3435 192.168.xxx.xxx:6383
</span></span><span class="line"><span class="cl">   slots:[10923-16383] (5461 slots) master
</span></span><span class="line"><span class="cl">   1 additional replica(s)
</span></span><span class="line"><span class="cl">M: 05984211b8c38222a73abeff1d4e459c0fe1efbc 192.168.xxx.xxx:6382
</span></span><span class="line"><span class="cl">   slots:[5461-10922] (5462 slots) master
</span></span><span class="line"><span class="cl">   1 additional replica(s)
</span></span><span class="line"><span class="cl">S: 0c0767e13a09ee48541738d4163592cd9842c143 192.168.xxx.xxx:6386
</span></span><span class="line"><span class="cl">   slots: (0 slots) slave
</span></span><span class="line"><span class="cl">   replicates 05984211b8c38222a73abeff1d4e459c0fe1efbc
</span></span><span class="line"><span class="cl">S: f8d0de47114bf33438747acd713cce4e412ae721 192.168.xxx.xxx:6384
</span></span><span class="line"><span class="cl">   slots: (0 slots) slave
</span></span><span class="line"><span class="cl">   replicates 1fc935c12b1d34a7df50aed643c195eb29bb3435
</span></span><span class="line"><span class="cl">S: de0b393c17e452d856f6de2b348e9ca4e5aa4002 192.168.xxx.xxx:6385
</span></span><span class="line"><span class="cl">   slots: (0 slots) slave
</span></span><span class="line"><span class="cl">   replicates f451eb48bbc0a7c31c7da022ffe80cc1696e0f37
</span></span><span class="line"><span class="cl">[OK] All nodes agree about slots configuration.
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Check for open slots...
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Check slots coverage...
</span></span><span class="line"><span class="cl">[OK] All 16384 slots covered.
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¸»ä»æ‰©å®¹ç¼©å®¹">ä¸»ä»æ‰©å®¹ç¼©å®¹
</h2><h3 id="ä¸»ä»æ‰©å®¹">ä¸»ä»æ‰©å®¹
</h3><p>å‡å¦‚å› ä¸ºä¸šåŠ¡é‡æ¿€å¢ï¼Œéœ€è¦å‘å½“å‰3ä¸»3ä»çš„é›†ç¾¤ä¸­å†åŠ å…¥1ä¸»1ä»ä¸¤ä¸ªèŠ‚ç‚¹ã€‚</p>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>å¯åŠ¨2å°æ–°çš„å®¹å™¨èŠ‚ç‚¹</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ç¬¬7å°èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">docker run -d --name redis-node-7 --net host --privileged<span class="o">=</span><span class="nb">true</span> -v /app/redis-cluster/share/redis-node-7:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port <span class="m">6387</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ç¬¬8å°èŠ‚ç‚¹</span>
</span></span><span class="line"><span class="cl">docker run -d --name redis-node-8 --net host --privileged<span class="o">=</span><span class="nb">true</span> -v /app/redis-cluster/share/redis-node-8:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port <span class="m">6388</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>è¿›å…¥6387ï¼ˆèŠ‚ç‚¹7ï¼‰å®¹å™¨å†…éƒ¨</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it redis-node-7 /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>å°†6387ä½œä¸ºmasteråŠ å…¥é›†ç¾¤</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># redis-cli --cluster add-node æœ¬èŠ‚ç‚¹åœ°å€ è¦åŠ å…¥çš„é›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹åœ°å€</span>
</span></span><span class="line"><span class="cl">redis-cli --cluster add-node 192.168.xxx.xxx:6387 192.168.xxx.xxx:6381
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>æ£€æŸ¥å½“å‰é›†ç¾¤çŠ¶æ€</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli --cluster check 192.168.xxx.xxx:6381
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥å‘ç°ï¼Œ6371èŠ‚ç‚¹å·²ç»ä½œä¸ºmasteråŠ å…¥äº†é›†ç¾¤ï¼Œä½†æ˜¯è¯¥èŠ‚ç‚¹æ²¡æœ‰è¢«åˆ†é…æ§½ä½ã€‚</p>
<ol start="5">
<li>é‡æ–°åˆ†é…é›†ç¾¤çš„æ§½ä½</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli --cluster reshard 192.168.xxx.xxx:6381
</span></span></code></pre></td></tr></table>
</div>
</div><p>redisç»è¿‡æ§½ä½æ£€æŸ¥åï¼Œä¼šæç¤ºéœ€è¦åˆ†é…çš„æ§½ä½æ•°é‡ï¼š
ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨æ˜¯4å°masterï¼Œæˆ‘ä»¬æƒ³è¦ç»™node7åˆ†é…4096ä¸ªæ§½ä½ï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯4096ä¸ªæ§½ä½ã€‚
è¾“å…¥<code>4096</code>åï¼Œä¼šè®©è¾“å…¥è¦æ¥æ”¶è¿™äº›å“ˆå¸Œæ§½çš„èŠ‚ç‚¹IDï¼Œå¡«å…¥node7çš„èŠ‚ç‚¹IDå³å¯ã€‚ï¼ˆå°±æ˜¯èŠ‚ç‚¹ä¿¡æ¯ä¸­å¾ˆé•¿çš„ä¸€ä¸²åå…­è¿›åˆ¶ä¸²ï¼‰ã€‚
ç„¶åä¼šæç¤ºï¼Œè¯¢é—®è¦ä»å“ªäº›èŠ‚ç‚¹ä¸­æ‹¨å‡ºä¸€éƒ¨åˆ†æ§½ä½å‡‘è¶³4096ä¸ªåˆ†ç»™Node7ã€‚ä¸€èˆ¬é€‰æ‹© <code>all</code>ï¼Œå³å°†ä¹‹å‰çš„3ä¸ªä¸»èŠ‚ç‚¹çš„æ§½ä½éƒ½å‡ä¸€äº›ç»™Node7ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—æ¯ä¸ªèŠ‚ç‚¹çš„æ§½ä½æ•°ç›¸ç­‰å‡è¡¡ã€‚
è¾“å…¥<code>all</code>ä¹‹åï¼Œredisä¼šåˆ—å‡ºä¸€ä¸ªè®¡åˆ’ï¼Œå†…å®¹æ˜¯è‡ªåŠ¨ä»å‰é¢çš„3å°masterä¸­æ‹¨å‡ºä¸€éƒ¨åˆ†æ§½ä½åˆ†ç»™Node7çš„æ§½ä½ï¼Œéœ€è¦ç¡®è®¤ä¸€ä¸‹åˆ†é…çš„è®¡åˆ’ã€‚
è¾“å…¥<code>yes</code>ç¡®è®¤åï¼Œredisä¾¿ä¼šè‡ªåŠ¨é‡æ–°æ´—ç‰Œï¼Œç»™Node7åˆ†é…æ§½ä½ã€‚</p>
<p>é‡æ–°åˆ†é…å®Œæˆåï¼Œå¯ä»¥è¿›è¡Œé›†ç¾¤ä¿¡æ¯æ£€æŸ¥ï¼ŒæŸ¥çœ‹åˆ†é…ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli --cluster check 192.168.xxx.xxx:6381
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥å‘ç°é‡æ–°æ´—ç‰Œåçš„æ§½ä½åˆ†é…ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">èŠ‚ç‚¹1ï¼š[1365-5460]ï¼ˆä¾›4096ä¸ªæ§½ä½ï¼‰ï¼Œï¼Œï¼Œåˆ†é…å‰ä¸º[0-5460]ï¼ˆå…±5461ä¸ªæ§½ä½ï¼‰
</span></span><span class="line"><span class="cl">èŠ‚ç‚¹2ï¼š[6827-10922]ï¼ˆå…±4096ä¸ªæ§½ä½ï¼‰ï¼Œï¼Œï¼Œåˆ†é…å‰ä¸º[5461-10922]ï¼ˆå…±5461ä¸ªæ§½ä½ï¼‰
</span></span><span class="line"><span class="cl">èŠ‚ç‚¹3ï¼š[12288-16383]ï¼ˆå…±4096ä¸ªæ§½ä½ï¼‰ï¼Œï¼Œï¼Œåˆ†é…å‰ä¸º[10923-16383]ï¼ˆå…±5462ä¸ªæ§½ä½ï¼‰
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">èŠ‚ç‚¹7ï¼š[0-1364],[5461-6826],[10923-12287]ï¼ˆå…±4096ä¸ªæ§½ä½ï¼‰ï¼Œä»æ¯ä¸ªèŠ‚ç‚¹ä¸­åŒ€å‡ºæ¥äº†ä¸€éƒ¨åˆ†ç»™äº†èŠ‚ç‚¹7
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºå¯èƒ½æœ‰äº›æ§½ä½ä¸­å·²ç»å­˜å‚¨äº†<code>key</code>ï¼Œå®Œå…¨çš„é‡æ–°æ´—ç‰Œé‡æ–°åˆ†é…çš„æˆæœ¬è¿‡é«˜ï¼Œæ‰€ä»¥redisé€‰æ‹©ä»å‰3ä¸ªèŠ‚ç‚¹ä¸­åŒ€å‡ºæ¥ä¸€éƒ¨åˆ†ç»™èŠ‚ç‚¹7</p>
<p>ä¸ºä¸»èŠ‚ç‚¹6387åˆ†é…ä»èŠ‚ç‚¹6388ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli --cluster add-node 192.168.xxx.xxx:6388 192.168.xxx.xxx:6381 --cluster-slave --cluster-master-id node7èŠ‚ç‚¹çš„åå…­è¿›åˆ¶ç¼–å·å­—ç¬¦ä¸²
</span></span></code></pre></td></tr></table>
</div>
</div><p>redisä¾¿ä¼šå‘6388å‘é€æ¶ˆæ¯ï¼Œä½¿å…¶åŠ å…¥é›†ç¾¤å¹¶æˆä¸º6387çš„ä»èŠ‚ç‚¹ã€‚</p>
<p>æ£€æŸ¥é›†ç¾¤å½“å‰çŠ¶æ€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli --cluster check 192.168.xxx.xxx:6381
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¸»ä»ç¼©å®¹">ä¸»ä»ç¼©å®¹
</h3><p>å‡å¦‚ä¸šåŠ¡é«˜å³°æœŸè¿‡å»ï¼Œéœ€è¦å°†4ä¸»4ä»é‡æ–°ç¼©å®¹åˆ°3ä¸»3ä»ã€‚å³ä»é›†ç¾¤ä¸­ç§»é™¤node8å’Œnode7.</p>
<p>é¦–å…ˆåˆ é™¤ä»èŠ‚ç‚¹6388ï¼š</p>
<ol>
<li>è¿›å…¥å®¹å™¨èŠ‚ç‚¹1</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it redis-node-1 /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>æ£€æŸ¥å®¹å™¨çŠ¶æ€ï¼Œè·å–6388çš„èŠ‚ç‚¹ç¼–å·</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli --cluster check 192.168.xxx.xxx:6381
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>å°†6388ä»é›†ç¾¤ä¸­ç§»é™¤</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli --cluster del-node 192.168.xxx.xxx:6388 6388èŠ‚ç‚¹ç¼–å·
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹node7é‡æ–°åˆ†é…å“ˆå¸Œæ§½ï¼š</p>
<ol>
<li>å¯¹é›†ç¾¤é‡æ–°åˆ†é…å“ˆå¸Œæ§½</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli --cluster reshard 192.168.xxx.xxx:6381
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>redisç»è¿‡æ§½ä½æ£€æŸ¥åï¼Œä¼šæç¤ºéœ€è¦åˆ†é…çš„æ§½ä½æ•°é‡ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">How many slots do you want to move (from 1 to 16384)?
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬æƒ³ç›´æ¥æŠŠnode7çš„4096ä¸ªå“ˆå¸Œæ§½å…¨éƒ¨åˆ†ç»™æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥4096ã€‚
è¾“å…¥<code>4096</code>åï¼Œä¼šè®©è¾“å…¥è¦æ¥æ”¶è¿™äº›å“ˆå¸Œæ§½çš„èŠ‚ç‚¹IDã€‚å‡å¦‚æˆ‘ä»¬æƒ³æŠŠè¿™4096ä¸ªæ§½éƒ½åˆ†ç»™Node1ï¼Œç›´æ¥è¾“å…¥node1èŠ‚ç‚¹çš„ç¼–å·å³å¯ã€‚
ç„¶åä¼šæç¤ºï¼Œè¯¢é—®è¦ä»å“ªäº›èŠ‚ç‚¹ä¸­æ‹¨å‡ºä¸€éƒ¨åˆ†æ§½ä½å‡‘è¶³4096ä¸ªåˆ†ç»™Node1ã€‚è¿™é‡Œæˆ‘ä»¬è¾“å…¥node7çš„èŠ‚ç‚¹ç¼–å·ï¼Œå›è½¦åè¾“å…¥<code>done</code>ã€‚</p>
<p>node7ä¸Šé¢æ²¡æœ‰äº†å“ˆå¸Œæ§½ï¼Œæ­¤æ—¶ä¾¿å¯ä»¥å°†node7ä»é›†ç¾¤ä¸­ç§»é™¤ã€‚ï¼ˆå¦‚æœnode7ä¸Šé¢æœ‰å“ˆå¸Œæ§½ï¼Œç›´æ¥ä»é›†ç¾¤ä¸­ç§»é™¤ä¼šæŠ¥é”™ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">redis-cli --cluster del-node 192.168.xxx.xxx:6387 node7èŠ‚ç‚¹ç¼–å·
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="11-dockerfile"><strong>11-Dockerfile</strong>
</h1><h2 id="dockerfile">Dockerfile
</h2><p>Dockerfileæ˜¯ç”¨æ¥æ„å»ºDockeré•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ˜¯ç”±ä¸€æ¡æ¡æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ã€‚</p>
<p>æ„å»ºæ­¥éª¤ï¼š</p>
<ol>
<li>ç¼–å†™Dockerfileæ–‡ä»¶</li>
<li><code>docker build</code>å‘½ä»¤æ„å»ºé•œåƒ</li>
<li><code>docker run</code>ä¾æ®é•œåƒè¿è¡Œå®¹å™¨å®ä¾‹</li>
</ol>
<h2 id="æ„å»ºè¿‡ç¨‹">æ„å»ºè¿‡ç¨‹
</h2><p>Dockerfileç¼–å†™ï¼š</p>
<ul>
<li>
<p>æ¯æ¡ä¿ç•™å­—æŒ‡ä»¤éƒ½å¿…é¡»ä¸ºå¤§å†™å­—æ¯ï¼Œä¸”åé¢è¦è·Ÿéšè‡³å°‘ä¸€ä¸ªå‚æ•°</p>
</li>
<li>
<p>æŒ‡ä»¤æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œ</p>
</li>
<li>
<p><code>#</code>è¡¨ç¤ºæ³¨é‡Š</p>
</li>
<li>
<p>æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚å¹¶å¯¹é•œåƒè¿›è¡Œæäº¤</p>
</li>
</ul>
<p>Dockerå¼•æ“æ‰§è¡ŒDockerçš„å¤§è‡´æµç¨‹ï¼š</p>
<ol>
<li>dockerä»åŸºç¡€é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨</li>
<li>æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å¹¶å¯¹å®¹å™¨åšå‡ºä¿®æ”¹</li>
<li>æ‰§è¡Œç±»ä¼¼<code>docker commit</code>çš„æ“ä½œæäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚</li>
<li>dockerå†åŸºäºåˆšæäº¤çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°å®¹å™¨</li>
<li>æ‰§è¡ŒDockerfileä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œç›´åˆ°æ‰€æœ‰æŒ‡ä»¤éƒ½æ‰§è¡Œå®Œæˆ</li>
</ol>
<h2 id="dockerfileä¿ç•™å­—">Dockerfileä¿ç•™å­—
</h2><h3 id="from">FROM
</h3><p>åŸºç¡€é•œåƒï¼Œå½“å‰æ–°é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„ï¼ŒæŒ‡å®šä¸€ä¸ªå·²ç»å­˜åœ¨çš„é•œåƒä½œä¸ºæ¨¡æ¿ã€‚Dockerfileç¬¬ä¸€æ¡å¿…é¡»æ˜¯<code>FROM</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># FROM é•œåƒå</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> hub.c.163.com/library/tomcat</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="maintainer">MAINTAINER
</h3><p>é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># éå¿…é¡»</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">MAINTAINER</span><span class="s"> ZhangSan zs@163.com</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="run">RUN
</h3><p>å®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤ã€‚</p>
<p>æœ‰ä¸¤ç§æ ¼å¼ï¼š</p>
<ul>
<li>shellæ ¼å¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># ç­‰åŒäºåœ¨ç»ˆç«¯æ“ä½œçš„shellå‘½ä»¤</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æ ¼å¼ï¼šRUN &lt;å‘½ä»¤è¡Œå‘½ä»¤&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install vim<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>execæ ¼å¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># æ ¼å¼ï¼šRUN [&#34;å¯æ‰§è¡Œæ–‡ä»¶&#34; , &#34;å‚æ•°1&#34;, &#34;å‚æ•°2&#34;]</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="o">[</span><span class="s2">&#34;./test.php&#34;</span>, <span class="s2">&#34;dev&#34;</span>, <span class="s2">&#34;offline&#34;</span><span class="o">]</span>  <span class="c1"># ç­‰ä»·äº RUN ./test.php dev offline</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>RUN</code>æ˜¯åœ¨<code>docker build</code>æ—¶è¿è¡Œ</p>
<h3 id="expose">EXPOSE
</h3><p>å½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># EXPOSE è¦æš´éœ²çš„ç«¯å£</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># EXPOSE &lt;port&gt;[/&lt;protocol] ....</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 3306 33060</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="workdir">WORKDIR
</h3><p>æŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œ ç»ˆç«¯é»˜è®¤ç™»å½•è¿›æ¥çš„å·¥ä½œç›®å½•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">ENV</span> CATALINA_HOME /usr/local/tomcat<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> $CATALINA_HOME</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="user">USER
</h3><p>æŒ‡å®šè¯¥é•œåƒä»¥ä»€ä¹ˆæ ·çš„ç”¨æˆ·å»æ‰§è¡Œï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤æ˜¯<code>root</code>ã€‚ï¼ˆä¸€èˆ¬ä¸ä¿®æ”¹è¯¥é…ç½®ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># USER &lt;user&gt;[:&lt;group&gt;]</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">USER</span><span class="s"> patrick</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="env">ENV
</h3><p>ç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p>
<p>è¿™ä¸ªç¯å¢ƒå˜é‡å¯ä»¥åœ¨åç»­çš„ä»»ä½•<code>RUN</code>æŒ‡ä»¤æˆ–å…¶ä»–æŒ‡ä»¤ä¸­ä½¿ç”¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># æ ¼å¼ ENV ç¯å¢ƒå˜é‡å ç¯å¢ƒå˜é‡å€¼</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æˆ–è€… ENV ç¯å¢ƒå˜é‡å=å€¼</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> MY_PATH /usr/mytest<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ä½¿ç”¨ç¯å¢ƒå˜é‡</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> $MY_PATH</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="volume">VOLUME
</h3><p>å®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œã€‚ç±»ä¼¼äº <code>docker run</code> çš„<code>-v</code>å‚æ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># VOLUME æŒ‚è½½ç‚¹</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æŒ‚è½½ç‚¹å¯ä»¥æ˜¯ä¸€ä¸ªè·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°ç»„ï¼ˆæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹å¿…é¡»ç”¨åŒå¼•å·ï¼‰</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">VOLUME</span><span class="s"> /var/lib/mysql</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="add">ADD
</h3><p>å°†å®¿ä¸»æœºç›®å½•ä¸‹ï¼ˆæˆ–è¿œç¨‹æ–‡ä»¶ï¼‰çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒï¼Œä¸”ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹tarå‹ç¼©åŒ…ã€‚</p>
<h3 id="copy">COPY
</h3><p>ç±»ä¼¼<code>ADD</code>ï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­ã€‚</p>
<p>å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­<code>&lt;æºè·¯å¾„&gt;</code>çš„æ–‡ä»¶ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚é•œåƒå†…çš„<code>&lt;ç›®æ ‡è·¯å¾„&gt;</code>ä½ç½®ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">COPY</span> src dest<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> <span class="o">[</span><span class="s2">&#34;src&#34;</span>, <span class="s2">&#34;dest&#34;</span><span class="o">]</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># &lt;srcæºè·¯å¾„&gt;ï¼šæºæ–‡ä»¶æˆ–è€…æºç›®å½•</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># &lt;destç›®æ ‡è·¯å¾„&gt;ï¼šå®¹å™¨å†…çš„æŒ‡å®šè·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸ç”¨äº‹å…ˆå»ºå¥½ã€‚å¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cmd">CMD
</h3><p>æŒ‡å®šå®¹å™¨å¯åŠ¨åè¦å¹²çš„äº‹æƒ…ã€‚</p>
<p>æœ‰ä¸¤ç§æ ¼å¼ï¼š</p>
<ul>
<li>shellæ ¼å¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># CMD &lt;å‘½ä»¤&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="nb">echo</span> <span class="s2">&#34;hello world&#34;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>execæ ¼å¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># CMD [&#34;å¯æ‰§è¡Œæ–‡ä»¶&#34;, &#34;å‚æ•°1&#34;, &#34;å‚æ•°2&#34; ...]</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;catalina.sh&#34;</span><span class="p">,</span> <span class="s2">&#34;run&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å‚æ•°åˆ—è¡¨æ ¼å¼</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># CMD [&#34;å‚æ•°1&#34;, &#34;å‚æ•°2&#34; ....]ï¼Œä¸ENTRYPOINTæŒ‡ä»¤é…åˆä½¿ç”¨</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Dockerfileä¸­å¦‚æœå‡ºç°å¤šä¸ª<code>CMD</code>æŒ‡ä»¤ï¼Œåªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚<code>CMD</code>ä¼šè¢«<code>docker run</code>ä¹‹åçš„å‚æ•°æ›¿æ¢ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºtomcaté•œåƒï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¼šæœ‰ä¸åŒçš„æ•ˆæœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å› ä¸ºtomcatçš„Dockerfileä¸­æŒ‡å®šäº† CMD [&#34;catalina.sh&#34;, &#34;run&#34;]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰€ä»¥ç›´æ¥docker run æ—¶ï¼Œå®¹å™¨å¯åŠ¨åä¼šè‡ªåŠ¨æ‰§è¡Œ catalina.sh run</span>
</span></span><span class="line"><span class="cl">docker run -it -p 8080:8080 tomcat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŒ‡å®šå®¹å™¨å¯åŠ¨åæ‰§è¡Œ /bin/bash</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ­¤æ—¶æŒ‡å®šçš„/bin/bashä¼šè¦†ç›–æ‰Dockerfileä¸­æŒ‡å®šçš„ CMD [&#34;catalina.sh&#34;, &#34;run&#34;]</span>
</span></span><span class="line"><span class="cl">docker run -it -p 8080:8080 tomcat /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>CMD</code>æ˜¯åœ¨<code>docker run</code>æ—¶è¿è¡Œï¼Œè€Œ <code>RUN</code>æ˜¯åœ¨<code>docker build</code>æ—¶è¿è¡Œã€‚</p>
<h3 id="entrypoint">ENTRYPOINT
</h3><p>ç”¨æ¥æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ã€‚</p>
<p>ç±»ä¼¼äº<code>CMD</code>å‘½ä»¤ï¼Œä½†æ˜¯<code>ENTRYPOINT</code>ä¸ä¼šè¢«<code>docker run</code>åé¢çš„å‘½ä»¤è¦†ç›–ï¼Œè¿™äº›å‘½ä»¤å‚æ•°ä¼šè¢«å½“åšå‚æ•°é€ç»™<code>ENTRYPOINT</code>æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºã€‚</p>
<p><code>ENTRYPOINT</code>å¯ä»¥å’Œ<code>CMD</code>ä¸€èµ·ç”¨ï¼Œä¸€èˆ¬æ˜¯å¯å˜å‚æ•°æ‰ä¼šä½¿ç”¨<code>CMD</code>ï¼Œè¿™é‡Œçš„<code>CMD</code>ç­‰äºæ˜¯åœ¨ç»™<code>ENTRYPOINT</code>ä¼ å‚ã€‚</p>
<p>å½“æŒ‡å®šäº†<code>ENTRYPOINT</code>åï¼Œ<code>CMD</code>çš„å«ä¹‰å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸å†æ˜¯ç›´æ¥è¿è¡ŒæœŸå‘½ä»¤ï¼Œè€Œæ˜¯å°†<code>CMD</code>çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>ENTRYPOINT</code>æŒ‡ä»¤ï¼Œå®ƒä»¬ä¸¤ä¸ªç»„åˆä¼šå˜æˆ <code>&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> nginx</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-c&#34;</span><span class="p">]</span>  <span class="c1"># å®šå‚</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;/etc/nginx/nginx.conf&#34;</span><span class="p">]</span> <span class="c1"># å˜å‚</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºæ­¤Dockerfileï¼Œæ„å»ºæˆé•œåƒ <code>nginx:test</code>åï¼Œå¦‚æœæ‰§è¡Œï¼›</p>
<ul>
<li>
<p><code>docker run nginx test</code>ï¼Œåˆ™å®¹å™¨å¯åŠ¨åï¼Œä¼šæ‰§è¡Œ <code>nginx -c /etc/nginx/nginx.conf</code></p>
</li>
<li>
<p><code>docker run nginx:test /app/nginx/new.conf</code>ï¼Œåˆ™å®¹å™¨å¯åŠ¨åï¼Œä¼šæ‰§è¡Œ <code>nginx -c /app/nginx/new.conf</code></p>
</li>
</ul>
<h2 id="æ„å»ºé•œåƒ">æ„å»ºé•œåƒ
</h2><p>åˆ›å»ºåç§°ä¸º<code>Dockerfile</code>çš„æ–‡ä»¶ï¼Œç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> ubuntu</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">MAINTAINER</span><span class="s"> lee&lt;lee@xxx.com&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> MYPATH /usr/local<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> $MYPATH</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get install net-tools<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="nb">echo</span> <span class="nv">$MYPATH</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="nb">echo</span> <span class="s2">&#34;install ifconfig cmd into ubuntu success .....&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /bin/bash<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–å†™å®Œæˆä¹‹åï¼Œå°†å…¶æ„å»ºæˆdockeré•œåƒã€‚</p>
<p>å‘½ä»¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ³¨æ„ï¼šå®šä¹‰çš„TAGåé¢æœ‰ä¸ªç©ºæ ¼ï¼Œç©ºæ ¼åé¢æœ‰ä¸ªç‚¹</span>
</span></span><span class="line"><span class="cl"><span class="c1"># docker build -t æ–°é•œåƒåå­—:TAG .</span>
</span></span><span class="line"><span class="cl">docker build -t ubuntu:1.0.1 .
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è™šæ‚¬é•œåƒ">è™šæ‚¬é•œåƒ
</h2><p>è™šæ‚¬é•œåƒï¼šä»“åº“åã€æ ‡ç­¾åéƒ½æ˜¯ <code>&lt;none&gt;</code>çš„é•œåƒï¼Œç§°ä¸º dangling imagesï¼ˆè™šæ‚¬é•œåƒï¼‰ã€‚</p>
<p>åœ¨æ„å»ºæˆ–è€…åˆ é™¤é•œåƒæ—¶å¯èƒ½ç”±äºä¸€äº›é”™è¯¯å¯¼è‡´å‡ºç°è™šæ‚¬é•œåƒã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ„å»ºæ—¶å€™æ²¡æœ‰é•œåƒåã€tag</span>
</span></span><span class="line"><span class="cl">docker build .
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ—å‡ºdockerä¸­çš„è™šæ‚¬é•œåƒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker image ls -f <span class="nv">dangling</span><span class="o">=</span><span class="nb">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è™šæ‚¬é•œåƒä¸€èˆ¬æ˜¯å› ä¸ºä¸€äº›é”™è¯¯è€Œå‡ºç°çš„ï¼Œæ²¡æœ‰å­˜åœ¨ä»·å€¼ï¼Œå¯ä»¥åˆ é™¤ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># åˆ é™¤æ‰€æœ‰çš„è™šæ‚¬é•œåƒ</span>
</span></span><span class="line"><span class="cl">docker image prune
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="12-dockerå‘å¸ƒå¾®æœåŠ¡"><strong>12-Dockerå‘å¸ƒå¾®æœåŠ¡</strong>
</h1><h2 id="æ­å»ºspringbooté¡¹ç›®">æ­å»ºSpringBooté¡¹ç›®
</h2><p>æ­å»ºä¸€ä¸ªç®€å•çš„SpringBooté¡¹ç›®ï¼š</p>
<ol>
<li>åˆ›å»ºmavenå·¥ç¨‹ï¼Œpomä¸ºï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>2.5.6<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/parent&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.study<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>test-docker<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;packaging&gt;</span>pom<span class="nt">&lt;/packaging&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;modules&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;module&gt;</span>docker_boot<span class="nt">&lt;/module&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/modules&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;properties&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;maven.compiler.source&gt;</span>8<span class="nt">&lt;/maven.compiler.source&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;maven.compiler.target&gt;</span>8<span class="nt">&lt;/maven.compiler.target&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/properties&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>æ–°å»ºModuleï¼Œpomä¸ºï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>test-docker<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.study<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/parent&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>docker_boot<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;properties&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;maven.compiler.source&gt;</span>8<span class="nt">&lt;/maven.compiler.source&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;maven.compiler.target&gt;</span>8<span class="nt">&lt;/maven.compiler.target&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/properties&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;build&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;plugins&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/plugin&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/plugins&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/build&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>ç¼–å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">6001</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>ç¼–å†™ä¸»å¯åŠ¨ç±»</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.study</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author tengyer 2022/05/06 16:34
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DockerBootApplication</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">DockerBootApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>ç¼–å†™ä¸€ä¸ªController</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.study.controller</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author tengyer 2022/05/06 16:35
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&#34;${server.port}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">port</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/order/docker&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">helloDocker</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;hello world \t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;/order/index&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">index</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;æœåŠ¡ç«¯å£å·ï¼š&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\t&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨Ideaä¸­è¿è¡Œæ²¡æœ‰é—®é¢˜æ—¶ï¼Œå°†å…¶ä½¿ç”¨mavençš„<code>package</code>æ‰“æˆjaråŒ…ã€‚</p>
<h2 id="å‘å¸ƒå¾®æœåŠ¡é¡¹ç›®åˆ°dockerå®¹å™¨">å‘å¸ƒå¾®æœåŠ¡é¡¹ç›®åˆ°Dockerå®¹å™¨
</h2><ol>
<li>
<p>å°†é¡¹ç›®jaråŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
</li>
<li>
<p>ç¼–å†™Dockerfile</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> openjdk:8-oracle</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">MAINTAINER</span><span class="s"> lee</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># åœ¨ä¸»æœº /var/lib/dockerç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶é“¾æ¥åˆ°å®¹å™¨çš„ /tmp</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">VOLUME</span><span class="s"> /tmp</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Œå¹¶å‘½åä¸º springboot_docker.jar</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ADD</span> docker_boot-1.0-SNAPSHOT.jar /springboot_docker.jar<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># è¿è¡ŒjaråŒ…</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> bash -c <span class="s1">&#39;touch /springboot_docker.jar&#39;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;java&#34;</span><span class="p">,</span> <span class="s2">&#34;-jar&#34;</span><span class="p">,</span> <span class="s2">&#34;/springboot_docker.jar&#34;</span><span class="p">]</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># SpringBooté¡¹ç›®é…ç½®çš„ç«¯å£å·ä¸º6001ï¼Œéœ€è¦å°†6001æš´éœ²å‡ºå»</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 6001</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>æ„å»ºé•œåƒ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker build -t springboot_docker:1.0 .
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>å¯åŠ¨å®¹å™¨ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d -p 6001:6001 --name springboot springboot_docker:1.0
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="13-dockerç½‘ç»œ"><strong>13-Dockerç½‘ç»œ</strong>
</h1><h2 id="docker-ç½‘ç»œ">Docker ç½‘ç»œ
</h2><p>dockerå®‰è£…å¹¶å¯åŠ¨æœåŠ¡åï¼Œä¼šåœ¨å®¿ä¸»æœºä¸­æ·»åŠ ä¸€ä¸ªè™šæ‹Ÿç½‘å¡ã€‚</p>
<p>åœ¨DockeræœåŠ¡å¯åŠ¨å‰ï¼Œä½¿ç”¨ <code>ifconfig</code> æˆ– <code>ip addr</code> æŸ¥çœ‹ç½‘å¡ä¿¡æ¯ï¼š</p>
<ul>
<li>
<p><code>ens33</code>æˆ–<code>eth0</code>ï¼šæœ¬æœºç½‘å¡</p>
</li>
<li>
<p><code>lo</code>ï¼šæœ¬æœºå›ç¯ç½‘ç»œç½‘å¡</p>
</li>
<li>
<p>å¯èƒ½æœ‰<code>virbr0</code>ï¼ˆCentOSå®‰è£…æ—¶å¦‚æœé€‰æ‹©çš„æœ‰ç›¸å…³è™šæ‹ŸåŒ–æœåŠ¡ï¼Œå°±ä¼šå¤šä¸€ä¸ªä»¥ç½‘æ¡¥è¿æ¥çš„ç§ç½‘åœ°å€çš„<code>virbr0</code>ç½‘å¡ï¼Œä½œç”¨æ˜¯ä¸ºè¿æ¥è™šæ‹Ÿç½‘å¡æä¾›NATè®¿é—®å¤–ç½‘çš„åŠŸèƒ½ã€‚å¦‚æœè¦ç§»é™¤è¯¥æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ <code>yum remove libvirt-libs.x86_64</code>ï¼‰</p>
</li>
</ul>
<p>ä½¿ç”¨ <code>systemctl start docker</code>å¯åŠ¨DockeræœåŠ¡åï¼Œä¼šå¤šå‡ºä¸€ä¸ª <code>docker0</code> ç½‘å¡ã€‚</p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>
<p>å®¹å™¨é—´çš„äº’è”å’Œé€šä¿¡ä»¥åŠç«¯å£æ˜ å°„</p>
</li>
<li>
<p>å®¹å™¨IPå˜åŠ¨æ—¶å€™å¯ä»¥é€šè¿‡æœåŠ¡åç›´æ¥ç½‘ç»œé€šä¿¡è€Œä¸å—åˆ°å½±å“</p>
</li>
</ul>
<p>Dockerå®¹å™¨çš„ç½‘ç»œéš”ç¦»ï¼Œæ˜¯é€šè¿‡Linuxå†…æ ¸ç‰¹æ€§ <code>namespace</code>å’Œ <code>cgroup</code> å®ç°çš„ã€‚</p>
<h2 id="dockerç½‘ç»œå‘½ä»¤">dockerç½‘ç»œå‘½ä»¤
</h2><p>æŸ¥çœ‹Dockerç½‘ç»œæ¨¡å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker network ls
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæ²¡æœ‰ä¿®æ”¹è¿‡docker networkï¼Œåˆ™é»˜è®¤æœ‰3ä¸ªç½‘ç»œæ¨¡å¼ï¼š</p>
<ul>
<li>
<p><code>bridge</code></p>
</li>
<li>
<p><code>host</code></p>
</li>
<li>
<p><code>none</code></p>
</li>
</ul>
<p>æ·»åŠ Dockerç½‘ç»œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker network add xxx
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ é™¤Dockerç½‘ç»œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker network rm xxx
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹ç½‘ç»œå…ƒæ•°æ®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker network inspect xxx
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ é™¤æ‰€æœ‰æ— æ•ˆçš„ç½‘ç»œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker network prune
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="docker-ç½‘ç»œæ¨¡å¼">Docker ç½‘ç»œæ¨¡å¼
</h2><p>Docker çš„ç½‘ç»œæ¨¡å¼ï¼š</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>ç½‘ç»œæ¨¡å¼</th>
<th>ç®€ä»‹</th>
<th>ä½¿ç”¨æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>bridge</td>
<td>ä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é…ã€è®¾ç½®IPç­‰ï¼Œå¹¶å°†å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ª<code>docker0</code>è™šæ‹Ÿç½‘æ¡¥ï¼Œé»˜è®¤ä¸ºè¯¥æ¨¡å¼</td>
<td><code>--network bridge</code></td>
</tr>
<tr>
<td>host</td>
<td>å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ã€é…ç½®è‡ªå·±çš„IPç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£</td>
<td><code>--network host</code></td>
</tr>
<tr>
<td>none</td>
<td>å®¹å™¨æœ‰ç‹¬ç«‹çš„ Network namespaceï¼Œä½†å¹¶æ²¡æœ‰å¯¹é½è¿›è¡Œä»»ä½•ç½‘ç»œè®¾ç½®ï¼Œå¦‚åˆ†é… <code>veth pari</code> å’Œ ç½‘æ¡¥è¿æ¥ã€IPç­‰</td>
<td><code>--network none</code></td>
</tr>
<tr>
<td>container</td>
<td>æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡å’Œé…ç½®è‡ªå·±çš„IPï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº«IPã€ç«¯å£èŒƒå›´ç­‰</td>
<td><code>--network container:NAMEæˆ–è€…å®¹å™¨ID</code></td>
</tr>
</tbody>
</table></div>
<p>æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„ç½‘ç»œæ¨¡å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># é€šè¿‡inspectè·å–å®¹å™¨ä¿¡æ¯ï¼Œæœ€å20è¡Œå³ä¸ºå®¹å™¨çš„ç½‘ç»œæ¨¡å¼ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">docker inspect å®¹å™¨ID <span class="p">|</span> tail -n <span class="m">20</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="docker0">docker0
</h2><p>Docker æœåŠ¡é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª<code>docker0</code>ç½‘æ¡¥ï¼ˆå…¶ä¸Šæœ‰ä¸€ä¸ª<code>docker0</code>å†…éƒ¨æ¥å£ï¼‰ï¼Œè¯¥æ¡¥æ¥ç½‘ç»œçš„åç§°ä¸º <code>docker0</code>ï¼Œå®ƒåœ¨å†…æ ¸å±‚è¿é€šäº†å…¶ä»–çš„ç‰©ç†æˆ–è™šæ‹Ÿç½‘å¡ï¼Œè¿™å°±å°†æ‰€æœ‰å®¹å™¨å’Œæœ¬åœ°ä¸»æœºéƒ½æ”¾åˆ°åŒä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚</p>
<p>Dockeré»˜è®¤æŒ‡å®šäº†<code>docker0</code>æ¥å£çš„IPåœ°å€å’Œå­ç½‘æ©ç ï¼Œè®©ä¸»æœºå’Œå®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ç½‘æ¡¥äº’ç›¸é€šä¿¡ã€‚</p>
<p>æŸ¥çœ‹<code>bridge</code>ç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶é€šè¿‡<code>grep</code>è·å–åç§°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker network inspect bridge <span class="p">|</span> grep name
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹åˆ°å…¶åç§°ä¸º<code>docker0</code>ã€‚</p>
<h2 id="bridgeæ¨¡å¼">bridgeæ¨¡å¼
</h2><p>Dockerä½¿ç”¨Linuxæ¡¥æ¥ï¼Œåœ¨å®¿ä¸»æœºè™šæ‹Ÿä¸€ä¸ª<code>Docker</code>å®¹å™¨ç½‘æ¡¥ï¼ˆ<code>docker0</code>ï¼‰ï¼ŒDockerå¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ä¼šæ ¹æ®<code>Docker</code>ç½‘æ¡¥çš„ç½‘æ®µåˆ†é…ç»™å®¹å™¨ä¸€ä¸ªIPåœ°å€ï¼Œç§°ä¸º<code>Container-IP</code>ï¼ŒåŒæ—¶Dockerç½‘æ¡¥æ˜¯æ¯ä¸ªå®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚å› ä¸ºåœ¨åŒä¸€ä¸ªå®¿ä¸»æœºå†…çš„å®¹å™¨æ¥å…¥åŒä¸€ä¸ªç½‘æ¡¥ï¼Œè¿™æ ·å®¹å™¨ä¹‹é—´å°±èƒ½å¤Ÿé€šè¿‡å®¹å™¨çš„<code>Container-IP</code>ç›´æ¥é€šä¿¡ã€‚</p>
<p><code>docker run</code>çš„æ—¶å€™ï¼Œæ²¡æœ‰æŒ‡å®š<code>--network</code>çš„è¯ï¼Œé»˜è®¤ä½¿ç”¨çš„ç½‘æ¡¥æ¨¡å¼å°±æ˜¯<code>bridge</code>ï¼Œä½¿ç”¨çš„å°±æ˜¯<code>docker0</code>ã€‚åœ¨å®¿ä¸»æœº<code>ifconfig</code>å°±è‹¦å½¹çœ‹åˆ°<code>docker0</code>å’Œè‡ªå·±<code>create</code>çš„<code>network</code>ã€‚</p>
<p>ç½‘æ¡¥<code>docker0</code>åˆ›å»ºä¸€å¯¹å¯¹ç­‰è™šæ‹Ÿè®¾å¤‡æ¥å£ï¼Œä¸€ä¸ªå«<code>veth</code>ï¼Œå¦ä¸€ä¸ªå«<code>eth0</code>ï¼Œæˆå¯¹åŒ¹é…ï¼š</p>
<p>æ•´ä¸ªå®¿ä¸»æœºçš„ç½‘æ¡¥æ¨¡å¼éƒ½æ˜¯<code>docker0</code>ï¼Œç±»ä¼¼ä¸€ä¸ªäº¤æ¢æœºæœ‰ä¸€å †æ¥å£ï¼Œæ¯ä¸ªæ¥å£å« <code>veth</code>ï¼Œåœ¨æœ¬åœ°ä¸»æœºå’Œå®¹å™¨å†…åˆ†åˆ«åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ¥å£ï¼Œå¹¶è®©ä»–ä»¬å½¼æ­¤è”é€šï¼ˆè¿™æ ·ä¸€å¯¹æ¥å£å«åš <code>veth pair</code>ï¼‰ã€‚</p>
<p>æ¯ä¸ªå®¹å™¨å®ä¾‹å†…éƒ¨ä¹Ÿæœ‰ä¸€å—ç½‘å¡ï¼Œå®¹å™¨å†…çš„ç½‘å¡æ¥å£å«åš<code>eth0</code>ã€‚</p>
<p><code>docker0</code>ä¸Šé¢çš„æ¯ä¸ª<code>veth</code>åŒ¹é…æŸä¸ªå®¹å™¨å®ä¾‹å†…éƒ¨çš„<code>eth0</code>ï¼Œä¸¤ä¸¤é…å¯¹ï¼Œä¸€ä¸€åŒ¹é…ã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/bridge.webp"
	width="1087"
	height="540"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/bridge_hu8736915611734597603.webp 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/bridge_hu7485193624844484849.webp 1024w"
	loading="lazy"
	
		alt="bridge"
	
	
		class="gallery-image" 
		data-flex-grow="201"
		data-flex-basis="483px"
	
></p>
<p>ä¾‹å¦‚ï¼š</p>
<p>å¯åŠ¨tomcatå®¹å™¨ï¼Œè¿›å…¥tomcatå®¹å™¨åï¼Œæ‰§è¡Œ <code>ip addr</code>ï¼Œå¯ä»¥çœ‹åˆ°å…¶ç½‘å¡ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">1: lo ..................
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å®¹å™¨å†…çš„ç½‘å¡ä¸º eth0
</span></span><span class="line"><span class="cl">@ç¬¦å·åé¢å°±æ˜¯å®¿ä¸»æœºä¸Šå¯¹åº”çš„vethç½‘å¡çš„ç¼–å·28
</span></span><span class="line"><span class="cl">27: eth0@if28 ...............................
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å®¿ä¸»æœºæ‰§è¡Œ <code>ip addr</code> æŸ¥çœ‹å®¿ä¸»æœºç½‘å¡ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">æ¯ä¸ªvethéƒ½æœ‰ä¸ªç¼–å·ï¼švethXXXXXX
</span></span><span class="line"><span class="cl">@ç¬¦å·åé¢å¯¹åº”å°±æ˜¯å®¹å™¨å†…çš„eth0ç½‘å¡ç¼–å·27
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">28: vethXXXXXX@if27  ................
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hostæ¨¡å¼">hostæ¨¡å¼
</h2><p>ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ IP åœ°å€ä¸å¤–ç•Œè¿›è¡Œé€šä¿¡ï¼Œä¸å†éœ€è¦é¢å¤–è¿›è¡Œ NAT è½¬æ¢ã€‚</p>
<p>å®¹å™¨å°†ä¸ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„ Network Namespaceï¼Œè€Œæ˜¯å’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ª Network spaceã€‚</p>
<p>å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/host.webp"
	width="1087"
	height="540"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/host_hu8030781564049851391.webp 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/host_hu10491428708074790883.webp 1024w"
	loading="lazy"
	
		alt="host"
	
	
		class="gallery-image" 
		data-flex-grow="201"
		data-flex-basis="483px"
	
></p>
<p>å¦‚æœåœ¨ <code>docker run</code> å‘½ä»¤ä¸­åŒæ—¶ä½¿ç”¨äº† <code>--network host</code> å’Œ <code>-p</code>ç«¯å£æ˜ å°„ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -p 8082:8080 --network host tomcat
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆä¼šå‡ºç°ä¸€ä¸ªè­¦å‘Šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">WARNING: Published ports are discarded when using host network mode
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºæ­¤æ—¶å·²ç»ä½¿ç”¨äº†<code>host</code>æ¨¡å¼ï¼Œæœ¬èº«å°±æ˜¯ç›´æ¥ä½¿ç”¨çš„å®¿ä¸»æœºçš„IPå’Œç«¯å£ï¼Œæ­¤æ—¶çš„<code>-p</code>ç«¯å£æ˜ å°„å°±æ²¡æœ‰äº†æ„ä¹‰ï¼Œä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œç«¯å£å·è¿˜æ˜¯ä¼šä»¥ä¸»æœºç«¯å£å·ä¸ºä¸»ã€‚</p>
<p>æ­£ç¡®åšæ³•æ˜¯ï¼šä¸å†è¿›è¡Œ<code>-p</code>ç«¯å£æ˜ å°„ï¼Œæˆ–è€…æ”¹ç”¨<code>bridge</code>æ¨¡å¼</p>
<h2 id="noneæ¨¡å¼">noneæ¨¡å¼
</h2><p>ç¦ç”¨ç½‘ç»œåŠŸèƒ½ã€‚</p>
<p>åœ¨<code>none</code>æ¨¡å¼ä¸‹ï¼Œå¹¶ä¸ä¸ºdockerå®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®ã€‚è¿›å…¥å®¹å™¨å†…ï¼Œä½¿ç”¨ <code>ip addr</code>æŸ¥çœ‹ç½‘å¡ä¿¡æ¯ï¼Œåªèƒ½çœ‹åˆ° <code>lo</code>ï¼ˆæœ¬åœ°å›ç¯ç½‘ç»œ<code>127.0.0.1</code>ç½‘å¡ï¼‰ã€‚</p>
<h2 id="containeræ¨¡å¼">containeræ¨¡å¼
</h2><p>æ–°å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ç½‘ç»œIPé…ç½®ï¼Œè€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«ã€‚</p>
<p>æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ã€IPï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº«IPã€ç«¯å£èŒƒå›´ã€‚ä¸¤ä¸ªå®¹å™¨é™¤äº†ç½‘ç»œå…±äº«ï¼Œå…¶ä»–çš„å¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ä¾ç„¶æ˜¯éš”ç¦»çš„ã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/container.webp"
	width="961"
	height="579"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/container_hu2014552806763730183.webp 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/container_hu13214479242447087862.webp 1024w"
	loading="lazy"
	
		alt="container"
	
	
		class="gallery-image" 
		data-flex-grow="165"
		data-flex-basis="398px"
	
></p>
<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -it --name alpine1 alpine /bin/sh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŒ‡å®šå’Œ alpine1 å®¹å™¨å…±äº«ç½‘ç»œ</span>
</span></span><span class="line"><span class="cl">docker run -it --network container:alpine1 --name alpine2 alpine /bin/sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶ä½¿ç”¨ <code>ip addr</code>æŸ¥çœ‹ä¸¤å°å®¹å™¨çš„ç½‘ç»œï¼Œä¼šå‘ç°ä¸¤å°å®¹å™¨çš„<code>eth0</code>ç½‘å¡å†…çš„IPç­‰ä¿¡æ¯å®Œå…¨ç›¸åŒã€‚</p>
<p>å¦‚æœå…³æ‰äº†<code>alpine1</code>å®¹å™¨ï¼Œå› ä¸º<code>alpine2</code>çš„ç½‘ç»œä½¿ç”¨çš„<code>alpine1</code>å…±äº«ç½‘ç»œï¼Œæ‰€ä»¥å…³æ‰<code>alpin1</code>åï¼Œ<code>alpine2</code>çš„<code>eth0</code>ç½‘å¡ä¹Ÿéšä¹‹æ¶ˆå¤±äº†ã€‚</p>
<h2 id="è‡ªå®šä¹‰ç½‘ç»œ">è‡ªå®šä¹‰ç½‘ç»œ
</h2><p>å®¹å™¨é—´çš„äº’è”å’Œé€šä¿¡ä»¥åŠç«¯å£æ˜ å°„ã€‚</p>
<p>å®¹å™¨ IP å˜åŠ¨æ—¶å€™å¯ä»¥é€šè¿‡æœåŠ¡åç›´æ¥ç½‘ç»œé€šä¿¡è€Œä¸å—å½±å“ã€‚ï¼ˆç±»ä¼¼Eurekaï¼Œé€šè¿‡æœåŠ¡åç›´æ¥äº’ç›¸é€šä¿¡ï¼Œè€Œä¸æ˜¯å†™æ­»IPåœ°å€ï¼‰ã€‚</p>
<p>dockerä¸­è¿˜æœ‰ä¸€ä¸ª <code>--link</code> è¿›è¡Œå®¹å™¨ç½‘ç»œäº’è”ï¼Œä½†æ˜¯å·²ç»è¢«æ ‡è®°ä¸ºè¿‡æ—¶çš„ï¼Œå¯èƒ½ä¼šåœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤è¿™ä¸ªåŠŸèƒ½ã€‚æ¨èä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œæ›¿æ¢linkã€‚</p>
<p>è‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œï¼ˆè‡ªå®šä¹‰ç½‘ç»œé»˜è®¤ä½¿ç”¨çš„æ˜¯æ¡¥æ¥ç½‘ç»œ <code>bridge</code>ï¼‰ï¼š</p>
<ol>
<li>æ–°å»ºè‡ªå®šä¹‰ç½‘ç»œ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker network create tomcat_network
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker network ls
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>åˆ›å»ºå®¹å™¨æ—¶ï¼ŒæŒ‡å®šåŠ å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„ç½‘ç»œä¸­</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run -d -p 8081:8080 --network tomcat_network --name tomcat1 tomcat:8.5-jdk8-corretto
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker run -d -p 8082:8080 --network tomcat_network --name tomcat2 tomcat:8.5-jdk8-corretto
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>æ­¤æ—¶è¿›å…¥<code>tomcat1</code>ä¸­ï¼Œä½¿ç”¨<code>ping</code>å‘½ä»¤æµ‹è¯•è¿æ¥<code>tomcat2</code>å®¹å™¨åï¼Œå‘ç°å¯ä»¥æ­£å¸¸è¿é€š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å®‰è£…ifconfigå‘½ä»¤</span>
</span></span><span class="line"><span class="cl">yum install -y net-tools
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…ip addrå‘½ä»¤</span>
</span></span><span class="line"><span class="cl">yum install -y iproute
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…pingå‘½ä»¤</span>
</span></span><span class="line"><span class="cl">yum install -y iputils
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç›´æ¥pingå®¹å™¨åï¼Œä¸éœ€è¦ping IPåœ°å€</span>
</span></span><span class="line"><span class="cl">ping tomcat2
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="linkè¿æ¥">linkè¿æ¥
</h2><p>ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨ä¸€å°mysqlå®¹å™¨</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --name ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåˆ«å</span>
</span></span><span class="line"><span class="cl">docker run --name mysql-matomo -p 3308:3306 -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>root -d mysql:8.0.28
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯åŠ¨å¦ä¸€ä¸ªå®¹å™¨ï¼Œé€šè¿‡--linkè¿æ¥åˆ°mysqlå®¹å™¨</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --link å®¹å™¨åç§°:æœ¬å®¹å™¨è¿æ¥å¯¹æ–¹æ—¶çš„åˆ«å</span>
</span></span><span class="line"><span class="cl">docker run -d -p 8888:80 --link mysql-matomo:db --name matomo matomo:4.9.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ­¤æ—¶ï¼Œåœ¨matomoå®¹å™¨ä¸­ï¼Œä¾¿å¯ä»¥é€šè¿‡ db è¿™ä¸ªhostnameè¿æ¥åˆ°mysql-matomoå®¹å™¨ï¼Œè€Œæ— é¡»å†é€šè¿‡ip</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è¿æ¥åœ°å€ï¼šdb:3306</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="14-docker-composeå®¹å™¨ç¼–æ’"><strong>14-Docker-composeå®¹å™¨ç¼–æ’</strong>
</h1><h2 id="docker-compose">Docker-compose
</h2><p><code>Docker-Compose</code> æ˜¯ Docker å®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œè´Ÿè´£å®ç°å¯¹Dockerå®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚</p>
<p><code>Docker-Compose</code>å¯ä»¥ç®¡ç†å¤šä¸ªDockerå®¹å™¨ç»„æˆä¸€ä¸ªåº”ç”¨ã€‚éœ€è¦å®šä¹‰ä¸€ä¸ªyamlæ ¼å¼çš„é…ç½®æ–‡ä»¶ <code>docker-compose.yml</code>ï¼Œé…ç½®å¥½å¤šä¸ªå®¹å™¨ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼Œç„¶ååªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±èƒ½åŒæ—¶å¯åŠ¨/å…³é—­è¿™äº›å®¹å™¨ã€‚</p>
<p>Dockerå»ºè®®æˆ‘ä»¬æ¯ä¸ªå®¹å™¨ä¸­åªè¿è¡Œä¸€ä¸ªæœåŠ¡ï¼Œå› ä¸ºDockerå®¹å™¨æœ¬èº«å ç”¨èµ„æºæå°‘ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯å°†æ¯ä¸ªæœåŠ¡å•ç‹¬çš„åˆ†å‰²å¼€æ¥ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦åŒæ—¶éƒ¨ç½²å¤šä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡å•ç‹¬æ„å»ºé•œåƒæ„å»ºå®¹å™¨å°±ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚æ‰€ä»¥ Docker å®˜æ–¹æ¨å‡ºäº† <code>docker-compose</code> å¤šæœåŠ¡éƒ¨ç½²çš„å·¥å…·ã€‚</p>
<p>Composeå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ <code>docker-compose.yml</code> æ¨¡æ¿æ–‡ä»¶æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆ<code>project</code>ï¼‰ã€‚å¯ä»¥å¾ˆå®¹æ˜“çš„ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰ä¸€ä¸ªå¤šå®¹å™¨çš„åº”ç”¨ï¼Œç„¶åä½¿ç”¨ä¸€æ¡æŒ‡ä»¤å®‰è£…è¿™ä¸ªåº”ç”¨çš„æ‰€æœ‰ä¾èµ–ï¼Œå®Œæˆæ„å»ºã€‚</p>
<p>æ ¸å¿ƒæ¦‚å¿µï¼š</p>
<ul>
<li>
<p>æœåŠ¡ï¼ˆ<code>service</code>ï¼‰ï¼šä¸€ä¸ªä¸ªåº”ç”¨å®¹å™¨å®ä¾‹</p>
</li>
<li>
<p>å·¥ç¨‹ï¼ˆ<code>project</code>ï¼‰ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨<code>docker-compose.yml</code>ä¸­å®šä¹‰</p>
</li>
</ul>
<p>Composeä½¿ç”¨çš„ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ç¼–å†™ Dockerfile å®šä¹‰å„ä¸ªåº”ç”¨å®¹å™¨ï¼Œå¹¶æ„å»ºå‡ºå¯¹åº”çš„é•œåƒæ–‡ä»¶</li>
<li>ç¼–å†™ <code>docker-compose.yml</code>ï¼Œå®šä¹‰ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡å•å…ƒï¼Œå®‰æ’å¥½æ•´ä½“åº”ç”¨ä¸­çš„å„ä¸ªå®¹å™¨æœåŠ¡</li>
<li>æ‰§è¡Œ <code>docker-compose up</code> å‘½ä»¤ï¼Œå…¶åˆ›å»ºå¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå®Œæˆä¸€é”®éƒ¨ç½²ä¸Šçº¿</li>
</ol>
<h2 id="å®‰è£…docker-compose">å®‰è£…Docker-Compose
</h2><p><code>Docker-Compose</code>çš„ç‰ˆæœ¬éœ€è¦å’ŒDockerå¼•æ“ç‰ˆæœ¬å¯¹åº”ï¼Œå¯ä»¥å‚ç…§å®˜ç½‘ä¸Šçš„<a class="link" href="https://docs.docker.com/compose/compose-file/compose-file-v3/"  target="_blank" rel="noopener"
    >å¯¹åº”å…³ç³»</a>ã€‚</p>
<p>å®‰è£…Composeï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># ä¾‹å¦‚ä»githubä¸‹è½½ 2.5.0ç‰ˆæœ¬çš„docker-compose</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶æ”¾åˆ° /usr/local/binç›®å½•ä¸‹ï¼Œå‘½åä¸º docker-compose</span>
</span></span><span class="line"><span class="cl">curl -L https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-<span class="k">$(</span>uname -s<span class="k">)</span>-<span class="k">$(</span>uname -m<span class="k">)</span> -o /usr/local/bin/docker-compose
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ·»åŠ æƒé™</span>
</span></span><span class="line"><span class="cl">chmod +x /usr/local/bin/docker-compose
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># éªŒè¯</span>
</span></span><span class="line"><span class="cl">docker-compose version
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¸è½½Composeï¼šç›´æ¥åˆ é™¤ <code>usr/local/bin/docker-compose</code>æ–‡ä»¶å³å¯</p>
<h2 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤
</h2><p>æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œéœ€è¦åœ¨å¯¹åº”çš„<code>docker-compose.yml</code>æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸‹æ‰§è¡Œã€‚</p>
<p>æŸ¥çœ‹å¸®åŠ©ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose -h
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ›å»ºå¹¶å¯åŠ¨<code>docker-compose</code>æœåŠ¡ï¼šï¼ˆç±»ä¼¼ <code>docker run</code>ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose up
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åå°è¿è¡Œ</span>
</span></span><span class="line"><span class="cl">docker-compose up -d
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œã€å·ã€é•œåƒï¼šï¼ˆç±»ä¼¼ <code>docker stop</code> +  <code>docker rm</code>ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose down
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose <span class="nb">exec</span> &lt;ymlé‡Œé¢çš„æœåŠ¡id&gt; /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>å±•ç¤ºå½“å‰<code>docker-compose</code>ç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose ps
</span></span></code></pre></td></tr></table>
</div>
</div><p>å±•ç¤ºå½“å‰<code>docker-compose</code>ç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose top
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹å®¹å™¨è¾“å‡ºæ—¥å¿—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose log &lt;ymlé‡Œé¢çš„æœåŠ¡id&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ£€æŸ¥é…ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose config
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æœ‰é—®é¢˜æ‰è¾“å‡º</span>
</span></span><span class="line"><span class="cl">docker-compose config -q
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‡å¯æœåŠ¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose restart
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯åŠ¨æœåŠ¡ï¼šï¼ˆç±»ä¼¼ <code>docker start</code>ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose start
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœæ­¢æœåŠ¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose stop
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="composeç¼–æ’å®ä¾‹">composeç¼–æ’å®ä¾‹
</h2><p>ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># docker-composeæ–‡ä»¶ç‰ˆæœ¬å·</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># é…ç½®å„ä¸ªå®¹å™¨æœåŠ¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">microService</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">springboot_docker:1.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">ms01 </span><span class="w"> </span><span class="c"># å®¹å™¨åç§°ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œä¼šç”Ÿæˆä¸€ä¸ªæœåŠ¡ååŠ ä¸Šå‰ç¼€çš„å®¹å™¨å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;6001:6001&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/app/microService:/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">springboot_network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">  </span><span class="c"># é…ç½®è¯¥å®¹å™¨æœåŠ¡æ‰€ä¾èµ–çš„å®¹å™¨æœåŠ¡</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">mysql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">redis:6.0.8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;6379:6379&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/app/redis/redis.conf:/etc/redis/redis.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/app/redis/data:data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">springboot_network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">redis-server /etc/redis/redis.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mysql</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mysql:5.7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;no&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;db_springboot&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;springboot&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;springboot&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3306:3306&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/app/mysql/db:/var/lib/mysql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/app/mysql/conf/my.cnf:/etc/my.cnf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/app/mysql/init:/docker-entrypoint-initdb.d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">springboot_network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span>--<span class="l">default-authentication-plugin=mysql_native_password</span><span class="w"> </span><span class="c"># è§£å†³å¤–éƒ¨æ— æ³•è®¿é—®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># åˆ›å»º springboot_network ç½‘æ¡¥ç½‘ç»œ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">springboot_network</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–å†™å®Œæˆ<code>docker-compose.yml</code>åï¼Œè¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># è¿›è¡Œè¯­æ³•æ£€æŸ¥</span>
</span></span><span class="line"><span class="cl">docker-compose config -q
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè¯­æ³•æ£€æŸ¥æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œè¿›è¡Œåˆ›å»ºã€å¯åŠ¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose up -d
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="15-portainerè½»é‡çº§å›¾å½¢åŒ–ç›‘æ§"><strong>15-Portainerè½»é‡çº§å›¾å½¢åŒ–ç›‘æ§</strong>
</h1><h2 id="portainerdockerè½»é‡çº§å¯è§†åŒ–å·¥å…·">Portainerï¼šDockerè½»é‡çº§å¯è§†åŒ–å·¥å…·
</h2><p>Portaineræ˜¯ä¸€æ¬¾è½»é‡çº§çš„åº”ç”¨ï¼Œå®ƒæä¾›äº†å›¾å½¢åŒ–ç•Œé¢ï¼Œç”¨äºæ–¹ä¾¿åœ°ç®¡ç†Dockerç¯å¢ƒï¼ŒåŒ…æ‹¬å•æœºç¯å¢ƒå’Œé›†ç¾¤ç¯å¢ƒã€‚</p>
<p>Portaineråˆ†ä¸ºå¼€æºç¤¾åŒºç‰ˆï¼ˆCEç‰ˆï¼‰å’Œå•†ç”¨ç‰ˆï¼ˆBEç‰ˆ/EEç‰ˆï¼‰ã€‚</p>
<h2 id="å®‰è£…">å®‰è£…
</h2><p>Portainerä¹Ÿæ˜¯ä¸€ä¸ªDockeré•œåƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Dockerè¿è¡Œã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ—§ç‰ˆé•œåƒåœ°å€ä¸ºportainer/portainerï¼Œä»2022å¹´1æœˆæ ‡è®°ä¸ºè¿‡æœŸ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ–°ç‰ˆé•œåƒåœ°å€ä¸ºportainer/portainer-ce</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --restart=always å¦‚æœDockerå¼•æ“é‡å¯äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨å®ä¾‹ä¹Ÿä¼šåœ¨Dockerå¼•æ“é‡å¯åé‡å¯ï¼Œç±»ä¼¼å¼€æœºè‡ªå¯</span>
</span></span><span class="line"><span class="cl">docker run -d -p 8000:8000 -p 9000:9000 --name portainer --restart<span class="o">=</span>always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce:2.13.0-alpine
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯åŠ¨ä¹‹åï¼Œä¾¿å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œè®¿é—®ï¼šhttp://xxx.xxx.xxx.xxx:9000</p>
<p>é¦–æ¬¡è¿›æ¥æ—¶ï¼Œéœ€è¦åˆ›å»º admin çš„ç”¨æˆ·åï¼ˆé»˜è®¤<code>admin</code>ï¼‰ã€å¯†ç ï¼ˆå¿…é¡»æ»¡è¶³æ ¡éªŒè§„åˆ™ï¼Œä¾‹å¦‚<code>portainer.io123</code>ï¼‰ã€‚</p>
<p>é€‰æ‹© <code>local</code>ç®¡ç†æœ¬åœ°dockerï¼Œå³å¯çœ‹åˆ°æœ¬åœ°Dockerçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„é•œåƒï¼ˆimagesï¼‰ã€å®¹å™¨ï¼ˆcontainersï¼‰ã€ç½‘ç»œï¼ˆnetworksï¼‰ã€å®¹å™¨å·ï¼ˆvolumesï¼‰ã€composeç¼–æ’ï¼ˆstacksï¼‰ç­‰ç­‰ã€‚</p>
<h1 id="16-cigé‡é‡çº§ç›‘æ§"><strong>16-CIGé‡é‡çº§ç›‘æ§</strong>
</h1><h2 id="cig">CIG
</h2><p>é€šè¿‡<code>docker stats</code> å‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥çœ‹å½“å‰å®¿ä¸»æœºä¸Šæ‰€æœ‰å®¹å™¨çš„CPUã€å†…å­˜ã€ç½‘ç»œæµé‡ç­‰æ•°æ®ï¼Œå¯ä»¥æ»¡è¶³ä¸€äº›å°å‹åº”ç”¨ã€‚</p>
<p>ä½†æ˜¯ <code>docker stats</code> ç»Ÿè®¡ç»“æœåªèƒ½æ˜¯å½“å‰å®¿ä¸»æœºçš„å…¨éƒ¨å®¹å™¨ï¼Œæ•°æ®èµ„æ–™æ˜¯å®æ—¶çš„ï¼Œæ²¡æœ‰åœ°æ–¹å­˜å‚¨ã€æ²¡æœ‰å¥åº·æŒ‡æ ‡è¿‡çº¿é¢„è­¦ç­‰åŠŸèƒ½ã€‚</p>
<p>CAdvisorï¼ˆç›‘æ§æ”¶é›†ï¼‰ + InfluxDBï¼ˆå­˜å‚¨æ•°æ®ï¼‰ + Granfanaï¼ˆå±•ç¤ºå›¾è¡¨ï¼‰ï¼Œåˆç§° <code>CIG</code>ã€‚</p>
<p><img src="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/CIG-1719926984502-43.png"
	width="916"
	height="601"
	srcset="/xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/CIG-1719926984502-43_hu18170342884047245813.png 480w, /xiaoshi/p/docker%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/assets/CIG-1719926984502-43_hu3349418829015073153.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="152"
		data-flex-basis="365px"
	
></p>
<h3 id="cadvisor">CAdvisor
</h3><p>CAdvisoræ˜¯ä¸€ä¸ªå®¹å™¨èµ„æºç›‘æ§å·¥å…·ï¼ŒåŒ…æ‹¬å®¹å™¨çš„å†…å­˜ã€CPUã€ç½‘ç»œIOã€ç£ç›˜IOç­‰ç›‘æ§ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªWebé¡µé¢ç”¨äºæŸ¥çœ‹å®¹å™¨çš„å®æ—¶è¿è¡ŒçŠ¶æ€ã€‚</p>
<p>CAdvisoré»˜è®¤å­˜å‚¨2åˆ†é’Ÿçš„æ•°æ®ï¼Œè€Œä¸”åªæ˜¯é’ˆå¯¹å•ç‰©ç†æœºã€‚ä¸è¿‡CAdvisoræä¾›äº†å¾ˆå¤šæ•°æ®é›†æˆæ¥å£ï¼Œæ”¯æŒ InfluxDBã€Redisã€Kafkaã€Elasticsearchç­‰é›†æˆï¼Œå¯ä»¥åŠ ä¸Šå¯¹åº”é…ç½®å°†ç›‘æ§æ•°æ®å‘å¾€è¿™äº›æ•°æ®åº“å­˜å‚¨èµ·æ¥ã€‚</p>
<p>CAdvisorä¸»è¦åŠŸèƒ½ï¼š</p>
<ul>
<li>
<p>å±•ç¤ºHostå’Œå®¹å™¨ä¸¤ä¸ªå±‚æ¬¡çš„ç›‘æ§æ•°æ®</p>
</li>
<li>
<p>å±•ç¤ºå†å²å˜åŒ–æ•°æ®</p>
</li>
</ul>
<h3 id="influxdb">InfluxDB
</h3><p>InfluxDBæ˜¯ç”¨Goè¯­è¨€ç¼–å†™çš„ä¸€ä¸ªå¼€æºåˆ†å¸ƒå¼æ—¶åºã€äº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“ï¼Œæ— éœ€å¤–éƒ¨ä¾èµ–ã€‚</p>
<p>CAdvisoré»˜è®¤åªåœ¨æœ¬æœºä¿å­˜2åˆ†é’Ÿçš„æ•°æ®ï¼Œä¸ºäº†æŒä¹…åŒ–å­˜å‚¨æ•°æ®å’Œç»Ÿä¸€æ”¶é›†å±•ç¤ºç›‘æ§æ•°æ®ï¼Œéœ€è¦å°†æ•°æ®å­˜å‚¨åˆ°InfluxDBä¸­ã€‚InfluxDBæ˜¯ä¸€ä¸ªæ—¶åºæ•°æ®åº“ï¼Œä¸“é—¨ç”¨äºå­˜å‚¨æ—¶åºç›¸å…³æ•°æ®ï¼Œå¾ˆé€‚åˆå­˜å‚¨ CAdvisor çš„æ•°æ®ã€‚è€Œä¸” CAdvisoræœ¬èº«å·²ç»æä¾›äº†InfluxDBçš„é›†æˆæ–¹æ³•ï¼Œåœ¨å¯åŠ¨å®¹å™¨æ—¶æŒ‡å®šé…ç½®å³å¯ã€‚</p>
<p>InfluxDBä¸»è¦åŠŸèƒ½ï¼š</p>
<ul>
<li>
<p>åŸºäºæ—¶é—´åºåˆ—ï¼Œæ”¯æŒä¸æ—¶é—´æœ‰å…³çš„ç›¸å…³å‡½æ•°ï¼ˆå¦‚æœ€å¤§ã€æœ€å°ã€æ±‚å’Œç­‰ï¼‰</p>
</li>
<li>
<p>å¯åº¦é‡æ€§ï¼Œå¯ä»¥å®æ—¶å¯¹å¤§é‡æ•°æ®è¿›è¡Œè®¡ç®—</p>
</li>
<li>
<p>åŸºäºäº‹ä»¶ï¼Œæ”¯æŒä»»æ„çš„äº‹ä»¶æ•°æ®</p>
</li>
</ul>
<h3 id="granfana">Granfana
</h3><p>Grafanaæ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®ç›‘æ§åˆ†æå¯è§†åŒ–å¹³å°ï¼Œæ”¯æŒå¤šç§æ•°æ®æºé…ç½®ï¼ˆæ”¯æŒçš„æ•°æ®æºåŒ…æ‹¬InfluxDBã€MySQLã€Elasticsearchã€OpenTSDBã€Graphiteç­‰ï¼‰å’Œä¸°å¯Œçš„æ’ä»¶åŠæ¨¡æ¿åŠŸèƒ½ï¼Œæ”¯æŒå›¾è¡¨æƒé™æ§åˆ¶å’ŒæŠ¥è­¦ã€‚</p>
<p>Granfanaä¸»è¦åŠŸèƒ½ï¼š</p>
<ul>
<li>
<p>çµæ´»ä¸°å¯Œçš„å›¾å½¢åŒ–é€‰é¡¹</p>
</li>
<li>
<p>å¯ä»¥æ··åˆå¤šç§é£æ ¼</p>
</li>
<li>
<p>æ”¯æŒç™½å¤©å’Œå¤œé—´æ¨¡å¼</p>
</li>
<li>
<p>å¤šä¸ªæ•°æ®æº</p>
</li>
</ul>
<h2 id="å®‰è£…éƒ¨ç½²">å®‰è£…éƒ¨ç½²
</h2><ol>
<li>ç¼–å†™<code>docker-compose.yml</code>æœåŠ¡ç¼–æ’æ–‡ä»¶</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">grafana_data</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">influxdb</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c"># tutum/influxdb ç›¸æ¯”influxdbå¤šäº†webå¯è§†åŒ–è§†å›¾ã€‚ä½†æ˜¯è¯¥é•œåƒå·²è¢«æ ‡è®°ä¸ºå·²è¿‡æ—¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">tutum/influxdb:0.9</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PRE_CREATE_DB=cadvisor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8083:8083&#34;</span><span class="w">         </span><span class="c"># æ•°æ®åº“webå¯è§†åŒ–é¡µé¢ç«¯å£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8086:8086&#34;</span><span class="w">         </span><span class="c"># æ•°æ®åº“ç«¯å£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./data/influxdb:/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cadvisor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">google/cadvisor:v0.32.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">links</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">influxdb:influxsrv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="l">storage_driver=influxdb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="l">storage_driver_db=cadvisor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="l">storage_driver_host=influxsrv:8086</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8080:8080&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/:/rootfs:ro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/var/run:/var/run:rw</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/sys:/sys:ro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/var/lib/docker/:/var/lib/docker:ro</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">grafana</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">grafana/grafana:8.5.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;104&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">links</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">influxdb:influxsrv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3000:3000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">grafana_data:/var/lib/grafana</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">HTTP_USER=admin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">HTTP_PASS=admin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">INFLUXDB_HOST=influxsrv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">INFLUXDB_PORT=8086</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>æ£€æŸ¥è¯­æ³•</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose config -q
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker-compose up -d
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®¹å™¨å¯åŠ¨ä¹‹åï¼š</p>
<ol>
<li>åœ¨æµè§ˆå™¨æ‰“å¼€InfluxDBæ•°æ®åº“çš„é¡µé¢ï¼š <a class="link" href="http://xxx.xxx.xxx.xxx:8083"  target="_blank" rel="noopener"
    >http://xxx.xxx.xxx.xxx:8083</a>ï¼Œä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­çš„æ•°æ®åº“å®ä¾‹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">SHOW DATABASES
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŸ¥çœ‹å…¶ä¸­æ˜¯å¦è‡ªåŠ¨åˆ›å»ºäº†æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„ <code>cadvisor</code> æ•°æ®åº“å®ä¾‹</p>
<ol start="2">
<li>
<p>åœ¨æµè§ˆå™¨æ‰“å¼€CAdvisoré¡µé¢ï¼šhttp://xxx.xxx.xxx.xxx8080/ï¼ŒæŸ¥çœ‹å½“å‰dockerä¸­çš„cpuã€å†…å­˜ã€ç½‘ç»œIOç­‰ç»Ÿè®¡ä¿¡æ¯</p>
</li>
<li>
<p>åœ¨æµè§ˆå™¨æ‰“å¼€Grafanaé¡µé¢ï¼šhttp://xxx.xxx.xxx.xxx:3000/ï¼Œé»˜è®¤ç”¨æˆ·åå¯†ç æ˜¯ï¼š<code>admin</code>/<code>admin</code>ã€‚</p>
</li>
</ol>
<h2 id="grafanaé…ç½®">Grafanaé…ç½®
</h2><h3 id="æ·»åŠ æ•°æ®æº">æ·»åŠ æ•°æ®æº
</h3><p>åœ¨<code>Configuration</code>ï¼ˆå°é½¿è½®ï¼‰é€‰é¡¹å¡ä¸­ï¼Œé€‰æ‹©<code>Data Sources</code>ï¼Œæ·»åŠ ä¸€ä¸ªInfluxDBæ•°æ®æºï¼š</p>
<ul>
<li>
<p>nameï¼šè‡ªå®šä¹‰ä¸€ä¸ªæ•°æ®æºåç§°ï¼Œä¾‹å¦‚<code>InfluxDB</code></p>
</li>
<li>
<p>Query Languageï¼šæŸ¥è¯¢è¯­è¨€ï¼Œé»˜è®¤<code>InfluxQL</code>å³å¯</p>
</li>
<li>
<p>URLï¼šæ ¹æ®composeä¸­çš„å®¹å™¨æœåŠ¡åè¿æ¥ï¼Œ<code>http://influxdb:8086</code></p>
</li>
<li>
<p>databaseï¼šæˆ‘ä»¬åœ¨InfluxDBä¸­åˆ›å»ºçš„æ•°æ®åº“å®ä¾‹ï¼Œ<code>cadvisor</code></p>
</li>
<li>
<p>Userï¼šInfluxDBçš„é»˜è®¤ç”¨æˆ·ï¼Œ<code>root</code></p>
</li>
<li>
<p>Passwordï¼š<code>root</code></p>
</li>
</ul>
<p>ä¿å­˜å¹¶æµ‹è¯•ï¼Œå¯ä»¥è¿é€šå³å¯</p>
<h3 id="æ·»åŠ å·¥ä½œå°">æ·»åŠ å·¥ä½œå°
</h3><ol>
<li>åœ¨<code>Create</code>ï¼ˆåŠ å·ï¼‰é€‰é¡¹å¡ä¸­ï¼Œé€‰æ‹©åˆ›å»º <code>Dash Board</code>å·¥ä½œå°ã€‚å³ä¸Šè§’é…ç½®ä¸­å¯ä»¥é…ç½®åˆ›å»ºå‡ºæ¥çš„å·¥ä½œå°çš„æ ‡é¢˜ã€æ–‡ä»¶å¤¹ç­‰ä¿¡æ¯ã€‚</li>
<li>åœ¨åˆ›å»ºå‡ºæ¥çš„å·¥ä½œå°ä¸­ï¼Œé€‰æ‹©<code>Add panel</code>ä¸­çš„<code>Add a new panel</code>æ·»åŠ ä¸€ä¸ªæ–°çš„é¢æ¿ã€‚
<ol>
<li>åœ¨å³ä¸Šè§’<code>Time series</code>ï¼ˆæ—¶åºå›¾ï¼‰ä½ç½®å¯ä»¥åˆ‡æ¢å±•ç¤ºçš„å›¾è¡¨æ ·å¼ï¼ˆæŸ±çŠ¶å›¾ã€ä»ªè¡¨ç›˜ã€è¡¨æ ¼ã€é¥¼å›¾ç­‰ç­‰ï¼‰</li>
<li>å³ä¾§è¾¹æ ä¸ºè¯¥å›¾è¡¨é…ç½®ç›¸å…³ä¿¡æ¯ï¼šæ ‡é¢˜ã€æè¿°</li>
<li>å›¾è¡¨ä¸‹æ–¹å¯ä»¥é…ç½®è¯¥å›¾è¡¨å±•ç¤ºçš„æ•°æ®çš„æŸ¥è¯¢è¯­å¥ï¼Œä¾‹å¦‚
<ol>
<li>FROMï¼š<code>cpu_usage_total</code>ï¼ˆGrafanaä¼šè‡ªåŠ¨è·å–InfluxDBæ•°æ®åº“ä¸­çš„å…ƒæ•°æ®ï¼Œå¯ä»¥ç›´æ¥é€‰æ‹©å¯¹åº”è¡¨åï¼‰</li>
<li>WHEREï¼šæ·»åŠ ä¸€ä¸ªæ¡ä»¶ï¼Œ<code>container_name=cig-cadvisor-1</code></li>
<li>ALIASï¼šé…ç½®ä¸€ä¸ªåˆ«åï¼Œ<code>CPUä½¿ç”¨æƒ…å†µæ±‡æ€»</code></li>
</ol>
</li>
</ol>
</li>
</ol>

</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 å°è¯—
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/xiaoshi/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
